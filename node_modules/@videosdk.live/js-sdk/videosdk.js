/*! For license information please see videosdk.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var a in r)("object"==typeof exports?exports:e)[a]=r[a]}}(self,(()=>(()=>{var e={7757:(e,t,r)=>{e.exports=r(5666)},4180:e=>{self,e.exports=(()=>{var e={43:function(e,t,r){var a,n;!function(i,s){"use strict";a=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function n(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(a){return"debug"===a&&(a="log"),typeof console!==t&&("trace"===a&&r?i:void 0!==console[a]?n(console,a):void 0!==console.log?n(console,"log"):e)}function o(t,r){for(var n=0;n<a.length;n++){var i=a[n];this[i]=n<t?e:this.methodFactory(i,t,r)}this.log=this.debug}function c(e,r,a){return function(){typeof console!==t&&(o.call(this,r,a),this[e].apply(this,arguments))}}function d(e,t,r){return s(e)||c.apply(this,arguments)}function p(e,r,n){var i,s=this,c="loglevel";function p(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,a=r.indexOf(encodeURIComponent(c)+"=");-1!==a&&(e=/^([^;]+)/.exec(r.slice(a))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=n||d,s.getLevel=function(){return i},s.setLevel=function(r,n){if("string"==typeof r&&void 0!==s.levels[r.toUpperCase()]&&(r=s.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(i=r,!1!==n&&function(e){var r=(a[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+r+";"}catch(e){}}}(r),o.call(s,r,e),typeof console===t&&r<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){p()||s.setLevel(e,!1)},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var l=p();null==l&&(l=null==r?"WARN":r),s.setLevel(l,!1)}var l=new p,u={};l.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new p(e,l.getLevel(),l.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return l.noConflict=function(){return typeof window!==t&&window.log===l&&(window.log=h),l},l.getLoggers=function(){return u},l.default=l,l},void 0===(n=a.call(t,r,t,e))||(e.exports=n)}()}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,r),i.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return(()=>{"use strict";r.r(a),r.d(a,{VideoSDKMetrics:()=>ne});const e="inbound",t="outbound",n={codec_id_in:"",codec_in:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_in:0,delta_rtt_ms_out:null,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,timestamp_in:null,ssrc:"",total_concealment_events:0,delta_concealment_events:0,total_inserted_samples_for_decelaration:0,delta_inserted_samples_for_decelaration:0,total_removed_samples_for_accelaration:0,delta_removed_samples_for_accelaration:0,direction:e},i={codec_id_out:"",codec_out:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,timestamp_out:null,ssrc:"",direction:t},s={codec_id_in:"",size_in:{width:null,height:null,framerate:null},codec_in:{mime_type:null,clock_rate:null},delta_jitter_ms_in:0,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,ssrc:"",direction:e},o={codec_id_out:"",size_out:{width:null,height:null,framerate:null},codec_out:{mime_type:null,clock_rate:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,limitation_out:{reason:null,durations:null,resolutionChanges:0},timestamp_out:null,ssrc:"",direction:t},c="inbound-rtp",d="bytesReceived",p="bytesSent",l="currentRoundTripTime",u="roundTripTime",h="fractionLost",m="frameHeight",f="frameWidth",_="qualityLimitationReason",v="qualityLimitationDurations",g="qualityLimitationResolutionChanges",y="jitter",b="packetsLost",w="packetsReceived",S="packetsSent",k="responsesReceived",R="selected",P="totalRoundTripTime",E="roundTripTimeMeasurements",C="framesDecoded",T="framesEncoded",x="totalDecodeTime",D="totalEncodeTime",I="pliCount",O="nackCount",M="audio",A="video",L={0:"ETHERNET",2:"CELLULAR_5G",3:"WIFI",5:"CELLULAR_4G",10:"CELLULAR"},j="audio",N="video",B="network",F="data";var W=r(43);const V=()=>`${(new Date).toISOString()} | metrics`,U=(e,t,r)=>`${e} | ${t} | ${r}`;W.setDefaultLevel(W.levels.TRACE);const H=(e,t,r)=>{r?W.debug(U(V(),e,t),r):W.debug(U(V(),e,t))},z=(e,t)=>{W.warn(U(V(),e,t))},Z=(e,t)=>{W.error(U(V(),e,t))},G="extractor   ",q=(t,r,a)=>{if(!r)return null;const c={};let d=r.audio[t];d||(d=a===e?{...n}:{...i}),c.audio=d;let p=r.video[t];return p||(p=a===e?{...s}:{...o}),c.video=p,c},K=(e,t,r,a)=>{let n=!1;const i=a[t].total_rtt_ms_out,s=a[t].total_rtt_measure_out,o=r?r[t].total_rtt_ms_out:0,c=r?r[t].total_rtt_measure_out:0,d={rtt:null,totalRTT:i,totalRTTMeasurements:s};if(e.timestamp===a[t].timestamp_out)return d;if(!Object.prototype.hasOwnProperty.call(e,u))return d;if(Object.prototype.hasOwnProperty.call(e,E)&&(n=!0,0===Number(e.roundTripTimeMeasurements)||Number(e.roundTripTimeMeasurements)-c===s))return d;const p=Number(1e3)*Number(e.roundTripTime);let l=i+p,h=s+1;return n&&(l=Number(1e3)*Number(e.totalRoundTripTime)-o,h=Number(e.roundTripTimeMeasurements)-c),{rtt:p,totalRTT:l,totalRTTMeasurements:h}},$=(e,t,r)=>e.timestamp===r[t].timestamp_out?null:Object.prototype.hasOwnProperty.call(e,y)?Number(1e3)*(Number(e.jitter)||0):null,Q=(e,t,r,a)=>{if(!Object.prototype.hasOwnProperty.call(e,S)||!Object.prototype.hasOwnProperty.call(e,p))return{packetsSent:r[t].total_packets_out,packetsLost:r[t].total_packets_lost_out,bytesSent:r[t].total_KBytes_out};const n=Number(e.packetsSent)||0-(a?a[t].total_packets_out:0),i=n-r[t].total_packets_out,s=Number(e.bytesSent)/1024-(a?a[t].total_KBytes_out:0),o=s-r[t].total_KBytes_out,c=e.timestamp||Date.now(),d=a?a.timestamp:null;let l=r.timestamp;!l&&d&&(l=d);const u=l?c-l:0;return{packetsSent:n,deltaPacketsSent:i,KBytesSent:s,deltaKBytesSent:o,kbsSent:u>0?.008*o*1024/u*1e3:0}},Y=(e,t,r,a)=>{let n=r[t].total_packets_lost_out,i=0,s=0;return Object.prototype.hasOwnProperty.call(e,b)&&(n=Number(e.packetsLost)||0-(a?a[t].total_packets_lost_out:0),i=n-r[t].total_packets_lost_out),Object.prototype.hasOwnProperty.call(e,h)&&(s=Number(100*e.fractionLost)),{packetsLost:n,deltaPacketsLost:i,fractionLost:s}},J=(e,t,r,a)=>{if(!Object.prototype.hasOwnProperty.call(e,w)||!Object.prototype.hasOwnProperty.call(e,b)||!Object.prototype.hasOwnProperty.call(e,d))return{percent_packets_lost:r[t].percent_packets_lost_in,packetsReceived:r[t].total_packets_in,packetsLost:r[t].total_packets_lost_in,bytesReceived:r[t].total_KBytes_in};const n=Number(e.packetsReceived)||0-(a?a[t].total_packets_in:0),i=Number(e.packetsLost)||0-(a?a[t].total_packets_lost_in:0),s=i-r[t].total_packets_lost_in,o=n-r[t].total_packets_in,c=n!==r[t].total_packets_in?100*s/(s+o):0,p=Number(e.bytesReceived)/1024-(a?a[t].total_KBytes_in:0),l=p-r[t].total_KBytes_in,u=e.timestamp||Date.now(),h=a?a.timestamp:null;let m=r.timestamp;!m&&h&&(m=h);const f=m?u-m:0;return{percentPacketsLost:c,packetsReceived:n,deltaPacketsReceived:o,packetsLost:i,deltaPacketsLost:s,KBytesReceived:p,deltaKBytesReceived:l,kbsReceived:f>0?.008*l*1024/f*1e3:0}},X=e=>"relay"!==e.candidateType?"":e.relayProtocol||"",ee=e=>Object.prototype.hasOwnProperty.call(e,m)&&Object.prototype.hasOwnProperty.call(e,f)?{width:e.frameWidth||null,height:e.frameHeight||null,framerate:e.framesPerSecond}:{width:null,height:null,framerate:null};class te{constructor(e,t){this._callbacks={onStatsCollected:null},this._id=`collector-${t}`,this._moduleName=this._id,this._probeId=t,this._config=e,this._state="idle",this._statsReports=[]}registerCallback(e,t,r){e in this._callbacks?(this._callbacks[e]={callback:t,context:r},H(this._moduleName,`registered callback '${e}'`)):Z(this._moduleName,`can't register callback for '${e}' - not found`)}unregisterCallback(e){e in this._callbacks?(this._callbacks[e]=null,delete this._callbacks[e],H(this._moduleName,`unregistered callback '${e}'`)):Z(this._moduleName,`can't unregister callback for '${e}' - not found`)}analyze(r,a){const d=(e=>{const t={name:"",meetingId:"",peerId:"",timestamp:null,count:0,audio:{},video:{},network:{infrastructure:3},data:{delta_kbs_bandwidth_in:0,delta_kbs_bandwidth_out:0,delta_rtt_connectivity_ms:null,total_rtt_connectivity_ms:0}};if(e){const t={...e,audio:{},video:{},data:{...e.data},network:{...e.network}};return Object.keys(e.audio).forEach((r=>{t.audio[r]={...e.audio[r]}})),Object.keys(e.video).forEach((r=>{t.video[r]={...e.video[r]}})),t}return{...t,audio:{},video:{},data:{...t.data},network:{...t.network}}})(a);d.name=this._config.name,d.meetingId=this._config.meetingId,d.peerId=this._config.peerId,d.count=a?a.count+1:1;let p=null;return r.forEach((r=>{!p&&r.timestamp&&(p=r.timestamp),((r,a,n,i)=>{if(!r)return[];switch(r.type){case"candidate-pair":let s=!1;if(r.nominated&&"succeeded"===r.state&&(s=!0,H(G,`analyze() - got stats ${r.type} for ${n}`,r),R in r&&!r.selected&&(s=!1)),s){r.localCandidateId,r.remoteCandidateId;const e=((e,t,r)=>{const a=(e.bytesReceived||0)/1024-(r?r.data.total_KBytes_in:0),n=(e.bytesSent||0)/1024-(r?r.data.total_KBytes_out:0),i=e.timestamp||Date.now(),s=a-t.data.total_KBytes_in,o=n-t.data.total_KBytes_out,c=r?r.timestamp:null;let d=t.timestamp;!d&&c&&(d=c);const p=d?i-d:0;return{total_KBytes_received:a,total_KBytes_sent:n,delta_KBytes_received:s,delta_KBytes_sent:o,kbs_speed_received:p>0?.008*s*1024/p*1e3:0,kbs_speed_sent:p>0?.008*o*1024/p*1e3:0}})(r,a,i),t=((e=>{e.availableIncomingBitrate,e.availableOutgoingBitrate})(r),((e,t,r,a)=>{if(!Object.prototype.hasOwnProperty.call(e,l))return{rtt:null,totalRTT:a.data.total_rtt_connectivity_ms,totalRTTMeasurements:a.data.total_rtt_connectivity_measure};const n=Number(1e3)*Number(e.currentRoundTripTime);let i=a.data.total_rtt_connectivity_ms+n,s=a.data.total_rtt_connectivity_measure+1;return Object.prototype.hasOwnProperty.call(e,P)&&(i=Number(1e3)*Number(e.totalRoundTripTime)-(r?r.data.total_rtt_connectivity_ms:0)),Object.prototype.hasOwnProperty.call(e,k)&&(s=Number(e.responsesReceived)-(r?r.data.total_rtt_connectivity_measure:0)),{rtt:n,totalRTT:i,totalRTTMeasurements:s}})(r,0,i,a));return[{type:F,value:{total_KBytes_in:e.total_KBytes_received}},{type:F,value:{total_KBytes_out:e.total_KBytes_sent}},{type:F,value:{delta_KBytes_in:e.delta_KBytes_received}},{type:F,value:{delta_KBytes_out:e.delta_KBytes_sent}},{type:F,value:{delta_kbs_in:e.kbs_speed_received}},{type:F,value:{delta_kbs_out:e.kbs_speed_sent}},{type:F,value:{delta_rtt_connectivity_ms:t.rtt}}]}break;case"local-candidate":if(r.id===a.network.local_candidate_id)return[{type:B,value:{infrastructure:r.networkType}},{type:B,value:{local_candidate_protocol:r.protocol||""}},{type:B,value:{local_candidate_relay_protocol:X(r)}}];break;case c:{H(G,`analyze() - got stats ${r.type} for ${n}`,r);const t=r.ssrc,s=q(t,a,e);s&&(s.timestamp=a.timestamp);const o=q(t,i,e);if(o&&(o.timestamp=i.timestamp),r.mediaType===M){const e=J(r,M,s,o),a=$(r,M,s),n=r.codecId||"",i=((e,t,r,a)=>{const n=Number(e.concealmentEvents)||0,i=n-(r.audio.total_concealment_events||0),s=Number(e.insertedSamplesForDeceleration)||0,o=s-(r.audio.total_inserted_samples_for_decelaration||0),c=Number(e.removedSamplesForAcceleration)||0;return{totalConcealmentEvents:n,deltaConcealmentEvents:i,totalInsertedSamplesForDecelaration:s,deltaInsertedSamplesForDecelaration:o,totalRemovedSamplesForAccelaration:c,deltaRemovedSampleForAccelaration:c-(r.audio.total_removed_samples_for_accelaration||0)}})(r,0,s);return[{ssrc:t,type:j,value:{codec_id_in:n}},{ssrc:t,type:j,value:{total_packets_in:e.packetsReceived}},{ssrc:t,type:j,value:{delta_packets_in:e.deltaPacketsReceived}},{ssrc:t,type:j,value:{total_packets_lost_in:e.packetsLost}},{ssrc:t,type:j,value:{delta_packets_lost_in:e.deltaPacketsLost}},{ssrc:t,type:j,value:{percent_packets_lost_in:e.percentPacketsLost}},{ssrc:t,type:j,value:{total_KBytes_in:e.KBytesReceived}},{ssrc:t,type:j,value:{delta_KBytes_in:e.deltaKBytesReceived}},{ssrc:t,type:j,value:{delta_kbs_in:e.kbsReceived}},{ssrc:t,type:j,value:{delta_jitter_ms_in:a}},{ssrc:t,type:j,value:{total_concealment_events:i.totalConcealmentEvents}},{ssrc:t,type:j,value:{delta_concealment_events:i.deltaConcealmentEvents}},{ssrc:t,type:j,value:{total_inserted_samples_for_decelaration:i.totalInsertedSamplesForDecelaration}},{ssrc:t,type:j,value:{delta_inserted_samples_for_decelaration:i.deltaInsertedSamplesForDecelaration}},{ssrc:t,type:j,value:{total_removed_samples_for_accelaration:i.totalRemovedSamplesForAccelaration}},{ssrc:t,type:j,value:{delta_removed_samples_for_accelaration:i.deltaRemovedSampleForAccelaration}},{ssrc:t,type:j,value:{track_in:r.trackId}}]}if(r.mediaType===A){((e,t)=>{if(!Object.prototype.hasOwnProperty.call(e,C)||!Object.prototype.hasOwnProperty.call(e,x))return{delta_ms_decode_frame:t.video.delta_ms_decode_frame_in,frames_decoded:t.video.total_frames_decoded_in,total_decode_time:t.video.total_time_decoded_in};e.framesDecoded,e.totalDecodeTime,t.video.total_time_decoded_in,t.video.total_frames_decoded_in})(r,s);const e=J(r,A,s,o),a=$(r,A,s),n=(r.decoderImplementation,r.codecId||null),i=ee(r);return((e,t,r)=>{if(!Object.prototype.hasOwnProperty.call(e,I)||!Object.prototype.hasOwnProperty.call(e,O))return{pliCount:t.total_pli_sent_in,nackCount:t.total_nack_sent_in,deltaPliCount:0,deltaNackCount:0};e.pliCount,r&&r.video.total_pli_sent_in,e.nackCount,r&&r.video.total_nack_sent_in,t.video.total_pli_sent_in,t.video.total_nack_sent_in})(r,s,o),[{ssrc:t,type:N,value:{codec_id_in:n}},{ssrc:t,type:N,value:{total_packets_in:e.packetsReceived}},{ssrc:t,type:N,value:{delta_packets_in:e.deltaPacketsReceived}},{ssrc:t,type:N,value:{total_packets_lost_in:e.packetsLost}},{ssrc:t,type:N,value:{delta_packets_lost_in:e.deltaPacketsLost}},{ssrc:t,type:N,value:{percent_packets_lost_in:e.percentPacketsLost}},{ssrc:t,type:N,value:{total_KBytes_in:e.KBytesReceived}},{ssrc:t,type:N,value:{delta_KBytes_in:e.deltaKBytesReceived}},{ssrc:t,type:N,value:{delta_kbs_in:e.kbsReceived}},{ssrc:t,type:N,value:{delta_jitter_ms_in:a}},{ssrc:t,type:N,value:{size_in:i}},{ssrc:t,type:N,value:{track_in:r.trackId}}]}break}case"outbound-rtp":{H(G,`analyze() - got stats ${r.type} for ${n}`,r);const e=r.ssrc,s=q(e,a,t);s&&(s.timestamp=a.timestamp);const o=q(e,i,t);if(o&&(o.timestamp=i.timestamp),r.mediaType===M){const t=r.codecId||null,a=Q(r,M,s,o);return[{ssrc:e,type:j,value:{codec_id_out:t}},{ssrc:e,type:j,value:{total_packets_out:a.packetsSent}},{ssrc:e,type:j,value:{delta_packets_out:a.deltaPacketsSent}},{ssrc:e,type:j,value:{total_KBytes_out:a.KBytesSent}},{ssrc:e,type:j,value:{delta_KBytes_out:a.deltaKBytesSent}},{ssrc:e,type:j,value:{delta_kbs_out:a.kbsSent}},{ssrc:e,type:j,value:{track_out:r.trackId}}]}if(r.mediaType===A){r.encoderImplementation;const t=r.codecId||null,a=(((e,t)=>{if(!Object.prototype.hasOwnProperty.call(e,T)||!Object.prototype.hasOwnProperty.call(e,D))return{delta_ms_encode_frame:t.video.delta_ms_encode_frame_out,frames_encoded:t.video.total_frames_encoded_out,total_encode_time:t.video.total_time_encoded_out};e.framesEncoded,e.totalEncodeTime,t.video.total_time_encoded_out,t.video.total_frames_encoded_out})(r,s),ee(r)),n=(e=>{const t=Object.prototype.hasOwnProperty.call(e,_)?e.qualityLimitationReason:null,r=Object.prototype.hasOwnProperty.call(e,g)?e.qualityLimitationResolutionChanges:null,a=Object.prototype.hasOwnProperty.call(e,v)?e.qualityLimitationDurations:null;return a&&Object.keys(a).forEach((e=>{a[e]>1e3&&(a[e]=Number(a[e]/1e3))})),{reason:t,durations:a,resolutionChanges:r}})(r),i=(((e,t,r)=>{if(!Object.prototype.hasOwnProperty.call(e,I)||!Object.prototype.hasOwnProperty.call(e,O))return{pliCount:t.total_pli_received_out,nackCount:t.total_nack_received_out,deltaPliCount:0,deltaNackCount:0};e.pliCount,r&&r.video.total_pli_received_out,e.nackCount,r&&r.video.total_nack_received_out,t.video.total_pli_received_out,t.video.total_nack_received_out})(r,s,o),Q(r,A,s,o));return[{ssrc:e,type:N,value:{codec_id_out:t}},{ssrc:e,type:N,value:{total_packets_out:i.packetsSent}},{ssrc:e,type:N,value:{delta_packets_out:i.deltaPacketsSent}},{ssrc:e,type:N,value:{total_KBytes_out:i.KBytesSent}},{ssrc:e,type:N,value:{delta_KBytes_out:i.deltaKBytesSent}},{ssrc:e,type:N,value:{delta_kbs_out:i.kbsSent}},{ssrc:e,type:N,value:{size_out:a}},{ssrc:e,type:N,value:{limitation_out:n}},{ssrc:e,type:N,value:{track_out:r.trackId}}]}break}case"media-source":H(G,`analyze() - got stats ${r.type} for ${n}`,r);break;case"track":{H(G,`analyze() - got stats ${r.type} for ${n}`,r);const e=[];return Object.keys(a.audio).forEach((t=>{const i=a.audio[t];if(i.track_in===r.id||i.track_out===r.id){H(G,`analyze() - got stats ${r.type} for ${n}`,r);var s=r.trackIdentifier;r.id===i.track_in?e.push({ssrc:i.ssrc,type:j,value:{track_id_in:s}}):e.push({ssrc:i.ssrc,type:j,value:{track_id_out:s}})}})),Object.keys(a.video).forEach((t=>{const i=a.video[t];if(i.track_in===r.id||i.track_out===r.id){H(G,`analyze() - got stats ${r.type} for ${n}`,r);var s=r.trackIdentifier;r.id===i.track_in?e.push({ssrc:i.ssrc,type:N,value:{track_id_in:s}}):e.push({ssrc:i.ssrc,type:N,value:{track_id_out:s}})}})),e}case"codec":const o=[];return Object.keys(a.audio).forEach((e=>{const t=a.audio[e];if(t.codec_id_in===r.id||t.codec_id_out===r.id){H(G,`analyze() - got stats ${r.type} for ${n}`,r);const e=(e=>({channels:e.channels||null,clock_rate:e.clockRate||null,mime_type:e.mimeType||null,sdp_fmtp_line:e.sdpFmtpLine||null}))(r);r.id===t.codec_id_in?o.push({ssrc:t.ssrc,type:j,value:{codec_in:e}}):o.push({ssrc:t.ssrc,type:j,value:{codec_out:e}})}})),Object.keys(a.video).forEach((e=>{const t=a.video[e];if(t.codec_id_in===r.id||t.codec_id_out===r.id){H(G,`analyze() - got stats ${r.type} for ${n}`,r);const e=(e=>({clock_rate:e.clockRate||null,mime_type:e.mimeType||null}))(r);r.id===t.codec_id_in?o.push({ssrc:t.ssrc,type:N,value:{codec_in:e}}):o.push({ssrc:t.ssrc,type:N,value:{codec_out:e}})}})),o;case"remote-inbound-rtp":{H(G,`analyze() - got stats ${r.type} for ${n}`,r);const e=r.ssrc,s=q(e,a,t),o=q(e,i,t);if(r.kind===M){const t=K(r,M,o,s),a=$(r,M,s),n=Y(r,M,s,o);return[{ssrc:e,type:j,value:{delta_rtt_ms_out:t.rtt}},{ssrc:e,type:j,value:{delta_jitter_ms_out:a}},{ssrc:e,type:j,value:{timestamp_out:r.timestamp}},{ssrc:e,type:j,value:{total_packets_lost_out:n.packetsLost}},{ssrc:e,type:j,value:{delta_packets_lost_out:n.deltaPacketsLost}},{ssrc:e,type:j,value:{percent_packets_lost_out:n.fractionLost}}]}if(r.kind===A){const t=K(r,A,o,s),a=$(r,A,s),n=Y(r,A,s,o);return[{ssrc:e,type:N,value:{delta_rtt_ms_out:t.rtt}},{ssrc:e,type:N,value:{delta_jitter_ms_out:a}},{ssrc:e,type:N,value:{timestamp_out:r.timestamp}},{ssrc:e,type:N,value:{total_packets_lost_out:n.packetsLost}},{ssrc:e,type:N,value:{delta_packets_lost_out:n.deltaPacketsLost}}]}break}case"remote-outbound-rtp":{H(G,`analyze() - got stats ${r.type} for ${n}`,r);const e=r.ssrc,s=q(e,a,t),o=q(e,i,t);if(r.kind===M){const t=K(r,M,o,s);return[{ssrc:e,type:j,value:{delta_rtt_ms_in:t.rtt}},{ssrc:e,type:j,value:{timestamp_in:r.timestamp}}]}break}}return[]})(r,d,d.name,null).forEach((e=>{if(e.value&&e.type)if(e.ssrc){let p=d[e.type][e.ssrc];p||(t=e.type,a=r.type,p=t===M?a===c?{...n}:{...i}:a===c?{...s}:{...o},p.ssrc=e.ssrc,d[e.type][e.ssrc]=p),Object.keys(e.value).forEach((t=>{p[t]=e.value[t]}))}else Object.keys(e.value).forEach((t=>{d[e.type][t]=e.value[t]}));var t,a}))})),d.timestamp=p,d}async collectStats(){try{const e=await this._config.monitoringObject.getStats(),t=this.analyze(e,this._statsReports.slice().pop()||null);return this._statsReports.push(t),this.fireOnStatsCollected(t),e}catch(e){return Z(this._moduleName,`got error ${e}`),null}}fireOnStatsCollected(r){if(this._callbacks.onStatsCollected){const a={};a.meetingId=r.meetingId,a.peerId=r.peerId,a.name=r.name,a.audio=[],a.video=[],Object.values(r.audio).forEach((n=>{const i={};i.network=L[r.network.infrastructure],i.timestamp=r.timestamp,n.direction==e?(i.codec=n.codec_in.mime_type,i.jitter=n.delta_jitter_ms_in,i.bitrate=n.delta_kbs_in,i.packetsLost=n.delta_packets_lost_in,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=n.delta_packets_in,i.concealmentEvents=n.delta_concealment_events,i.removedSampleForAccelaration=n.delta_removed_samples_for_accelaration,i.insertedSamplesForDecelaration=n.delta_inserted_samples_for_decelaration,i.trackId=n.track_id_in):n.direction==t&&(i.codec=n.codec_out.mime_type,i.jitter=n.delta_jitter_ms_out,i.bitrate=n.delta_kbs_out,i.packetsLost=n.delta_packets_lost_out,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=n.delta_packets_out,i.trackId=n.track_id_out),a.audio.push(i)})),Object.values(r.video).forEach((n=>{const i={};i.network=L[r.network.infrastructure],i.timestamp=r.timestamp,n.direction==e?(i.codec=n.codec_in.mime_type,i.jitter=n.delta_jitter_ms_in,i.bitrate=n.delta_kbs_in,i.packetsLost=n.delta_packets_lost_in,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=n.delta_packets_in,i.size=n.size_in,i.trackId=n.track_id_in):n.direction==t&&(i.codec=n.codec_out.mime_type,i.jitter=n.delta_jitter_ms_out,i.bitrate=n.delta_kbs_out,i.packetsLost=n.delta_packets_lost_out,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=n.delta_packets_out,i.limitation=n.limitation_out,i.size=n.size_out,i.trackId=n.track_id_out),a.video.push(i)})),this._callbacks.onStatsCollected.callback(a)}}}class re{constructor(e){this._id=e.name&&e.name.substr(0,12).padEnd(12," "),this._moduleName=this._id,this._config=e,this._collector=new te(this._config,this._id)}get id(){return this._id}start(){this._collectorIntervalId?z("Probe already started."):(H(this._moduleName,"Probe Started"),this._collectorIntervalId=setInterval((()=>{H(this._moduleName,"Collector collecting stats"),this._collector.collectStats()}),this._config.refreshEvery))}stop(){this._collectorIntervalId?(clearInterval(this._collectorIntervalId),H(this._moduleName,"Probe Stopped")):z("Probe not running, Please start first.")}set onStatsCollected(e){e?this._collector.registerCallback("onStatsCollected",e):this._collector.unregisterCallback("onStatsCollected")}}const ae={refreshEvery:2e3,startAfter:0,stopAfter:-1,verbose:!1,peerId:"peerId",meetingId:"meetingId",name:"name"};class ne{constructor(e){var t;this._config={defaultConfig:ae,...e},this._probes=[],t=this._config.verbose||!1,W.setLevel(t?W.levels.TRACE:W.levels.INFO),H("VideoSDKMetrics","VideoSDKMetrics initialized")}get probes(){return this._probes}addNewProbe(e,t){if(!e)throw new Error("undefined monitoring object");const r={monitoringObject:e,...t,...this._config},a=new re(r);return this._probes.push(a),a}removeExistingProbe(e){if(!e)throw new Error("undefined probe");e.stop(),this._probes=this._probes.filter((t=>e.id!==t.id))}startAllProbes(){this._probes.forEach(((e,t)=>{e.start()}))}stopAllProbes(){this._probes.forEach((e=>e.stop()))}}})(),a})()},2186:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.AwaitQueue=class{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,t){return r(this,void 0,void 0,(function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof e)throw new TypeError("given task is not a function");if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,a)=>{const n={task:e,name:t,resolve:r,reject:a,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(n),1===this.pendingTasks.length&&this.next()}))}))}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map((t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0})))}next(){return r(this,void 0,void 0,(function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())}))}executeTask(e){return r(this,void 0,void 0,(function*(){if(!e.stopped){e.executedAt=new Date;try{const t=yield e.task();if(e.stopped)return;e.resolve(t)}catch(t){if(e.stopped)return;e.reject(t)}}}))}}},8962:(e,t,r)=>{"use strict";r.d(t,{v:()=>a});var a={networkPriorities:{audio:"high",dominatingVideo:"high",otherVideos:"medium",screenShare:"medium"},aspectRatios:{fourThree:{label:"fourThree",value:1.333},oneSixNine:{label:"oneSixNine",value:1.777}},audioProfiles:{speech_low_quality:{sampleRate:16e3,bitRate:24,sampleSize:16,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:16e3,packetTime:20,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},speech_standard:{sampleRate:32e3,bitRate:24,sampleSize:24,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:32e3,packetTime:30,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},music_standard:{sampleRate:48e3,bitRate:40,sampleSize:32,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},standard_stereo:{sampleRate:48e3,sampleSize:32,bitRate:64,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2},high_quality:{sampleRate:48e3,sampleSize:32,bitRate:128,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},high_quality_stereo:{sampleRate:48e3,sampleSize:32,bitRate:192,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2}},videoProfiles:{h90p_w160p:{width:160,height:90,bitRate:6e4,frameRate:15,aspectRatio:"oneSixNine"},h180p_w320p:{width:320,height:180,bitRate:12e4,frameRate:15,aspectRatio:"oneSixNine"},h216p_w384p:{width:384,height:216,bitRate:18e4,frameRate:15,aspectRatio:"oneSixNine"},h360p_w640p:{width:640,height:360,bitRate:3e5,frameRate:20,aspectRatio:"oneSixNine"},h540p_w960p:{width:960,height:540,bitRate:6e5,frameRate:25,aspectRatio:"oneSixNine"},h720p_w1280p:{width:1280,height:720,bitRate:2e6,frameRate:30,aspectRatio:"oneSixNine"},h1080p_w1920p:{width:1920,height:1080,bitRate:3e6,frameRate:30,aspectRatio:"oneSixNine"},h1440p_w2560p:{width:2560,height:1440,bitRate:5e6,frameRate:30,aspectRatio:"oneSixNine"},h2160p_w3840p:{width:3840,height:2160,bitRate:8e6,frameRate:30,aspectRatio:"oneSixNine"},h120p_w160p:{width:160,height:120,bitRate:8e4,frameRate:15,aspectRatio:"fourThree"},h180p_w240p:{width:240,height:180,bitRate:1e5,frameRate:15,aspectRatio:"fourThree"},h240p_w320p:{width:320,height:240,bitRate:15e4,frameRate:15,aspectRatio:"fourThree"},h360p_w480p:{width:480,height:360,bitRate:225e3,frameRate:20,aspectRatio:"fourThree"},h480p_w640p:{width:640,height:480,bitRate:3e5,frameRate:25,aspectRatio:"fourThree"},h540p_w720p:{width:720,height:540,bitRate:45e4,frameRate:30,aspectRatio:"fourThree"},h720p_w960p:{width:960,height:720,bitRate:15e5,frameRate:30,aspectRatio:"fourThree"},h1080p_w1440p:{width:1440,height:1080,bitRate:25e5,frameRate:30,aspectRatio:"fourThree"},h1440p_w1920p:{width:1920,height:1440,bitRate:35e5,frameRate:30,aspectRatio:"fourThree"}},screenShareProfiles:{h360p_30fps:{width:640,height:360,bitRate:2e5,frameRate:3},h720p_5fps:{width:1280,height:720,bitRate:4e5,frameRate:5},h720p_15fps:{width:1280,height:720,bitRate:1e6,frameRate:15},h1080p_15fps:{width:1920,height:1080,bitRate:15e5,frameRate:15},h1080p_30fps:{width:1920,height:1080,bitRate:1e6,frameRate:15}},simulcastProfiles:{3840:[{scaleResolutionDownBy:12,maxBitRate:15e4},{scaleResolutionDownBy:6,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:1e7}],1920:[{scaleResolutionDownBy:6,maxBitRate:15e4},{scaleResolutionDownBy:3,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:35e5}],1280:[{scaleResolutionDownBy:4,maxBitRate:15e4},{scaleResolutionDownBy:2,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:12e5}],640:[{scaleResolutionDownBy:2,maxBitRate:15e4},{scaleResolutionDownBy:1,maxBitRate:5e5}],320:[{scaleResolutionDownBy:1,maxBitRate:15e4}]},requestTimeout:2e4,requestRetries:3,transportOptions:{tcp:!0},videoKSVCEncodings:[{scalabilityMode:"S3T3_KEY"}],videoSVCEncodings:[{scalabilityMode:"S3T3",dtx:!0}]}},6900:(e,t,r)=>{"use strict";r.d(t,{H:()=>n,R:()=>a});var a={INVALID_API_KEY:4001,INVALID_TOKEN:4002,INVALID_MEETING_ID:4003,INVALID_PARTICIPANT_ID:4004,DUPLICATE_PARTICIPANT:4005,ACCOUNT_DEACTIVATED:4006,ACCOUNT_DISCONTINUED:4007,INVALID_PERMISSIONS:4008,MAX_PARTCIPANT_REACHED:4009,MAX_SPEAKER_REACHED:4010,START_RECORDING_FAILED:4011,STOP_RECORDING_FAILED:4012,START_LIVESTREAM_FAILED:4013,STOP_LIVESTREAM_FAILED:4014,INVALID_LIVESTREAM_CONFIG:4015,START_HLS_FAILED:4016,STOP_HLS_FAILED:4017,RECORDING_FAILED:5001,LIVESTREAM_FAILED:5002,HLS_FAILED:5003,ERROR_GET_VIDEO_MEDIA:3011,ERROR_GET_AUDIO_MEDIA:3012,ERROR_GET_DISPLAY_MEDIA:3013,ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:3014,ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:3015,ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:3016},n={ERROR_GET_VIDEO_MEDIA:{code:3011,message:"Your browser/Device does not support Video."},ERROR_GET_AUDIO_MEDIA:{code:3012,message:"Your browser/Device does not support Audio."},ERROR_GET_DISPLAY_MEDIA:{code:3013,message:"Your browser/Device does not support Screen Sharing."},ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:{code:3014,message:"Video capture permission denied."},ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:{code:3015,message:"Audio capture permission denied."},ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:{code:3016,message:"Screen sharing permission denied."}}},3430:(e,t,r)=>{"use strict";r.d(t,{S:()=>a});var a={CONFERENCE:"CONFERENCE",VIEWER:"VIEWER"}},2395:(e,t,r)=>{"use strict";r.r(t),r.d(t,{VideoSDK:()=>St,ZujoSDK:()=>kt});var a=r(5861),n=r(5671),i=r(3144),s=r(4942),o=r(7757),c=r.n(o),d=r(1206),p=r.n(d);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var m="function"==typeof Symbol&&Symbol.observable||"@@observable",f=function(){return Math.random().toString(36).substring(7).split("").join(".")},_={INIT:"@@redux/INIT"+f(),REPLACE:"@@redux/REPLACE"+f(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+f()}};function v(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function g(e,t,r){var a;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error(h(0));if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error(h(1));return r(g)(e,t)}if("function"!=typeof e)throw new Error(h(2));var n=e,i=t,s=[],o=s,c=!1;function d(){o===s&&(o=s.slice())}function p(){if(c)throw new Error(h(3));return i}function l(e){if("function"!=typeof e)throw new Error(h(4));if(c)throw new Error(h(5));var t=!0;return d(),o.push(e),function(){if(t){if(c)throw new Error(h(6));t=!1,d();var r=o.indexOf(e);o.splice(r,1),s=null}}}function u(e){if(!v(e))throw new Error(h(7));if(void 0===e.type)throw new Error(h(8));if(c)throw new Error(h(9));try{c=!0,i=n(i,e)}finally{c=!1}for(var t=s=o,r=0;r<t.length;r++){(0,t[r])()}return e}function f(e){if("function"!=typeof e)throw new Error(h(10));n=e,u({type:_.REPLACE})}function y(){var e,t=l;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(h(11));function r(){e.next&&e.next(p())}return r(),{unsubscribe:t(r)}}})[m]=function(){return this},e}return u({type:_.INIT}),(a={dispatch:u,subscribe:l,getState:p,replaceReducer:f})[m]=y,a}function y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function b(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),a=function(){throw new Error(h(15))},n={getState:r.getState,dispatch:function(){return a.apply(void 0,arguments)}},i=t.map((function(e){return e(n)}));return a=y.apply(void 0,i)(r.dispatch),u(u({},r),{},{dispatch:a})}}}function w(e){return function(t){var r=t.dispatch,a=t.getState;return function(t){return function(n){return"function"==typeof n?n(r,a,e):t(n)}}}}var S=w();S.withExtraArgument=w;const k=S;var R=r(3196),P=r.n(R);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T={url:null,state:"new",activeSpeakerId:null,statsPeerId:null,faceDetection:!1};const x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_URL":var r=t.payload.url;return C(C({},e),{},{url:r});case"SET_ROOM_STATE":var a=t.payload.state;return C(C({},e),{},"connected"===a?{state:a}:{state:a,activeSpeakerId:null,statsPeerId:null});case"SET_ROOM_ACTIVE_SPEAKER":var n=t.payload.peerId;return C(C({},e),{},{activeSpeakerId:n});case"SET_ROOM_STATS_PEER_ID":var i=t.payload.peerId;return e.statsPeerId===i?C(C({},e),{},{statsPeerId:null}):C(C({},e),{},{statsPeerId:i});case"SET_FACE_DETECTION":var s=t.payload;return C(C({},e),{},{faceDetection:s});case"REMOVE_PEER":var o=t.payload.peerId,c=C({},e);return o&&o===e.activeSpeakerId&&(c.activeSpeakerId=null),o&&o===e.statsPeerId&&(c.statsPeerId=null),c;default:return e}};function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O={id:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1};const M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?I(I({},e),{},{webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}):e;case"SET_ME":var a=t.payload,n=a.peerId,i=a.displayName,s=a.displayNameSet,o=a.device;return I(I({},e),{},{id:n,displayName:i,displayNameSet:s,device:o});case"SET_MEDIA_CAPABILITIES":var c=t.payload,d=c.canSendMic,p=c.canSendWebcam;return I(I({},e),{},{canSendMic:d,canSendWebcam:p});case"SET_CAN_CHANGE_WEBCAM":var l=t.payload;return I(I({},e),{},{canChangeWebcam:l});case"SET_WEBCAM_IN_PROGRESS":var u=t.payload.flag;return I(I({},e),{},{webcamInProgress:u});case"SET_SHARE_IN_PROGRESS":var h=t.payload.flag;return I(I({},e),{},{shareInProgress:h});case"SET_DISPLAY_NAME":var m=t.payload.displayName;return m||(m=e.displayName),I(I({},e),{},{displayName:m,displayNameSet:!0});case"SET_AUDIO_ONLY_STATE":var f=t.payload.enabled;return I(I({},e),{},{audioOnly:f});case"SET_AUDIO_ONLY_IN_PROGRESS":var _=t.payload.flag;return I(I({},e),{},{audioOnlyInProgress:_});case"SET_AUDIO_MUTED_STATE":var v=t.payload.enabled;return I(I({},e),{},{audioMuted:v});case"SET_RESTART_ICE_IN_PROGRESS":var g=t.payload.flag;return I(I({},e),{},{restartIceInProgress:g});default:return e}};function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j={};const N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_PRODUCER":var a=t.payload.producer;return L(L({},e),{},(0,s.Z)({},a.id,a));case"REMOVE_PRODUCER":var n=t.payload.producerId,i=L({},e);return delete i[n],i;case"SET_PRODUCER_PAUSED":var o=t.payload.producerId,c=e[o],d=L(L({},c),{},{paused:!0});return L(L({},e),{},(0,s.Z)({},o,d));case"SET_PRODUCER_RESUMED":var p=t.payload.producerId,l=e[p],u=L(L({},l),{},{paused:!1});return L(L({},e),{},(0,s.Z)({},p,u));case"SET_PRODUCER_TRACK":var h=t.payload,m=h.producerId,f=h.track,_=e[m],v=L(L({},_),{},{track:f});return L(L({},e),{},(0,s.Z)({},m,v));case"SET_PRODUCER_SCORE":var g=t.payload,y=g.producerId,b=g.score,w=e[y];if(!w)return e;var S=L(L({},w),{},{score:b});return L(L({},e),{},(0,s.Z)({},y,S));default:return e}};function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var W={};const V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_DATA_PRODUCER":var a=t.payload.dataProducer;return F(F({},e),{},(0,s.Z)({},a.id,a));case"REMOVE_DATA_PRODUCER":var n=t.payload.dataProducerId,i=F({},e);return delete i[n],i;default:return e}};var U=r(907);var H=r(181);function z(e){return function(e){if(Array.isArray(e))return(0,U.Z)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,H.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var q={};function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Q={};function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X={};var ee=[];const te=function(e){for(var t=Object.keys(e),r={},a=0;a<t.length;a++){var n=t[a];0,"function"==typeof e[n]&&(r[n]=e[n])}var i,s=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:_.INIT}))throw new Error(h(12));if(void 0===r(void 0,{type:_.PROBE_UNKNOWN_ACTION()}))throw new Error(h(13))}))}(r)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var a=!1,n={},o=0;o<s.length;o++){var c=s[o],d=r[c],p=e[c],l=d(p,t);if(void 0===l){t&&t.type;throw new Error(h(14))}n[c]=l,a=a||l!==p}return(a=a||s.length!==Object.keys(e).length)?n:e}}({room:x,me:M,producers:N,dataProducers:V,peers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_PEER":var a=t.payload.peer;return G(G({},e),{},(0,s.Z)({},a.id,a));case"REMOVE_PEER":var n=t.payload.peerId,i=G({},e);return delete i[n],i;case"SET_PEER_DISPLAY_NAME":var o=t.payload,c=o.displayName,d=o.peerId,p=e[d];if(!p)throw new Error("no Peer found");var l=G(G({},p),{},{displayName:c});return G(G({},e),{},(0,s.Z)({},l.id,l));case"ADD_CONSUMER":var u=t.payload,h=u.consumer,m=u.peerId,f=e[m];if(!f)throw new Error("no Peer found for new Consumer");var _=[].concat(z(f.consumers),[h.id]),v=G(G({},f),{},{consumers:_});return G(G({},e),{},(0,s.Z)({},v.id,v));case"REMOVE_CONSUMER":var g=t.payload,y=g.consumerId,b=g.peerId,w=e[b];if(!w)return e;var S=w.consumers.indexOf(y);if(-1===S)throw new Error("Consumer not found");var k=w.consumers.slice();k.splice(S,1);var R=G(G({},w),{},{consumers:k});return G(G({},e),{},(0,s.Z)({},R.id,R));case"ADD_DATA_CONSUMER":var P=t.payload,E=P.dataConsumer,C=P.peerId;if(!C)return e;var T=e[C];if(!T)throw new Error("no Peer found for new DataConsumer");var x=[].concat(z(T.dataConsumers),[E.id]),D=G(G({},T),{},{dataConsumers:x});return G(G({},e),{},(0,s.Z)({},D.id,D));case"REMOVE_DATA_CONSUMER":var I=t.payload,O=I.dataConsumerId,M=I.peerId;if(!M)return e;var A=e[M];if(!A)return e;var L=A.dataConsumers.indexOf(O);if(-1===L)throw new Error("DataConsumer not found");var j=A.dataConsumers.slice();j.splice(L,1);var N=G(G({},A),{},{dataConsumers:j});return G(G({},e),{},(0,s.Z)({},N.id,N));default:return e}},consumers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_CONSUMER":var a=t.payload.consumer;return $($({},e),{},(0,s.Z)({},a.id,a));case"REMOVE_CONSUMER":var n=t.payload.consumerId,i=$({},e);return delete i[n],i;case"SET_CONSUMER_PAUSED":var o,c=t.payload,d=c.consumerId,p=c.originator,l=e[d];return o=$($({},l),{},"local"===p?{locallyPaused:!0}:{remotelyPaused:!0}),$($({},e),{},(0,s.Z)({},d,o));case"SET_CONSUMER_RESUMED":var u,h=t.payload,m=h.consumerId,f=h.originator,_=e[m];return u=$($({},_),{},"local"===f?{locallyPaused:!1}:{remotelyPaused:!1}),$($({},e),{},(0,s.Z)({},m,u));case"SET_CONSUMER_CURRENT_LAYERS":var v=t.payload,g=v.consumerId,y=v.spatialLayer,b=v.temporalLayer,w=e[g],S=$($({},w),{},{currentSpatialLayer:y,currentTemporalLayer:b});return $($({},e),{},(0,s.Z)({},g,S));case"SET_CONSUMER_PREFERRED_LAYERS":var k=t.payload,R=k.consumerId,P=k.spatialLayer,E=k.temporalLayer,C=e[R],T=$($({},C),{},{preferredSpatialLayer:P,preferredTemporalLayer:E});return $($({},e),{},(0,s.Z)({},R,T));case"SET_CONSUMER_PRIORITY":var x=t.payload,D=x.consumerId,I=x.priority,O=e[D],M=$($({},O),{},{priority:I});return $($({},e),{},(0,s.Z)({},D,M));case"SET_CONSUMER_TRACK":var A=t.payload,L=A.consumerId,j=A.track,N=e[L],B=$($({},N),{},{track:j});return $($({},e),{},(0,s.Z)({},L,B));case"SET_CONSUMER_SCORE":var F=t.payload,W=F.consumerId,V=F.score,U=e[W];if(!U)return e;var H=$($({},U),{},{score:V});return $($({},e),{},(0,s.Z)({},W,H));default:return e}},dataConsumers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_DATA_CONSUMER":var a=t.payload.dataConsumer;return J(J({},e),{},(0,s.Z)({},a.id,a));case"REMOVE_DATA_CONSUMER":var n=t.payload.dataConsumerId,i=J({},e);return delete i[n],i;default:return e}},notifications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_NOTIFICATION":var r=t.payload.notification;return[].concat(z(e),[r]);case"REMOVE_NOTIFICATION":var a=t.payload.notificationId;return e.filter((function(e){return e.id!==a}));case"REMOVE_ALL_NOTIFICATIONS":return[];default:return e}}});var re=r(3029);function ae(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function ne(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,ae(e,t,"get"))}function ie(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,ae(e,t,"set"),r),r}var se=r(7187),oe=r(885),ce=(r(3029).default,(0,i.Z)((function e(){(0,n.Z)(this,e),this.roomClient=null}))),de=new(function(){function e(){(0,n.Z)(this,e),e.instance||(e.instance=new ce)}return(0,i.Z)(e,[{key:"getInstance",value:function(){return e.instance}}]),e}());Object.freeze(de);var pe=de.getInstance(),le=function(){function e(t){(0,n.Z)(this,e),this.id=t.id,this.kind=t.track.kind,this.codec=t.codec,this.track=t.track,this.producerOrConsumer=t.instance,t.appData&&!0===t.appData.share&&"video"===t.track.kind&&(this.kind="share"),t.appData&&!0===t.appData.share&&"audio"===t.track.kind&&(this.kind="shareAudio")}return(0,i.Z)(e,[{key:"pause",value:function(){pe.roomClient._pauseConsumer(this.producerOrConsumer)}},{key:"resume",value:function(){pe.roomClient._resumeConsumer(this.producerOrConsumer)}},{key:"paused",get:function(){return this.producerOrConsumer.paused}}]),e}();function ue(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return he(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw i}}}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var me="stream-enabled",fe="stream-disabled",_e="media-status-changed",ve="video-quality-changed",ge=function(){function e(t){(0,n.Z)(this,e),this.id=t.id,this.displayName=t.displayName,this.streams=new Map,this.quality="low",this.local=t.local||!1,this.pinState={cam:!1,share:!1},this.webcamOn=!1,this.micOn=!1,this.mode=t.mode,this.eventEmitter=new se.EventEmitter}var t,r,s,o;return(0,i.Z)(e,[{key:"_setPinState",value:function(e){null!=e.cam&&(this.pinState.cam=e.cam),null!=e.share&&(this.pinState.share=e.share)}},{key:"remove",value:function(){pe.roomClient.removePeer(this.id)}},{key:"enableMic",value:function(){pe.roomClient.enablePeerMic(this.id)}},{key:"disableMic",value:function(){pe.roomClient.disablePeerMic(this.id)}},{key:"enableWebcam",value:function(){pe.roomClient.enablePeerWebcam(this.id)}},{key:"disableWebcam",value:function(){pe.roomClient.disablePeerWebcam(this.id)}},{key:"addStream",value:function(e){this.streams.set(e.id,e),"video"!==e.kind||this.local||pe.roomClient.setConsumerQuality(e.id,this.quality),this.eventEmitter.emit(me,e)}},{key:"updateStream",value:function(e){this.streams.set(e.id,e),this.eventEmitter.emit(me,e)}},{key:"deleteStream",value:function(e){var t=this.streams.get(e);if(null!=t)return this.streams.delete(e),this.eventEmitter.emit(fe,t),t}},{key:"updateParticipantMediaState",value:function(e,t){"audio"==e?this.micOn=t:"video"==e&&(this.webcamOn=t),this.eventEmitter.emit(_e,{peerId:this.id,kind:e,newStatus:t})}},{key:"videoQualityChanged",value:function(e,t){this.eventEmitter.emit(ve,{peerId:this.id,prevQuality:e,currentQuality:t})}},{key:"setQuality",value:function(e){this.quality===e||this.local||(this.quality=e,z(this.streams.entries()).forEach((function(t){var r=t[1];"video"===r.kind&&pe.roomClient.setConsumerQuality(r.id,e)})))}},{key:"setViewPort",value:function(e,t){z(this.streams.entries()).forEach((function(r){var a=r[1];"video"===a.kind&&pe.roomClient.setViewPort(a.producerOrConsumer,e,t)}))}},{key:"pin",value:function(e){switch(e){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!0,share:!0});break;case"CAM":this._setPinState({cam:!0});break;case"SHARE":this._setPinState({share:!0});break;default:throw new Error("Unknown pin type")}pe.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"unpin",value:function(e){switch(e){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!1,share:!1});break;case"CAM":this._setPinState({cam:!1});break;case"SHARE":this._setPinState({share:!1});break;default:throw new Error("Unknown unpin type")}pe.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"switchTo",value:(o=(0,a.Z)(c().mark((function e(t){var r,a,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,a=t.payload,n=t.token,e.next=3,pe.roomClient.switchPeerRoom({peerId:this.id,roomId:r,payload:a,token:n});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getVideoStats",value:(s=(0,a.Z)(c().mark((function e(){var t,r,a,n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.local){e.next=6;break}return e.next=3,pe.roomClient.getVideoRemoteStats();case 3:return e.abrupt("return",e.sent);case 6:t=z(this.streams.entries()),r=ue(t),e.prev=8,r.s();case 10:if((a=r.n()).done){e.next=18;break}if(n=(0,oe.Z)(a.value,2),i=n[0],"video"!=n[1].kind){e.next=16;break}return e.next=15,pe.roomClient.getConsumerRemoteStats(i);case 15:return e.abrupt("return",e.sent);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),r.e(e.t0);case 23:return e.prev=23,r.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[8,20,23,26]])}))),function(){return s.apply(this,arguments)})},{key:"getShareStats",value:(r=(0,a.Z)(c().mark((function e(){var t,r,a,n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.local){e.next=6;break}return e.next=3,pe.roomClient.getShareRemoteStats();case 3:return e.abrupt("return",e.sent);case 6:t=z(this.streams.entries()),r=ue(t),e.prev=8,r.s();case 10:if((a=r.n()).done){e.next=18;break}if(n=(0,oe.Z)(a.value,2),i=n[0],"share"!=n[1].kind){e.next=16;break}return e.next=15,pe.roomClient.getConsumerRemoteStats(i);case 15:return e.abrupt("return",e.sent);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),r.e(e.t0);case 23:return e.prev=23,r.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[8,20,23,26]])}))),function(){return r.apply(this,arguments)})},{key:"getAudioStats",value:(t=(0,a.Z)(c().mark((function e(){var t,r,a,n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.local){e.next=6;break}return e.next=3,pe.roomClient.getAudioRemoteStats();case 3:return e.abrupt("return",e.sent);case 6:t=z(this.streams.entries()),r=ue(t),e.prev=8,r.s();case 10:if((a=r.n()).done){e.next=18;break}if(n=(0,oe.Z)(a.value,2),i=n[0],"audio"!=n[1].kind){e.next=16;break}return e.next=15,pe.roomClient.getConsumerRemoteStats(i);case 15:return e.abrupt("return",e.sent);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),r.e(e.t0);case 23:return e.prev=23,r.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[8,20,23,26]])}))),function(){return t.apply(this,arguments)})},{key:"consumeMicStreams",value:function(){pe.roomClient.consumeMicStreams(this.id)}},{key:"consumeWebcamStreams",value:function(){pe.roomClient.consumeWebcamStreams(this.id)}},{key:"stopConsumingWebcamStreams",value:function(){pe.roomClient.stopConsumingWebcamStreams(this.id)}},{key:"stopConsumingMicStreams",value:function(){pe.roomClient.stopConsumingMicStreams(this.id)}},{key:"on",value:function(e,t){switch(e){case me:case fe:case _e:case ve:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case me:case fe:case _e:case ve:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}}]),e}();function ye(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var be=new WeakMap,we=function(){function e(t,r){var a=t.id,i=t.displayName;(0,n.Z)(this,e),ye(this,be,{writable:!0,value:void 0}),this.id=a,this.displayName=i,ie(this,be,r)}var t;return(0,i.Z)(e,[{key:"switchTo",value:(t=(0,a.Z)(c().mark((function e(t){var r,a,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,a=t.payload,n=t.token,e.next=3,pe.roomClient.connectionSwitchPeerRoom({roomId:r,connectionRoomId:ne(this,be),payload:a,peerId:this.id,token:n});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Se="participant-joined",ke="participant-left",Re="chat-message",Pe=function(){function e(t,r){var a=this;(0,n.Z)(this,e),this.eventEmitter=new se.EventEmitter,this.id=t,this.participants=new Map,r.forEach((function(e){a.participants.set(e.id,new we(e,a.id))}))}var t;return(0,i.Z)(e,[{key:"participantJoin",value:function(e){var t=new we(e,this.id);this.participants.set(e.id,t),this.eventEmitter.emit(Se,t)}},{key:"participantLeft",value:function(e){this.participants.delete(e),this.eventEmitter.emit(ke,e)}},{key:"sendChatMessage",value:function(e){pe.roomClient.connectionSendChatMessage({roomId:this.id,message:e})}},{key:"sendChatMessageEvent",value:function(e){var t=e.participantId,r=e.message;this.eventEmitter.emit(Re,{participantId:t,message:r})}},{key:"end",value:(t=(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.roomClient.connectionEndMeeting({roomId:this.id});case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"on",value:function(e,t){switch(e){case Se:case ke:case Re:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case Se:case ke:case Re:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}}]),e}(),Ee=function(){function e(t){var r=t.roomId,a=t.peers,i=t.payload;(0,n.Z)(this,e),this.id=r,this.payload=i,this.meeting=new Pe(r,a)}return(0,i.Z)(e,[{key:"close",value:function(){pe.roomClient.closeConnection(this.id)}}]),e}();function Ce(e,t){Te(e,t),t.add(e)}function Te(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function xe(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var De="error",Ie="meeting-joined",Oe="meeting-left",Me="participant-mode-changed",Ae="participant-joined",Le="participant-left",je="speaker-changed",Ne="presenter-changed",Be="main-participant-changed",Fe="chat-message",We="entry-requested",Ve="entry-responded",Ue="recording-state-changed",He="recording-started",ze="recording-stopped",Ze="livestream-state-changed",Ge="livestream-started",qe="livestream-stopped",Ke="hls-state-changed",$e="hls-started",Qe="hls-stopped",Ye="whiteboard-started",Je="whiteboard-stopped",Xe="video-state-changed",et="video-seeked",tt="mic-requested",rt="webcam-requested",at="stream-enabled",nt="stream-disabled",it="pin-state-changed",st="connection-open",ot="connection-close",ct="switch-meeting",dt="meeting-state-changed",pt=new WeakMap,lt=new WeakSet,ut=new WeakSet,ht=function(){function e(t,r,i){var o,d,p,l,u,h,m=this;(0,n.Z)(this,e),Ce(this,ut),Ce(this,lt),p={writable:!0,value:void 0},Te(o=this,d=pt),d.set(o,p),(0,s.Z)(this,"pubSub",{publish:(h=(0,a.Z)(c().mark((function e(t,r,a){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.roomClient.pubsubPublish(t,r,a);case 2:case"end":return e.stop()}}),e)}))),function(e,t,r){return h.apply(this,arguments)}),subscribe:(u=(0,a.Z)(c().mark((function e(t,r){var a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ne(m,pt).listeners(t).includes(r)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,m.roomClient.pubsubSubscribe(t);case 4:return a=e.sent,ne(m,pt).on(t,r),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return u.apply(this,arguments)}),unsubscribe:(l=(0,a.Z)(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ne(m,pt).off(t,r),0!=ne(m,pt).listeners(t).length){e.next=4;break}return e.next=4,m.roomClient.pubsubUnsubscribe(t);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return l.apply(this,arguments)})}),this.id=t,this.roomClient=i,this.activeSpeakerId=null,this.activePresenterId=null,this.mainParticipantId=null,this.connections=new Map,this.localParticipant=r,this.participants=new Map,this.baseUrl=null,this.messages=[],this.eventEmitter=new se.EventEmitter,ie(this,pt,new se.EventEmitter),this.eventEmitter.setMaxListeners(9999),ne(this,pt).setMaxListeners(9999),this.roomClient.on("ERROR",(function(e){return m.handleError(e)})),this.roomClient.on("ADD_PEER",(function(e){return m.handlePeerAdd(e)})),this.roomClient.on("REMOVE_PEER",(function(e){return m.handlePeerRemove(e)})),this.roomClient.on("ADD_PRODUCER",(function(e){return m.handleProducerAdd(e)})),this.roomClient.on("UPDATE_PRODUCER",(function(e){return m.handleUpdateProducer(e)})),this.roomClient.on("REMOVE_PRODUCER",(function(e){return m.handleProducerRemove(e)})),this.roomClient.on("ADD_CONSUMER",(function(e){return m.handleConsumerAdd(e)})),this.roomClient.on("REMOVE_CONSUMER",(function(e){return m.handleConsumerRemove(e)})),this.roomClient.on("PARTICIPANT_MEDIA_STATE_CHANGED",(function(e){return m.handleParticipantMediaStateChanged(e)})),this.roomClient.on("CHAT_MESSAGE",(function(e){return m.handleNewChatMessage(e)})),this.roomClient.on("SET_ROOM_ACTIVE_SPEAKER",(function(e){return m.handleSpeakerChange(e)})),this.roomClient.on("ENTRY_REQUESTED",(function(e){return m.handleEntryRequested(e)})),this.roomClient.on("ENTRY_RESPONDED",(function(e){return m.handleEntryResponded(e)})),this.roomClient.on("MEETING_JOINED",(function(e){return m.handleMeetingJoined(e)})),this.roomClient.on("MEETING_LEFT",(function(e){return m.handleMeetingLeft(e)})),this.roomClient.on("RECORDING_STATE_CHANGED",(function(e){m.handleRecordingStateChanged(e)})),this.roomClient.on("RECORDING_STARTED",(function(e){return m.handleRecordingStarted(e)})),this.roomClient.on("RECORDING_STOPPED",(function(e){return m.handleRecordingStopped(e)})),this.roomClient.on("LIVESTREAM_STATE_CHANGED",(function(e){m.handleLivestreamStateChanged(e)})),this.roomClient.on("LIVESTREAM_STARTED",(function(e){return m.handleLivestreamStarted(e)})),this.roomClient.on("LIVESTREAM_STOPPED",(function(e){return m.handleLivestreamStopped(e)})),this.roomClient.on("HLS_STATE_CHANGED",(function(e){m.handleHlsStateChanged(e)})),this.roomClient.on("HLS_STARTED",(function(e){m.handleHlsStarted(e)})),this.roomClient.on("HLS_STOPPED",(function(e){m.handleHlsStopped(e)})),this.roomClient.on("WHITEBOARD_STARTED",(function(e){return m.handleWhiteboardStarted(e)})),this.roomClient.on("WHITEBOARD_STOPPED",(function(e){return m.handleWhiteboardStopped(e)})),this.roomClient.on("VIDEO_STATE_CHANGED",(function(e){return m.handleVideoStateChanged(e)})),this.roomClient.on("VIDEO_SEEKED",(function(e){return m.handleVideoSeeked(e)})),this.roomClient.on("PIN_STATE_CHANGED",(function(e){m.handlePinStateChanged(e)})),this.roomClient.on("MIC_REQUESTED",(function(e){return m.handleMicRequested(e)})),this.roomClient.on("WEBCAM_REQUESTED",(function(e){return m.handleWebcamRequested(e)})),this.roomClient.on("CONNECTION_OPEN",(function(e){return m.handleConnectionOpen(e)})),this.roomClient.on("CONNECTION_CLOSE",(function(e){return m.handleConnectionClose(e)})),this.roomClient.on("CONNECTION_PARTICIPANT_JOIN",(function(e){return m.handleConnectionParticipantJoin(e)})),this.roomClient.on("SWITCH_ROOM",(function(e){return m.handleSwitchMeeting(e)})),this.roomClient.on("CONNECTION_CHAT_MESSAGE",(function(e){return m.handleConnectionChatMessage(e)})),this.roomClient.on("CONNECTION_PARTICIPANT_LEFT",(function(e){m.handleConnectionParticipantLeft(e)})),this.roomClient.on("PUBSUB_MESSAGE",(function(e){return xe(m,lt,mt).call(m,e)})),this.roomClient.on("PEER_MODE_CHANGED",(function(e){return xe(m,ut,ft).call(m,e)})),this.updateMainParticipant(this.localParticipant.id),this.roomClient.on("MEETING_STATE_CHANGED",(function(e){return m.handleMeetingStateChanged(e)})),this.roomClient.on("VIDEO_QUALITY_CHANGED",(function(e){return m.handleVideoQualityChanged(e)}))}var t,r,o,d,p,l,u,h;return(0,i.Z)(e,[{key:"handleError",value:function(e){this.eventEmitter.emit(De,e)}},{key:"join",value:function(){this.roomClient.join()}},{key:"changeMode",value:function(e){this.roomClient.changeMode(e)}},{key:"leave",value:function(){this.roomClient.close({sendLeft:!0})}},{key:"end",value:function(){this.roomClient.closeRoom()}},{key:"respondEntry",value:function(e,t){this.roomClient.respondEntry(e,t)}},{key:"pinnedParticipants",get:function(){return this.roomClient._pinnedParticipants}},{key:"muteMic",value:function(){this.roomClient.disableMic()}},{key:"unmuteMic",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableMic(e)}},{key:"publishAudio",value:(h=(0,a.Z)(c().mark((function e(){var t,r=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:void 0,e.next=3,this.roomClient.enableMic(t);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"unpublishAudio",value:(u=(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roomClient.disableMic();case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"disableWebcam",value:function(){this.roomClient.disableWebcam()}},{key:"enableWebcam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableWebcam(e)}},{key:"publishVideo",value:(l=(0,a.Z)(c().mark((function e(){var t,r=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:void 0,this.roomClient.enableWebcam(t),e.abrupt("return");case 3:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"unpublishVideo",value:(p=(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.roomClient.disableWebcam(),e.abrupt("return");case 2:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"disableScreenShare",value:function(){this.roomClient.disableShare()}},{key:"enableScreenShare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableShare(e)}},{key:"pubblishScreenShare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableShare(e)}},{key:"unpublishScreenShare",value:function(){this.roomClient.disableShare()}},{key:"sendChatMessage",value:function(e){this.roomClient.sendChatMessage(e);var t={text:e,timestamp:(new Date).getTime(),senderId:this.localParticipant.id,senderName:this.localParticipant.displayName};this.handleNewChatMessage(t)}},{key:"startRecording",value:function(e,t,r){this.roomClient.startRecording(e,t,r)}},{key:"stopRecording",value:function(){this.roomClient.stopRecording()}},{key:"startLivestream",value:function(e,t){this.roomClient.startLivestream(e,t)}},{key:"stopLivestream",value:function(){this.roomClient.stopLivestream()}},{key:"startHls",value:(d=(0,a.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roomClient.startHls(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"stopHls",value:function(){this.roomClient.stopHls()}},{key:"getMics",value:(o=(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roomClient.getMics();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getWebcams",value:(r=(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roomClient.getWebcams();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"changeMic",value:function(e){this.roomClient.changeMic(e)}},{key:"changeWebcam",value:function(e){this.roomClient.changeWebcam(e)}},{key:"setWebcamQuality",value:function(e){this.roomClient.setWebcamQuality(e)}},{key:"startWhiteboard",value:function(){this.roomClient.startWhiteboard()}},{key:"stopWhiteboard",value:function(){this.roomClient.stopWhiteboard()}},{key:"startVideo",value:function(e){var t=e.link;this.roomClient.startVideo({link:t})}},{key:"stopVideo",value:function(){this.roomClient.stopVideo()}},{key:"resumeVideo",value:function(){this.roomClient.resumeVideo()}},{key:"refreshConnection",value:function(){this.roomClient.restartIce()}},{key:"pauseVideo",value:function(e){var t=e.currentTime;this.roomClient.pauseVideo(t)}},{key:"seekVideo",value:function(e){var t=e.currentTime;this.roomClient.seekVideo(t)}},{key:"handlePeerAdd",value:function(e){var t=e.peer,r=new ge(t);this.participants.set(r.id,r),this.eventEmitter.emit(Ae,r),1===this.participants.size&&this.updateMainParticipant(r.id)}},{key:"handlePeerRemove",value:function(e){var t=e.peerId,r=this.participants.get(t);null!=r&&(this.participants.delete(t),this.eventEmitter.emit(Le,r),this.activePresenterId===r.id&&(this.activePresenterId=null,this.eventEmitter.emit(Ne,this.activePresenterId)),this.mainParticipantId===r.id&&(this.participants.size>0?this.updateMainParticipant(this.participants.entries().next().value[1].id):this.updateMainParticipant(this.localParticipant.id)))}},{key:"handleProducerAdd",value:function(e){var t=e.producer,r=new le(t);this.localParticipant.addStream(r),"share"===r.kind&&(this.activePresenterId=this.localParticipant.id,this.eventEmitter.emit(Ne,this.activePresenterId),this.updateMainParticipant(this.localParticipant.id))}},{key:"handleUpdateProducer",value:function(e){var t=e.producer,r=new le(t);this.localParticipant.updateStream(r)}},{key:"handleProducerRemove",value:function(e){var t=e.producerId,r=this.localParticipant.deleteStream(t);if(r&&"share"===r.kind){this.activePresenterId=null,this.eventEmitter.emit(Ne,this.activePresenterId);var a=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||a||this.localParticipant.id)}}},{key:"handleConsumerAdd",value:function(e){var t=e.consumer,r=e.peerId,a=this.participants.get(r);if(a){var n=new le(t);a.addStream(n),this.eventEmitter.emit(at,n),"share"===n.kind&&(this.activePresenterId=a.id,this.eventEmitter.emit(Ne,this.activePresenterId),this.updateMainParticipant(a.id))}}},{key:"handleConsumerRemove",value:function(e){var t=e.consumerId,r=e.peerId,a=this.participants.get(r);if(null!=a&&a){var n=a.deleteStream(t);if(this.eventEmitter.emit(nt,n),n&&"share"===n.kind){this.activePresenterId=null,this.eventEmitter.emit(Ne,this.activePresenterId);var i=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||i||this.localParticipant.id)}}}},{key:"handleParticipantMediaStateChanged",value:function(e){var t=e.peerId,r=e.kind,a=e.newState,n=this.participants.get(t);n&&n&&("audio"==r?n.micOn=a:"video"==r&&(n.webcamOn=a),n.updateParticipantMediaState(r,a))}},{key:"handleSpeakerChange",value:function(e){var t=e.peerId;this.activeSpeakerId!==t&&(this.activeSpeakerId=t,this.eventEmitter.emit(je,t),t&&t!==this.localParticipant.id&&this.activePresenterId!==this.mainParticipantId&&t!==this.mainParticipantId&&this.updateMainParticipant(t))}},{key:"handleNewChatMessage",value:function(e){var t=e.senderId,r={senderId:t,text:e.text,timestamp:e.timestamp};if(this.localParticipant.id===t)r.senderName=this.localParticipant.displayName;else{var a=this.participants.get(t);a&&(r.senderName=a.displayName)}this.messages.push(r),this.eventEmitter.emit(Fe,r)}},{key:"updateMainParticipant",value:function(e){this.mainParticipantId=e;var t=null;t=e===this.localParticipant.id?this.localParticipant:this.participants.get(this.mainParticipantId),this.eventEmitter.emit(Be,t)}},{key:"handleEntryRequested",value:function(e){var t=this,r=e.id,a=e.name;this.eventEmitter.emit(We,{participantId:r,name:a,allow:function(){t.roomClient.respondEntry(r,"allowed")},deny:function(){t.roomClient.respondEntry(r,"denied")}})}},{key:"handleEntryResponded",value:function(e){var t=e.id,r=e.decision;this.eventEmitter.emit(Ve,t,r)}},{key:"handleMeetingJoined",value:function(e){var t=e.peers,r=e.poll,a=e.messages,n=e.baseUrl;this.baseUrl=n,a.length>0&&(this.messages=a),this.eventEmitter.emit(Ie,{peers:t,poll:r,messages:a})}},{key:"handleMeetingLeft",value:function(e){this.eventEmitter.emit(Oe,e)}},{key:"handleRecordingStateChanged",value:function(e){this.eventEmitter.emit(Ue,e)}},{key:"handleLivestreamStateChanged",value:function(e){this.eventEmitter.emit(Ze,e)}},{key:"handleHlsStateChanged",value:function(e){this.eventEmitter.emit(Ke,e)}},{key:"handleRecordingStarted",value:function(){this.eventEmitter.emit(He)}},{key:"handleRecordingStopped",value:function(){this.eventEmitter.emit(ze)}},{key:"handleLivestreamStarted",value:function(){this.eventEmitter.emit(Ge)}},{key:"handleLivestreamStopped",value:function(){this.eventEmitter.emit(qe)}},{key:"handleHlsStarted",value:function(e){this.eventEmitter.emit($e,e)}},{key:"handleHlsStopped",value:function(){this.eventEmitter.emit(Qe)}},{key:"handleWhiteboardStarted",value:function(e){var t=e.state;this.eventEmitter.emit(Ye,t)}},{key:"handleWhiteboardStopped",value:function(e){!function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e),this.eventEmitter.emit(Je)}},{key:"handleVideoStateChanged",value:function(e){this.eventEmitter.emit(Xe,e)}},{key:"handleVideoSeeked",value:function(e){var t=e.currentTime;this.eventEmitter.emit(et,{currentTime:t})}},{key:"handlePinStateChanged",value:function(e){var t=e.peerId,r=e.state,a=e.pinnedBy;this.eventEmitter.emit(it,{participantId:t,state:r,pinnedBy:a})}},{key:"handleMeetingStateChanged",value:function(e){var t=e.state;this.eventEmitter.emit(dt,{state:t})}},{key:"handleVideoQualityChanged",value:function(e){var t=e.peerId,r=e.prevQuality,a=e.currentQuality,n=this.participants.get(t);n&&n&&n.videoQualityChanged(r,a)}},{key:"handleMicRequested",value:function(e){var t=this,r=e.peerId;this.eventEmitter.emit(tt,{participantId:r,accept:function(){return t.unmuteMic()},reject:function(){}})}},{key:"handleWebcamRequested",value:function(e){var t=this,r=e.peerId;this.eventEmitter.emit(rt,{participantId:r,accept:function(){return t.enableWebcam()},reject:function(){}})}},{key:"handleConnectionParticipantJoin",value:function(e){var t=e.roomId,r=e.peer,a=this.connections.get(t);null!=a&&a.meeting.participantJoin(r)}},{key:"handleConnectionParticipantLeft",value:function(e){var t=e.roomId,r=e.peerId,a=this.connections.get(t);null!=a&&a.meeting.participantLeft(r)}},{key:"handleConnectionOpen",value:function(e){var t=e.peers,r=e.roomId,a=e.payload,n=new Ee({roomId:r,peers:t,payload:a});this.connections.set(n.id,n),this.eventEmitter.emit(st,n)}},{key:"handleConnectionClose",value:function(e){var t=e.roomId;null!=this.connections.get(t)&&(this.connections.delete(t),this.eventEmitter.emit(ot,t))}},{key:"handleSwitchMeeting",value:function(e){var t=e.roomId,r=e.token,a=e.payload,n=e.peerId,i=e.connectionPeerId,s=e.connectionRoomId,o=n?{meetingId:t,payload:a,token:r,participantId:n}:{meetingId:t,payload:a,token:r,connectionParticipantId:i,connectionMeetingId:s};this.eventEmitter.emit(ct,o)}},{key:"handleConnectionChatMessage",value:function(e){var t=e.roomId,r=e.peerId,a=e.message,n=this.connections.get(t);null!=n&&n.meeting.sendChatMessageEvent({participantId:r,message:a})}},{key:"connectTo",value:(t=(0,a.Z)(c().mark((function e(t){var r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,a=t.payload,e.next=3,this.roomClient.openConnection({roomId:r,payload:a});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){switch(e){case Ae:case Le:case je:case Ne:case Be:case Fe:case We:case Ve:case Ue:case He:case ze:case Ze:case Ge:case qe:case $e:case Qe:case Ke:case at:case nt:case Ye:case Je:case Ie:case Oe:case Xe:case et:case tt:case rt:case it:case st:case ot:case ct:case dt:case Me:case De:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case Ae:case Le:case je:case Ne:case Be:case Fe:case We:case Ve:case Ue:case He:case ze:case Ze:case Ge:case qe:case Ke:case $e:case Qe:case at:case nt:case Ye:case Je:case Ie:case Oe:case Xe:case et:case tt:case rt:case it:case st:case ot:case ct:case dt:case De:case Me:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}}]),e}();function mt(e){var t=e.topic,r=e.message,a=e.senderId,n=e.timestamp,i=e.senderName,s=e.id;t&&r&&ne(this,pt).emit(t,{message:r,senderId:a,timestamp:n,topic:t,senderName:i,id:s})}function ft(e){var t=e.peerId,r=e.mode;t===this.localParticipant.id?this.localParticipant.mode=r:this.participants.get(t).mode=r,this.eventEmitter.emit(Me,{participantId:t,mode:r})}var _t=r(6900),vt=r(3430),gt=r(8962),yt=function(){var e=(0,a.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(r,a){t.call(navigator,e,r,a)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),e.next=4,navigator.mediaDevices.getUserMedia(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),bt=function(){var e=(0,a.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getDisplayMedia&&(navigator.mediaDevices.getDisplayMedia=function(e){var t=navigator.webkitGetDisplayMedia||navigator.mozGetDisplayMedia;return t?new Promise((function(r,a){t.call(navigator,e,r,a)})):Promise.reject(new Error("getDisplayMedia is not implemented in this browser"))}),e.next=4,navigator.mediaDevices.getDisplayMedia(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var wt=[k],St=function(){function e(){(0,n.Z)(this,e)}var t,r,s;return(0,i.Z)(e,null,[{key:"config",value:function(e){if(!e)throw new Error("'token' is empty, please provide it in config");this.apiKey=e;var t=g(te,void 0,b.apply(void 0,wt));window.STORE=t,re.default.init({store:t})}},{key:"analytics",value:function(e){var t,r,a,n;!e&&navigator&&navigator.userAgent&&(a=navigator.userAgent,delete(n=p().parse(a)).engine);try{var i;null!==(i=e)&&void 0!==i&&i.browserUserAgent||(a=navigator.userAgent,delete(n=p().parse(a)).engine)}catch(e){}e&&e.rawUserAgent&&(a=e.rawUserAgent,delete(n=p().parse(a)).engine),e||(e={});var s={};s.sdkType=e.sdkType||"javascript",s.sdkVersion=e.sdkVersion||"0.0.32",s.platform=e.platform||(null===(t=n)||void 0===t||null===(r=t.platform)||void 0===r?void 0:r.type)||"","null"==e.browserUserAgent?s.browserUserAgent=void 0:s.browserUserAgent=n,e.deviceUserAgent&&(s.deviceUserAgent=e.deviceUserAgent),this._deviceInfo=s}},{key:"initMeeting",value:function(e){var t,r=e.meetingId,a=e.customCameraVideoTrack,n=void 0===a?void 0:a,i=e.customMicrophoneAudioTrack,s=void 0===i?void 0:i,o=e.autoConsume,c=void 0===o||o,d=e.preferredProtocol,p=e.mode,l=e.multiStream,u=void 0===l||l,h=e.participantId,m=e.name,f=e.micEnabled,_=e.webcamEnabled,v=e.maxResolution,g=e.chatEnabled,y=e.useSpartialLayerAnalytics;if(!r)throw new Error("'meetingId' is empty, please verify it or generate new meetingId using the API.");var b=h||P()({length:8}).toLowerCase(),w=m||P()({length:6}).toLowerCase();switch(this._deviceInfo||this.analytics(),"string"!=typeof d&&(d="UDP_ONLY"),null===(t=d)||void 0===t?void 0:t.toUpperCase()){case"UDP_ONLY":case"UDP_OVER_TCP":d=d.toUpperCase();break;default:d="UDP_ONLY"}if(p||(p=vt.S.CONFERENCE),p!==vt.S.CONFERENCE&&p!==vt.S.VIEWER)throw new Error('"mode" can only be either '.concat(vt.S.CONFERENCE," or ").concat(vt.S.VIEWER));var S=new re.default({roomId:r,peerId:b,secret:this.apiKey,device:"unknown",displayName:w,mode:p,useSimulcast:u,produce:!0,consume:!0,useSharingSimulcast:!0,datachannel:!1!==g,micEnabled:!1!==f,webcamEnabled:!1!==_,maxResolution:v||"hd",useSpartialLayerAnalytics:y,_deviceInfo:this._deviceInfo,customCameraVideoTrack:n,customMicrophoneAudioTrack:s,autoConsume:c,preferredProtocol:d});pe.roomClient=S;var k=new ge({id:b,displayName:w,local:!0,mode:p});return new ht(r,k,S)}},{key:"createCameraVideoTrack",value:(s=(0,a.Z)(c().mark((function e(t){var r,a,n,i,s,o,d,p,l,u,h,m,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cameraId,a=void 0===r?void 0:r,n=t.encoderConfig,i=void 0===n?void 0:n,s=t.facingMode,o=void 0===s?void 0:s,d=t.optimizationMode,p=void 0===d?void 0:d,l=t.multiStream,u=void 0===l||l,h=i?gt.v.videoProfiles[i]:gt.v.videoProfiles.h360p_w640p,m={video:{deviceId:a||void 0,facingMode:o||void 0,width:h.width,height:h.height,aspectRatio:gt.v.aspectRatios[h.aspectRatio].value,frameRate:h.frameRate}},e.next=5,yt(m);case 5:return f=e.sent,p&&(f.contentHint=p),f.encoderConfig=i||"h360p_w640p",f.contentHint=p||"",f.multiStream=u,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"createScreenShareVideoTrack",value:(r=(0,a.Z)(c().mark((function e(t){var r,a,n,i,s,o,d,p,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.encoderConfig,a=void 0===r?void 0:r,n=t.optimizationMode,i=void 0===n?void 0:n,s=t.withAudio,o=void 0===s?"enable":s,d=a?gt.v.screenShareProfiles[a]:gt.v.screenShareProfiles.h720p_15fps,p={audio:"enable"===o,video:{width:d.width,height:d.height,frameRate:d.frameRate}},e.next=5,bt(p);case 5:return l=e.sent,i&&(l.contentHint=i),e.abrupt("return",l);case 8:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"createMicrophoneAudioTrack",value:(t=(0,a.Z)(c().mark((function e(t){var r,a,n,i,s,o,d,p,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.noiseConfig,a=void 0===r?void 0:r,n=t.encoderConfig,i=void 0===n?void 0:n,s=t.microphoneId,o=void 0===s?void 0:s,d=i?gt.v.audioProfiles[i]:gt.v.audioProfiles.speech_standard,p={audio:{deviceId:o,sampleRate:d.sampleRate,echoCancellation:a?a&&a.acousticEchoCancellation:d.echoCancellation,autoGainControl:a?a&&a.autoGainControl:d.autoGainControl,noiseSuppression:a?a&&a.noiseSuppression:d.noiseSuppression,channelCount:d.channelCount}},e.next=5,yt(p);case 5:return(l=e.sent).encoderConfig=i||"speech_standard",e.abrupt("return",l);case 8:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();(0,s.Z)(St,"Constants",{errors:_t.R,recordingEvents:{RECORDING_STARTING:"RECORDING_STARTING",RECORDING_STARTED:"RECORDING_STARTED",RECORDING_STOPPING:"RECORDING_STOPPING",RECORDING_STOPPED:"RECORDING_STOPPED"},livestreamEvents:{LIVESTREAM_STARTING:"LIVESTREAM_STARTING",LIVESTREAM_STARTED:"LIVESTREAM_STARTED",LIVESTREAM_STOPPING:"LIVESTREAM_STOPPING",LIVESTREAM_STOPPED:"LIVESTREAM_STOPPED"},hlsEvents:{HLS_STARTING:"HLS_STARTING",HLS_STARTED:"HLS_STARTED",HLS_STOPPING:"HLS_STOPPING",HLS_STOPPED:"HLS_STOPPED"},modes:vt.S});var kt=St},3029:(e,t,r)=>{"use strict";function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}r.r(t),r.d(t,{default:()=>Fe});var n=r(885),i=r(5861),s=r(5671),o=r(3144),c=r(4942),d=r(7757),p=r.n(d),l=r(9293),u=r(960),h=r(1227),m=r.n(h),f="mediasoup-demo",_=function(){function e(t){(0,s.Z)(this,e),t?(this._debug=m()("".concat(f,":").concat(t)),this._warn=m()("".concat(f,":WARN:").concat(t)),this._error=m()("".concat(f,":ERROR:").concat(t))):(this._debug=m()(f),this._warn=m()("".concat(f,":WARN")),this._error=m()("".concat(f,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,o.Z)(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}(),v=r(1354),g=v.enc.Latin1.parse("6gf9Oz5Y(6fOWPP@3XPv0Mwp51yfJ0HiZW^0*!9NdUuZ*VdKmRC@f))&^!Iriw)q"),y=v.enc.Latin1.parse("BHrabik^$W^y*HL@A*$4YKj(");function b(e){return w.apply(this,arguments)}function w(){return(w=(0,i.Z)(p().mark((function e(t){var r,a,n,i,s,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.secret,n="call-api.videosdk.live",i=[],e.next=5,fetch("https://api.videosdk.live/infra/v1/meetings/init-config",{method:"POST",headers:{Authorization:a,"Content-Type":"application/json"},body:JSON.stringify({roomId:r})}).then((function(e){return e.json()})).catch((function(e){return{}}));case 5:return s=e.sent,(o=s.data)&&(n=o.baseUrl,i=S(o.iceServers)),e.abrupt("return",{baseUrl:n,iceServers:i});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){try{var t=v.AES.decrypt(e,g,{iv:y,mode:v.mode.CBC,padding:v.pad.ZeroPadding}).toString(v.enc.Utf8);return JSON.parse(t)}catch(e){return[]}}var k=r(6808),R=r.n(k),P="mediasoup-demo.user",E="mediasoup-demo.devices";function C(e){var t=e.displayName;R().set(P,{displayName:t})}function T(){return R().getJSON(E)}var x=r(3196),D=r.n(x),I=function(e){return{type:"SET_ROOM_STATE",payload:{state:e}}},O=function(e){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerId:e}}},M=function(e){return{type:"SET_ROOM_STATS_PEER_ID",payload:{peerId:e}}},A=function(e){return{type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:e.canSendMic,canSendWebcam:e.canSendWebcam}}},L=function(e){return{type:"SET_DISPLAY_NAME",payload:{displayName:e}}},j=function(e){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:e}}},N=function(e){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:e}}},B=function(e){return{type:"SET_AUDIO_MUTED_STATE",payload:{enabled:e}}},F=function(e){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:e}}},W=function(e){return{type:"ADD_PRODUCER",payload:{producer:e}}},V=function(e){return{type:"REMOVE_PRODUCER",payload:{producerId:e}}},U=function(e,t){return{type:"SET_PRODUCER_TRACK",payload:{producerId:e,track:t}}},H=function(e,t){return{type:"SET_PRODUCER_SCORE",payload:{producerId:e,score:t}}},z=function(e){return{type:"ADD_DATA_PRODUCER",payload:{dataProducer:e}}},Z=function(e){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:e}}},G=function(e){return{type:"SET_SHARE_IN_PROGRESS",payload:{flag:e}}},q=function(e){return{type:"ADD_PEER",payload:{peer:e}}},K=function(e){return{type:"REMOVE_PEER",payload:{peerId:e}}},$=function(e,t){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:e,peerId:t}}},Q=function(e,t){return{type:"ADD_CONSUMER",payload:{consumer:e,peerId:t}}},Y=function(e,t){return{type:"REMOVE_CONSUMER",payload:{consumerId:e,peerId:t}}},J=function(e,t){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:e,originator:t}}},X=function(e,t){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:e,originator:t}}},ee=function(e,t,r){return{type:"SET_CONSUMER_CURRENT_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}},te=function(e,t,r){return{type:"SET_CONSUMER_PREFERRED_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}},re=function(e,t){return{type:"SET_CONSUMER_PRIORITY",payload:{consumerId:e,priority:t}}},ae=function(e,t){return{type:"SET_CONSUMER_SCORE",payload:{consumerId:e,score:t}}},ne=function(e,t){return{type:"ADD_DATA_CONSUMER",payload:{dataConsumer:e,peerId:t}}},ie=function(e,t){return{type:"REMOVE_DATA_CONSUMER",payload:{dataConsumerId:e,peerId:t}}},se=function(e){var t=e.type,r=void 0===t?"info":t,a=e.text,n=e.title,i=e.timeout;if(!i)switch(r){case"info":i=3e3;break;case"error":i=5e3}var s={id:D()({length:6}).toLowerCase(),type:r,title:n,text:a,timeout:i};return function(e){e(function(e){return{type:"ADD_NOTIFICATION",payload:{notification:e}}}(s)),setTimeout((function(){e({type:"REMOVE_NOTIFICATION",payload:{notificationId:s.id}})}),i)}},oe=r(7187),ce=r(8962),de={},pe={},le={};for(var ue in ce.v.videoProfiles)"oneSixNine"==ce.v.videoProfiles[ue].aspectRatio&&(de[ue]=ce.v.videoProfiles[ue],de[ue].encoding={maxBitrate:de[ue].bitRate,maxFramerate:de[ue].frameRate}),"fourThree"==ce.v.videoProfiles[ue].aspectRatio&&(pe[ue]=ce.v.videoProfiles[ue],pe[ue].encoding={maxBitrate:pe[ue].bitRate,maxFramerate:pe[ue].frameRate});for(var ue in ce.v.screenShareProfiles)le[ue]=ce.v.screenShareProfiles[ue],le[ue].encoding={maxBitrate:le[ue].bitRate,maxFramerate:le[ue].frameRate};var he=Object.values(de),me=Object.values(pe),fe=Object.values(le),_e=[de.h180p_w320p,de.h360p_w640p],ve=[pe.h180p_w240p,pe.h360p_w480p],ge=["q","h","f"];function ye(e,t,r,a){var i=a&&a.videoEncoding;e&&(i=a&&a.screenShareEncoding);var s=null==a?void 0:a.simulcast;if(i||(i=function(e,t,r){for(var a=function(e,t,r){if(e)return fe;var a=t>r?t/r:r/t;if(Math.abs(a-16/9)<Math.abs(a-4/3))return he;return me}(e,t,r),n=a[0].encoding,i=Math.max(t,r),s=0;s<a.length;s+=1){var o=a[s];if(n=o.encoding,o.width>=i)break}return n}(e,t,r)),!s)return[i];var o,c={width:t,height:r,encoding:{maxBitrate:i.maxBitrate,maxFramerate:i.maxFramerate}},d=[],p=(d=be(e,c))[0];if(d.length>1){var l=d;o=(0,n.Z)(l,2)[1]}var u=Math.max(t,r);return we(t,r,u>=960&&o?[p,o,c]:u>=480?[p,c]:[c])}function be(e,t){if(e)r=t,[{scaleResolutionDownBy:2,fps:3}].map((function(e){var t;return{width:Math.floor(r.width/e.scaleResolutionDownBy),height:Math.floor(r.height/e.scaleResolutionDownBy),encodings:{maxBitrate:Math.max(15e4,Math.floor(r.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=r.encoding.maxFramerate)&&void 0!==t?t:30)/e.fps)))),maxFramerate:e.fps}}}));var r,a=t.width,n=t.height,i=a>n?a/n:n/a;return Math.abs(i-16/9)<Math.abs(i-4/3)?_e:ve}function we(e,t,r){var a=[];return r.forEach((function(r,n){if(!(n>=ge.length)){var i=Math.min(e,t),s={rid:ge[n],scaleResolutionDownBy:i/Math.min(r.width,r.height),maxBitrate:r.encoding.maxBitrate,maxFramerate:r.encoding.maxFramerate};a.push(s)}})),a}function Se(e,t,r){if(!e)return{};var a=e.id,n=(e.preferredSpatialLayer,e.preferredTemporalLayer,e.appData),i=n.width,s=n.height,o=n.encodings;try{var c=function(e){var t=[];if(e&&0!=e.length){if(1===e.length){for(var r=0;r<3;r++)t.push(Math.pow(2,3-r-1));return t}var a=!1;return e.forEach((function(e){void 0!==e.scaleResolutionDownBy?(a=!0,t.push(Math.max(1,e.scaleResolutionDownBy))):t.push(1)})),a||e.forEach((function(r,a){t[a]=Math.pow(2,e.length-a-1)})),t}}(o);if(!c)return{};for(var d=Math.min(Math.max(ce.v.adaptiveScalingFactor||.75,.5),1),p=0,l=0;l<c.length;l++){var u=d*i/c[l],h=d*s/c[l];if(!(t>=u&&r>=h))break;p=l}var m=(e.temporalLayers?e.temporalLayers:3)-1;if(0===p&&m>0){var f=i/c[0],_=s/c[0];t<.5*f&&r<.5*_&&(m-=1),m>0&&t<.25*f&&r<.25*_&&(m-=1)}return{consumerId:a,newPreferredSpatialLayer:p,newPreferredTemporalLayer:m}}catch(e){return{}}}var ke=r(6900),Re=r(2395),Pe=r(4180),Ee=r(3430);function Ce(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Te(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Te(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw i}}}}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function De(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(r),!0).forEach((function(t){(0,c.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ie,Oe={sd:{low:{s:0,t:2},med:{s:0,t:2},high:{s:1,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}},hd:{low:{s:0,t:2},med:{s:1,t:2},high:{s:2,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}}},Me={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},sd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}},hd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}}},Ae={sd:[{scaleResolutionDownBy:6},{scaleResolutionDownBy:4},{scaleResolutionDownBy:2}],hd:[{scaleResolutionDownBy:4},{scaleResolutionDownBy:2},{scaleResolutionDownBy:1}]},Le=[{scalabilityMode:"S3T3_KEY"}],je=[{dtx:!0,maxFramerate:10}],Ne=[{scalabilityMode:"S3T3",dtx:!0}],Be=new _("RoomClient"),Fe=function(){function e(t){var r,a,n=t.roomId,i=t.peerId,o=t.secret,d=t.displayName,p=t.device,l=t.handlerName,u=t.useSimulcast,h=t.useSharingSimulcast,m=t.forceTcp,f=t.mode,_=t.forceH264,v=t.forceVP9,g=t.svc,y=t.datachannel,b=t.externalVideo,w=t.micEnabled,S=t.webcamEnabled,k=t.maxResolution,R=t.useSpartialLayerAnalytics,P=t._deviceInfo,E=t.customCameraVideoTrack,C=t.customMicrophoneAudioTrack,T=t.autoConsume,x=t.preferredProtocol;(0,s.Z)(this,e),(0,c.Z)(this,"delay",(function(e){return new Promise((function(t){return setTimeout(t,e)}))})),Be.debug('constructor() [roomId:"%s", peerId:"%s", displayName:"%s", device:%s]',n,i,d,p.flag),this.useSpartialLayerAnalytics=R||!1,this._deviceInfo=P,this._eventEmitter=new oe.EventEmitter,this._closed=!1,this._displayName=d,this._device=p,this._forceTcp=m,this._preferredProtocol=x,f==Ee.S.CONFERENCE?(r=!0,a=!0):(r=!1,a=!1),this._mode=f,this._produce=r,this._consume=a,this._useDataChannel=y,this._forceH264=Boolean(_),this._forceVP9=Boolean(v),this._micEnabled=Boolean(w),this._webcamEnabled=Boolean(S),this._externalVideo=null,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,b&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=b,this._externalVideo.play().catch((function(e){return Be.warn("externalVideo.play() failed:%o",e)}))),this._handlerName=l,this._useSimulcast=u,this._useSharingSimulcast=h,this._protooUrl="",this._secret=o,this._peerId=i,this._roomId=n,this._baseUrl="",this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._shareAudioProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._mics=new Map,this._mic={device:null},this._webcams=new Map,this._webcam={device:null,resolution:k||"hd"},this._pinnedParticipants=new Map,this._usageIntervalDuration=1,this._usageDataPointsPeerMaxRes=new Map,this._audioConsumption=0,g&&(Le[0].scalabilityMode="".concat(g,"_KEY"),Ne[0].scalabilityMode=g),this.customCameraVideoTrack=E,this.customMicrophoneAudioTrack=C,this._autoConsume=T,this._iceServers=[];this._metrics=new Pe.VideoSDKMetrics({refreshEvery:1e3,startAfter:1e3,verbose:!1}),this._collectStats="react-native"!=P.sdkType,this._stats={},this._latestStats={},this._isWebsocketAlive=!1,this._pingWebsocketInterval=null,this._pingInternetInterval=null,this._pingWebsocketFailedCounter=0,this._pongInternetCounter=0,this._transportState=""}var t,r,d,h,m,f,_,v,g,y,w,S,k,R,P,E,x,D,de,pe,le,ue,he,me,fe,_e,ve,ge,be,we,Te,xe,Fe,We,Ve,Ue,He,ze,Ze,Ge,qe,Ke,$e,Qe,Ye,Je,Xe,et,tt,rt,at,nt,it,st,ot,ct,dt,pt,lt,ut,ht,mt,ft,_t,vt,gt,yt,bt,wt,St,kt,Rt,Pt,Et,Ct,Tt,xt,Dt,It,Ot,Mt,At,Lt,jt,Nt,Bt,Ft,Wt,Vt,Ut,Ht,zt,Zt,Gt,qt;return(0,o.Z)(e,[{key:"on",value:function(e,t){this._eventEmitter.on(e,t)}},{key:"close",value:function(e){var t=e.sendLeft,r=void 0===t||t;r&&this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CLOSING"}),this._closed||(this._closed=!0,this._pingWebsocketInterval&&clearInterval(this._pingWebsocketInterval),this._pingWebsocketInterval=null,this._pingInternetInterval&&clearInterval(this._pingInternetInterval),this._pingInternetInterval=null,this._protoo.close(),this._metrics.running&&this._metrics.stopAllProbes(),Be.debug("close()"),this._usageInterval&&clearInterval(this._usageInterval),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),Ie.dispatch(I("closed")),r&&this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CLOSED"}),r&&this._eventEmitter.emit("MEETING_LEFT"))}},{key:"join",value:(qt=(0,i.Z)(p().mark((function e(){var t,r,a=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b({roomId:this._roomId,secret:this._secret});case 2:t=e.sent,this._baseUrl=t.baseUrl,this._protooUrl="wss://".concat(this._baseUrl,"/?roomId=").concat(this._roomId,"&peerId=").concat(this._peerId,"&secret=").concat(this._secret,"&mode=").concat(this._mode),this._iceServers=t.iceServers,r=new l.qo(this._protooUrl),this._protoo=new l._z(r),this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CONNECTING"}),Ie.dispatch(I("connecting")),this._protoo.on("open",(function(){a._isWebsocketAlive=!0,a._closed=!1,a.startPingPong(),a._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CONNECTED"}),a.requestEntry()})),this._protoo.on("failed",(function(){a._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"FAILED"}),Ie.dispatch(se({type:"error",text:"WebSocket connection failed"}))})),this._protoo.on("disconnected",(function(){a._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"DISCONNECTED"}),Ie.dispatch(se({type:"error",text:"WebSocket disconnected"})),a._sendTransport&&(a._sendTransport.close(),a._sendTransport=null),a._recvTransport&&(a._recvTransport.close(),a._recvTransport=null),Ie.dispatch(I("closed"))})),this._protoo.on("close",(function(){a._closed||a.close({sendLeft:!0})})),this._protoo.on("request",function(){var e=(0,i.Z)(p().mark((function e(t,r,i){var s,o,c,d,l,h,m,f,_,v,g,y,b,w,S,k,R,P,E,C,T,x,D,I,O,M,A,L,j,N,B,F,W,V,U,H,z;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Be.debug('proto "request" event [method:%s, data:%o]',t.method,t.data),e.t0=t.method,e.next="close"===e.t0?4:"newConsumer"===e.t0?6:"newDataConsumer"===e.t0?34:"enableMic"===e.t0?61:"disableMic"===e.t0?72:"enableWebcam"===e.t0?83:"disableWebcam"===e.t0?94:"pinStateChanged"===e.t0?105:"switchRoom"===e.t0?122:"statsData"===e.t0?125:"dataUsage"===e.t0?128:137;break;case 4:return a.close({sendLeft:!0}),e.abrupt("break",137);case 6:if(a._consume){e.next=9;break}return i(403,"I do not want to consume"),e.abrupt("break",137);case 9:return s=t.data,o=s.peerId,c=s.producerId,d=s.id,l=s.kind,h=s.rtpParameters,m=s.type,f=s.appData,_=s.producerPaused,e.prev=10,e.next=13,a._recvTransport.consume({id:d,producerId:c,kind:l,rtpParameters:h,appData:De(De({},f),{},{peerId:o})});case 13:v=e.sent,g=u.parseScalabilityMode(v.rtpParameters.encodings[0].scalabilityMode),y=g.spatialLayers,b=g.temporalLayers,v.spatialLayers=y,v.temporalLayers=b,v.currentSpatialLayers=y-1,v.currentTemporalLayers=b-1,a._consumers.set(v.id,v),v.on("transportclose",(function(){a._consumers.delete(v.id);var e=Y(v.id,o);Ie.dispatch(e),a._eventEmitter.emit(e.type,e.payload)})),w=Q({id:v.id,type:m,locallyPaused:!1,remotelyPaused:_,rtpParameters:v.rtpParameters,spatialLayers:y,temporalLayers:b,currentSpatialLayer:y-1,currentTemporalLayer:b-1,preferredSpatialLayer:y-1,preferredTemporalLayer:b-1,priority:1,codec:v.rtpParameters.codecs[0].mimeType.split("/")[1],track:v.track,appData:f,instance:v},o),Ie.dispatch(w),a._eventEmitter.emit(w.type,w.payload),r(),"video"===v.kind&&Ie.getState().me.audioOnly&&a._pauseConsumer(v),e.next=33;break;case 28:throw e.prev=28,e.t1=e.catch(10),Be.error('"newConsumer" request failed:%o',e.t1),Ie.dispatch(se({type:"error",text:"Error creating a Consumer: ".concat(e.t1)})),e.t1;case 33:return e.abrupt("break",137);case 34:if(a._consume){e.next=37;break}return i(403,"I do not want to data consume"),e.abrupt("break",137);case 37:if(a._useDataChannel){e.next=40;break}return i(403,"I do not want DataChannels"),e.abrupt("break",137);case 40:return S=t.data,k=S.peerId,R=S.dataProducerId,P=S.id,E=S.sctpStreamParameters,C=S.label,T=S.protocol,x=S.appData,e.prev=41,e.next=44,a._recvTransport.consumeData({id:P,dataProducerId:R,sctpStreamParameters:E,label:C,protocol:T,appData:De(De({},x),{},{peerId:k})});case 44:D=e.sent,a._dataConsumers.set(D.id,D),D.on("transportclose",(function(){a._dataConsumers.delete(D.id)})),D.on("open",(function(){Be.debug('DataConsumer "open" event')})),D.on("close",(function(){Be.warn('DataConsumer "close" event'),a._dataConsumers.delete(D.id),Ie.dispatch(se({type:"error",text:"DataConsumer closed"}))})),D.on("error",(function(e){Be.error('DataConsumer "error" event:%o',e),Ie.dispatch(se({type:"error",text:"DataConsumer error: ".concat(e)}))})),D.on("message",(function(e){if(Be.debug('DataConsumer "message" event [streamId:%d]',D.sctpStreamParameters.streamId),window.DC_MESSAGE=e,e instanceof ArrayBuffer){var t=new DataView(e).getUint32();return t==Math.pow(2,32)-1?(Be.warn("dataChannelTest finished!"),void(a._nextDataChannelTestNumber=0)):(t>a._nextDataChannelTestNumber&&Be.warn("dataChannelTest: %s packets missing",t-a._nextDataChannelTestNumber),void(a._nextDataChannelTestNumber=t+1))}if("string"==typeof e)switch(D.label){case"chat":var r=Ie.getState().peers,n=Object.keys(r).map((function(e){return r[e]})).find((function(e){return e.dataConsumers.includes(D.id)}));if(!n){Be.warn('DataConsumer "message" from unknown peer');break}Ie.dispatch(se({title:"".concat(n.displayName," says:"),text:e,timeout:5e3})),a._eventEmitter.emit("CHAT_MESSAGE",{text:e,senderId:n.id,timestamp:(new Date).getTime()});break;case"bot":Ie.dispatch(se({title:"Message from Bot:",text:e,timeout:5e3}))}else Be.warn('ignoring DataConsumer "message" (not a string)')})),window.DC=D,Ie.dispatch(ne({id:D.id,sctpStreamParameters:D.sctpStreamParameters,label:D.label,protocol:D.protocol},k)),r(),e.next=60;break;case 56:e.prev=56,e.t2=e.catch(41),Be.error('"newDataConsumer" request failed:%o',e.t2),Ie.dispatch(se({type:"error",text:"Error creating a DataConsumer: ".concat(e.t2)}));case 60:return e.abrupt("break",137);case 61:e.prev=61,I=t.data.peerId,a._eventEmitter.emit("MIC_REQUESTED",{peerId:I}),r(),e.next=71;break;case 67:throw e.prev=67,e.t3=e.catch(61),Be.error('"enableMic" request failed:%o',e.t3),e.t3;case 71:return e.abrupt("break",137);case 72:return e.prev=72,e.next=75,a.disableMic();case 75:r(),e.next=82;break;case 78:throw e.prev=78,e.t4=e.catch(72),Be.error('"disableMic" request failed:%o',e.t4),e.t4;case 82:return e.abrupt("break",137);case 83:e.prev=83,O=t.data.peerId,a._eventEmitter.emit("WEBCAM_REQUESTED",{peerId:O}),r(),e.next=93;break;case 89:throw e.prev=89,e.t5=e.catch(83),Be.error('"enableWebcam" request failed:%o',e.t5),e.t5;case 93:return e.abrupt("break",137);case 94:return e.prev=94,e.next=97,a.disableWebcam();case 97:r(),e.next=104;break;case 100:throw e.prev=100,e.t6=e.catch(94),Be.error('"disableWebcam" request failed:%o',e.t6),e.t6;case 104:return e.abrupt("break",137);case 105:e.prev=105,M=t.data,A=M.peerId,L=M.state,j=M.pinnedBy,a._pinnedParticipants.has(A)||a._pinnedParticipants.set(A,{cam:!1,share:!1}),N=a._pinnedParticipants.get(A),null!=L.cam&&(N.cam=L.cam),null!=L.share&&(N.share=L.share),a._pinnedParticipants.set(A,N),a._eventEmitter.emit("PIN_STATE_CHANGED",{peerId:A,state:L,pinnedBy:j}),0==N.share&&0==N.cam&&a._pinnedParticipants.delete(A),r(),e.next=121;break;case 117:throw e.prev=117,e.t7=e.catch(105),Be.error('"pinStateChanged" request failed:%o',e.t7),e.t7;case 121:return e.abrupt("break",137);case 122:return a._eventEmitter.emit("SWITCH_ROOM",t.data),r(),e.abrupt("break",137);case 125:return r({peerId:a._peerId,statsData:a._stats}),a._stats={},e.abrupt("break",137);case 128:B={},F=0,W=Ce(a._usageDataPointsPeerMaxRes);try{for(W.s();!(V=W.n()).done;)U=(0,n.Z)(V.value,2),H=U[0],z=U[1],F+=z,z=a._getRoundedResolution(z),B[z]||(B[z]=[]),B[z].push(H)}catch(e){W.e(e)}finally{W.f()}return F=a._getRoundedResolution(F),r({data:{peerId:a._peerId,consumption:B,audioConsumption:a._audioConsumption},totalResolution:F}),a._audioConsumption=0,a._usageDataPointsPeerMaxRes=new Map,e.abrupt("break",137);case 137:case"end":return e.stop()}}),e,null,[[10,28],[41,56],[61,67],[72,78],[83,89],[94,100],[105,117]])})));return function(t,r,a){return e.apply(this,arguments)}}()),this._protoo.on("notification",(function(e){switch(Be.debug('proto "notification" event [method:%s, data:%o]',e.method,e.data),e.method){case"error":var t=e.data;a._eventEmitter.emit("ERROR",t);break;case"participantMediaStateChanged":try{var r=e.data,n=r.peerId,i=r.kind,s=r.newState;a._eventEmitter.emit("PARTICIPANT_MEDIA_STATE_CHANGED",{peerId:n,kind:i,newState:s})}catch(t){Be.error('"newProducer" request failed:%o',t)}case"producerScore":var o=e.data,c=o.producerId,d=o.score;Ie.dispatch(H(c,d));break;case"entryRequested":var p=e.data,l=p.id,u=p.name;l!==a._peerId&&a._eventEmitter.emit("ENTRY_REQUESTED",{id:l,name:u});break;case"entryResponded":var h=e.data,m=h.id,f=h.decision;a._eventEmitter.emit("ENTRY_RESPONDED",{id:m,decision:f}),m===a._peerId&&"allowed"===f&&a.joinRoom();break;case"newPeer":var _=e.data,v=q(De(De({},_),{},{consumers:[],dataConsumers:[]}));Ie.dispatch(v),a._eventEmitter.emit(v.type,v.payload),Ie.dispatch(se({text:"".concat(_.displayName," has joined the room")}));break;case"peerClosed":var g=e.data.peerId,y=K(g);Ie.dispatch(y),a._eventEmitter.emit(y.type,y.payload);break;case"peerDisplayNameChanged":var b=e.data,w=b.peerId,S=b.displayName,k=b.oldDisplayName;Ie.dispatch($(S,w)),Ie.dispatch(se({text:"".concat(k," is now ").concat(S)}));break;case"downlinkBwe":Be.debug("'downlinkBwe' event:%o",e.data);break;case"consumerClosed":var R=e.data.consumerId,P=a._consumers.get(R);if(!P)break;P.close(),a._consumers.delete(R);var E=P.appData.peerId,C=Y(R,E);Ie.dispatch(C),a._eventEmitter.emit(C.type,C.payload);break;case"consumerPaused":var T=e.data.consumerId,x=a._consumers.get(T);if(!x)break;x.pause(),Ie.dispatch(J(T,"remote"));break;case"consumerResumed":var D=e.data.consumerId,I=a._consumers.get(D);if(!I)break;I.resume(),Ie.dispatch(X(D,"remote"));break;case"consumerLayersChanged":var M=e.data,A=M.consumerId,L=M.spatialLayer,j=M.temporalLayer,N=a._consumers.get(A);if(N.currentSpatialLayer=L,N.currentTemporalLayer=j,!N)break;N.appData.encodings.length>1?a._eventEmitter.emit("VIDEO_QUALITY_CHANGED",{peerId:N.appData.peerId,prevQuality:N.spatialLayers-1-N.currentSpatialLayer==0?"HIGH":N.spatialLayers-1-N.currentSpatialLayer==1?"MEDIUM":"LOW",currentQuality:N.spatialLayers-1-L==0?"HIGH":N.spatialLayers-1-L==1?"MEDIUM":"LOW"}):a._eventEmitter.emit("VIDEO_QUALITY_CHANGED",{peerId:N.appData.peerId,prevQuality:"HIGH",currentQuality:"HIGH"}),N.currentSpatialLayer=L,N.currentTemporalLayer=j,Ie.dispatch(ee(A,L,j));break;case"consumerScore":var B=e.data,F=B.consumerId,W=B.score;Ie.dispatch(ae(F,W));break;case"dataConsumerClosed":var V=e.data.dataConsumerId,U=a._dataConsumers.get(V);if(!U)break;U.close(),a._dataConsumers.delete(V);var z=U.appData.peerId;Ie.dispatch(ie(V,z));break;case"activeSpeaker":var Z=e.data.peerId,G=O(Z);Ie.dispatch(G),a._eventEmitter.emit(G.type,G.payload);break;case"recordingStateChanged":a._eventEmitter.emit("RECORDING_STATE_CHANGED",e.data);break;case"recordingStarted":a._eventEmitter.emit("RECORDING_STARTED",{});break;case"recordingStopped":a._eventEmitter.emit("RECORDING_STOPPED",{});break;case"livestreamStateChanged":a._eventEmitter.emit("LIVESTREAM_STATE_CHANGED",e.data);break;case"livestreamStarted":a._eventEmitter.emit("LIVESTREAM_STARTED",{});break;case"livestreamStopped":a._eventEmitter.emit("LIVESTREAM_STOPPED",{});break;case"hlsStateChanged":a._eventEmitter.emit("HLS_STATE_CHANGED",e.data);break;case"hlsStarted":var Q=e.data.downstreamUrl;a._eventEmitter.emit("HLS_STARTED",Q);break;case"hlsStopped":a._eventEmitter.emit("HLS_STOPPED",{});break;case"whiteboardStarted":var te=e.data.state;a._eventEmitter.emit("WHITEBOARD_STARTED",{state:te});break;case"whiteboardStopped":a._eventEmitter.emit("WHITEBOARD_STOPPED",{});break;case"videoStatusChanged":a._eventEmitter.emit("VIDEO_STATE_CHANGED",e.data);break;case"videoSeeked":var re=e.data.currentTime;a._eventEmitter.emit("VIDEO_SEEKED",{currentTime:re});break;case"connectionOpen":a._eventEmitter.emit("CONNECTION_OPEN",e.data);break;case"connectionClose":a._eventEmitter.emit("CONNECTION_CLOSE",e.data);break;case"connectionChatMessage":a._eventEmitter.emit("CONNECTION_CHAT_MESSAGE",e.data);break;case"connectionParticipantJoined":a._eventEmitter.emit("CONNECTION_PARTICIPANT_JOIN",e.data);break;case"connectionParticipantLeft":a._eventEmitter.emit("CONNECTION_PARTICIPANT_LEFT",e.data);break;case"pubsubMessage":a._eventEmitter.emit("PUBSUB_MESSAGE",e.data);break;case"peerModeChanged":a._eventEmitter.emit("PEER_MODE_CHANGED",e.data);break;default:Be.error('unknown protoo notification.method "%s"',e.method)}}));case 16:case"end":return e.stop()}}),e,this)}))),function(){return qt.apply(this,arguments)})},{key:"requestEntry",value:(Gt=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("requestEntry",{name:this._displayName});case 2:case"end":return e.stop()}}),e,this)}))),function(){return Gt.apply(this,arguments)})},{key:"respondEntry",value:(Zt=(0,i.Z)(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("respondEntry",{id:t,decision:r});case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return Zt.apply(this,arguments)})},{key:"startRecording",value:(zt=(0,i.Z)(p().mark((function e(t,r,a){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("startRecording()"),e.prev=1,e.next=4,this._protoo.request("startRecording",{webhookUrl:t,awsDirPath:r,config:a});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("startRecording() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e,t,r){return zt.apply(this,arguments)})},{key:"stopRecording",value:(Ht=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("stopRecording()"),e.prev=1,e.next=4,this._protoo.request("stopRecording",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("stopRecording() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return Ht.apply(this,arguments)})},{key:"startLivestream",value:(Ut=(0,i.Z)(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("startLivestream()"),e.prev=1,e.next=4,this._protoo.request("startLivestream",{outputs:t,config:r});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("startLivestream() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e,t){return Ut.apply(this,arguments)})},{key:"stopLivestream",value:(Vt=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("stopLivestream()"),e.prev=1,e.next=4,this._protoo.request("stopLivestream",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("stopLivestream() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return Vt.apply(this,arguments)})},{key:"startHls",value:(Wt=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},Be.debug("startHls()"),e.prev=2,e.next=5,this._protoo.request("startHls",{config:t});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),Be.error("startHls() | failed:%o",e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return Wt.apply(this,arguments)})},{key:"stopHls",value:(Ft=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("stopHls()"),e.prev=1,e.next=4,this._protoo.request("stopHls",{});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("stopHls() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return Ft.apply(this,arguments)})},{key:"startWhiteboard",value:(Bt=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("startWhiteboard()"),e.prev=1,e.next=4,this._protoo.request("startWhiteboard",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("startWhiteboard() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return Bt.apply(this,arguments)})},{key:"stopWhiteboard",value:(Nt=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("stopWhiteboard()"),e.prev=1,e.next=4,this._protoo.request("stopWhiteboard",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("stopWhiteboard() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return Nt.apply(this,arguments)})},{key:"pinStateChange",value:(jt=(0,i.Z)(p().mark((function e(t){var r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.peerId,a=t.state,e.prev=1,e.next=4,this._protoo.request("pinStateChanged",{peerId:r,state:a});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("pinStateChange() | failed");case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return jt.apply(this,arguments)})},{key:"startVideo",value:(Lt=(0,i.Z)(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.link,Be.debug("startVideo()"),e.prev=2,e.next=5,this._protoo.request("startVideo",{link:r});case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),Be.error("startVideo() | failed:%o",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return Lt.apply(this,arguments)})},{key:"stopVideo",value:(At=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("stopVideo()"),e.prev=1,e.next=4,this._protoo.request("stopVideo",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("stopVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return At.apply(this,arguments)})},{key:"pauseVideo",value:(Mt=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("pauseVideo()"),e.prev=1,e.next=4,this._protoo.request("pauseVideo",{currentTime:t});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("pauseVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return Mt.apply(this,arguments)})},{key:"resumeVideo",value:(Ot=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("resumeVideo()"),e.prev=1,e.next=4,this._protoo.request("resumeVideo",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("resumeVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return Ot.apply(this,arguments)})},{key:"seekVideo",value:(It=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("seekVideo()"),e.prev=1,e.next=4,this._protoo.request("seekVideo",{currentTime:t});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),Be.error("seekVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return It.apply(this,arguments)})},{key:"enablePeerMic",value:(Dt=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("enablePeerMic()"),e.prev=1,e.next=4,this._protoo.request("enablePeerMic",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("enablePeerMic() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return Dt.apply(this,arguments)})},{key:"disablePeerMic",value:(xt=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("disablePeerMic()"),e.prev=1,e.next=4,this._protoo.request("disablePeerMic",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("disablePeerMic() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return xt.apply(this,arguments)})},{key:"consumeWebcamStreams",value:(Tt=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("consumeWebcamStreams()"),e.prev=1,e.next=4,this._protoo.request("consumeVideoStreams",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("consumeWebcamStreams() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return Tt.apply(this,arguments)})},{key:"consumeMicStreams",value:(Ct=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("consumeMicStreams()"),e.prev=1,e.next=4,this._protoo.request("consumeAudioStreams",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("consumeMicStreams() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return Ct.apply(this,arguments)})},{key:"stopConsumingMicStreams",value:(Et=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("stopConsumingAudioStreams()"),e.prev=1,e.next=4,this._protoo.request("stopConsumingAudioStreams",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("stopConsumingMicStreams() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return Et.apply(this,arguments)})},{key:"stopConsumingWebcamStreams",value:(Pt=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("stopConsumingWebcamStreams()"),e.prev=1,e.next=4,this._protoo.request("stopConsumingVideoStreams",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("stopConsumingWebcamStreams() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return Pt.apply(this,arguments)})},{key:"changeMode",value:(Rt=(0,i.Z)(p().mark((function e(t){var r,a,n,i,s,o,c,d,l,h,m,f,_,v,g=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._mode,e.prev=1,r!==t){e.next=4;break}throw new Error("You are already in ".concat(t," mode"));case 4:if(this._mode=t,t!==Ee.S.CONFERENCE){e.next=33;break}return this._consume=!0,this._produce=!0,this._mediasoupDevice=new u.Device({handlerName:this._handlerName}),e.next=11,this._protoo.request("getRouterRtpCapabilities");case 11:return a=e.sent,e.next=14,this._mediasoupDevice.load({routerRtpCapabilities:a});case 14:if(!this._produce){e.next=19;break}return e.next=17,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 17:n=e.sent,this.createProducerTransport(n);case 19:if(!this._consume){e.next=26;break}return e.next=22,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 22:i=e.sent,s=i.id,o=i.iceParameters,c=i.iceCandidates,d=i.dtlsParameters,l=i.sctpParameters,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:s,iceParameters:o,iceCandidates:c,dtlsParameters:d,sctpParameters:l,iceServers:this._iceServers}),this._recvTransport.on("connect",(function(e,t,r){var a=e.dtlsParameters;g._protoo.request("connectWebRtcTransport",{transportId:g._recvTransport.id,dtlsParameters:a}).then(t).catch(r)}));case 26:return e.next=28,this._protoo.request("changeMode",{mode:t});case 28:this._produce&&(Ie.dispatch(A({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled&&this.enableMic(this.customMicrophoneAudioTrack),h=T(),this._webcamEnabled&&(!h||h.webcamEnabled||this._externalVideo)&&this.enableWebcam(this.customCameraVideoTrack),this.enableChatDataProducer()),window.SHOW_INFO&&(m=Ie.getState(),f=m.me,Ie.dispatch(M(f.id))),this._eventEmitter.emit("PEER_MODE_CHANGED",{peerId:this._peerId,mode:"CONFERENCE"}),e.next=43;break;case 33:if(t!==Ee.S.VIEWER){e.next=43;break}return e.next=36,this._protoo.request("changeMode",{mode:t});case 36:this._consume=!1,this._produce=!1,this._dataConsumers.clear(),null===(_=this._sendTransport)||void 0===_||_.close(),this._sendTransport=null,null===(v=this._recvTransport)||void 0===v||v.close(),this._recvTransport=null;case 43:e.next=48;break;case 45:e.prev=45,e.t0=e.catch(1),Be.error("changeMode(".concat(t,") | failed:%o"),e.t0);case 48:case"end":return e.stop()}}),e,this,[[1,45]])}))),function(e){return Rt.apply(this,arguments)})},{key:"enablePeerWebcam",value:(kt=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("enablePeerWebcam()"),e.prev=1,e.next=4,this._protoo.request("enablePeerWebcam",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("enablePeerWebcam() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return kt.apply(this,arguments)})},{key:"disablePeerWebcam",value:(St=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("disablePeerWebcam()"),e.prev=1,e.next=4,this._protoo.request("disablePeerWebcam",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Be.error("disablePeerWebcam() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return St.apply(this,arguments)})},{key:"enableMic",value:(wt=(0,i.Z)(p().mark((function e(){var t,r,a,n,i,s,o,c,d=this,l=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:void 0,Be.debug("enableMic()"),this._micEnabled=!0,!this._micProducer){e.next=5;break}return e.abrupt("return");case 5:if(this._mediasoupDevice.canProduce("audio")){e.next=8;break}return Be.error("enableMic() | cannot produce audio"),e.abrupt("return");case 8:if(e.prev=8,this._externalVideo){e.next=30;break}return Be.debug("enableMic() | calling getUserMedia()"),e.next=13,this._updateMics();case 13:if(this._mic.device){e.next=15;break}throw new Error("no mic devices");case 15:try{t&&"ended"==(r=t.getAudioTracks()[0]).readyState&&(r=null)}catch(e){console.log("Invalid Custom Audio Track Passed. Reverting to default Error: ".concat(e))}if(r){e.next=28;break}return e.prev=17,e.next=20,navigator.mediaDevices.getUserMedia({audio:{deviceId:{ideal:this._mic.device.deviceId},channelCount:1,noiseSuppression:!0,echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0}});case 20:a=e.sent,e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(17),"Permission denied"===e.t0.message||"NotAllowedError"===e.t0.name?this._emitError(ke.H.ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED):this._emitError(ke.H.ERROR_GET_AUDIO_MEDIA),e.abrupt("return");case 27:r=a.getAudioTracks()[0];case 28:e.next=34;break;case 30:return e.next=32,this._getExternalVideoStream();case 32:n=e.sent,r=n.getAudioTracks()[0].clone();case 34:return i={opusStereo:1,opusDtx:1},t&&(s=t.encoderConfig?ce.v.audioProfiles[t.encoderConfig]:ce.v.audioProfiles.speech_standard,i={opusStereo:s.stereo?1:0,opusFec:s.fec?1:0,opusDtx:s.dtx?1:0,opusMaxPlaybackRate:s.maxPlaybackRate,opusPtime:s.packetTime}),o=[{networkPriority:"high"}],e.next=40,this._sendTransport.produce({track:r,encodings:o,codecOptions:i});case 40:this._micProducer=e.sent,c=W({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],instance:this._micProducer}),Ie.dispatch(c),this._eventEmitter.emit(c.type,c.payload),this._micProducer.on("transportclose",(function(){var e,t=V(d._micProducer.id);Ie.dispatch(t),d._eventEmitter.emit(t.type,t.payload),null===(e=d._micProducer)||void 0===e||e.close(),d._micProducer=null})),this._micProducer.on("trackended",(function(){Ie.dispatch(se({type:"error",text:"Microphone disconnected!"})),d.disableMic().catch((function(){}))})),e.next=55;break;case 48:return e.prev=48,e.t1=e.catch(8),Be.error("enableMic() | failed:%o",e.t1),Ie.dispatch(se({type:"error",text:"Error enabling microphone: ".concat(e.t1)})),e.next=54,this._protoo.request("produceError",{mediaType:"audio",message:e.t1.message});case 54:r&&r.stop();case 55:case"end":return e.stop()}}),e,this,[[8,48],[17,23]])}))),function(){return wt.apply(this,arguments)})},{key:"disableMic",value:(bt=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("disableMic()"),this._micEnabled=!1,this._micProducer){e.next=4;break}return e.abrupt("return");case 4:return this._micProducer.close(),t=V(this._micProducer.id),Ie.dispatch(t),this._eventEmitter.emit(t.type,t.payload),e.prev=8,e.next=11,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),Ie.dispatch(se({type:"error",text:"Error closing server-side mic Producer: ".concat(e.t0)}));case 16:this._micProducer=null;case 17:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(){return bt.apply(this,arguments)})},{key:"muteMic",value:(yt=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("muteMic()"),this._micEnabled=!1,this._micProducer.pause(),e.prev=3,e.next=6,this._protoo.request("pauseProducer",{producerId:this._micProducer.id});case 6:Ie.dispatch({type:"SET_PRODUCER_PAUSED",payload:{producerId:this._micProducer.id}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),Be.error("muteMic() | failed: %o",e.t0),Ie.dispatch(se({type:"error",text:"Error pausing server-side mic Producer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return yt.apply(this,arguments)})},{key:"unmuteMic",value:(gt=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("unmuteMic()"),this._micEnabled=!0,this._micProducer.resume(),e.prev=3,e.next=6,this._protoo.request("resumeProducer",{producerId:this._micProducer.id});case 6:Ie.dispatch({type:"SET_PRODUCER_RESUMED",payload:{producerId:this._micProducer.id}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),Be.error("unmuteMic() | failed: %o",e.t0),Ie.dispatch(se({type:"error",text:"Error resuming server-side mic Producer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return gt.apply(this,arguments)})},{key:"enableWebcam",value:(vt=(0,i.Z)(p().mark((function e(){var t,r,a,n,i,s,o,c,d,l,u,h,m,f,_=this,v=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.length>0&&void 0!==v[0]?v[0]:void 0,Be.debug("enableWebcam()"),this._webcamEnabled=!0,!this._webcamProducer){e.next=5;break}return e.abrupt("return");case 5:if(this._mediasoupDevice.canProduce("video")){e.next=8;break}return Be.error("enableWebcam() | cannot produce video"),e.abrupt("return");case 8:if(Ie.dispatch(Z(!0)),n=this._webcam.resolution,e.prev=10,this._externalVideo){e.next=40;break}return e.next=14,this._updateWebcams();case 14:if(a=this._webcam.device){e.next=17;break}throw new Error("no webcam devices");case 17:Be.debug("enableWebcam() | calling getUserMedia()");try{t&&"ended"==(r=t.getVideoTracks()[0]).readyState&&(r=null)}catch(e){console.log("Invalid Custom Track Passed. Reverting to default Error: ".concat(e))}if(r){e.next=38;break}if(e.prev=20,"hd"!=this._webcam.resolution){e.next=27;break}return e.next=24,Re.VideoSDK.createCameraVideoTrack({cameraId:a.deviceId,encoderConfig:"h720p_w1280p",multiStream:this._useSimulcast});case 24:t=e.sent,e.next=30;break;case 27:return e.next=29,Re.VideoSDK.createCameraVideoTrack({cameraId:a.deviceId,encoderConfig:"h540p_w960p",multiStream:this._useSimulcast});case 29:t=e.sent;case 30:r=t.getVideoTracks()[0],e.next=38;break;case 33:return e.prev=33,e.t0=e.catch(20),console.log("Error Creating VideoTrack: ",e.t0),"Permission denied"===e.t0.message||"NotAllowedError"===e.t0.name?this._emitError(ke.H.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED):this._emitError(ke.H.ERROR_GET_VIDEO_MEDIA),e.abrupt("return");case 38:e.next=45;break;case 40:return a={label:"external video"},e.next=43,this._getExternalVideoStream();case 43:i=e.sent,r=i.getVideoTracks()[0].clone();case 45:if(c={videoGoogleStartBitrate:1e3},!this._forceH264){e.next=52;break}if(o=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/h264"===e.mimeType.toLowerCase()}))){e.next=50;break}throw new Error("desired H264 codec+configuration is not supported");case 50:e.next=56;break;case 52:if(!this._forceVP9){e.next=56;break}if(o=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/vp9"===e.mimeType.toLowerCase()}))){e.next=56;break}throw new Error("desired VP9 codec+configuration is not supported");case 56:r?(d=r.getConstraints(),s=ye(!1,d.width,d.height,{simulcast:t.multiStream})):this._useSimulcast&&(l=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video"===e.kind})),s=this._forceVP9&&o||"video/vp9"===l.mimeType.toLowerCase()?Le:Ae[this._webcam.resolution]),u={};try{u={encodings:s,width:t?null===(h=r)||void 0===h?void 0:h.getConstraints().width:Me[n].width.ideal,height:t?null===(m=r)||void 0===m?void 0:m.getConstraints().height:Me[n].height.ideal}}catch(e){console.log(e)}return e.next=61,this._sendTransport.produce({track:r,encodings:s,codecOptions:c,codec:o,appData:u});case 61:this._webcamProducer=e.sent,f=W({id:this._webcamProducer.id,deviceLabel:a.label,type:this._getWebcamType(a),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1],instance:this._webcamProducer}),Ie.dispatch(f),this._eventEmitter.emit(f.type,f.payload),this._webcamProducer.on("transportclose",(function(){var e,t=V(_._webcamProducer.id);Ie.dispatch(t),_._eventEmitter.emit(t.type,t.payload),null===(e=_._webcamProducer)||void 0===e||e.close(),_._webcamProducer=null})),this._webcamProducer.on("trackended",(function(){Ie.dispatch(se({type:"error",text:"Webcam disconnected!"})),_.disableWebcam().catch((function(){}))})),e.next=77;break;case 69:return e.prev=69,e.t1=e.catch(10),Be.error("enableWebcam() | failed:%o",e.t1),console.log("enableWebcam() | failed:%o",e.t1),Ie.dispatch(se({type:"error",text:"Error enabling webcam: ".concat(e.t1)})),e.next=76,this._protoo.request("produceError",{mediaType:"video",message:e.t1.message});case 76:r&&r.stop();case 77:Ie.dispatch(Z(!1));case 78:case"end":return e.stop()}}),e,this,[[10,69],[20,33]])}))),function(){return vt.apply(this,arguments)})},{key:"disableWebcam",value:(_t=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("disableWebcam()"),this._webcamEnabled=!1,this._webcamProducer){e.next=4;break}return e.abrupt("return");case 4:return this._webcamProducer.close(),t=V(this._webcamProducer.id),Ie.dispatch(t),this._eventEmitter.emit(t.type,t.payload),e.prev=8,e.next=11,this._protoo.request("closeProducer",{producerId:this._webcamProducer.id});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),Ie.dispatch(se({type:"error",text:"Error closing server-side webcam Producer: ".concat(e.t0)}));case 16:this._webcamProducer=null;case 17:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(){return _t.apply(this,arguments)})},{key:"getMics",value:(ft=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,this._updateMics();case 4:this._mics.forEach((function(e,r){t.push({deviceId:r,label:e.label})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),Be.error("getMics() | Error",e.t0);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return ft.apply(this,arguments)})},{key:"changeMic",value:(mt=(0,i.Z)(p().mark((function e(t){var r,n,i,s,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"object"!=a(t)){e.next=8;break}return e.next=4,this.disableMic();case 4:return e.next=6,this.enableMic(t);case 6:e.next=22;break;case 8:return r=t,e.next=11,this._updateMics();case 11:if(n=Array.from(this._mics.keys()),i=n.length,s=this._mic.device?this._mic.device.deviceId:void 0,null!=r&&null!=r?o=n.indexOf(r):(o=n.indexOf(s))<i-1?o++:o=0,this._mic.device=this._mics.get(n[o]),this._mic.device){e.next=18;break}throw new Error("No mic Found");case 18:return e.next=20,this.disableMic();case 20:return e.next=22,this.enableMic();case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),Be.error("changeMic()| Error");case 27:case"end":return e.stop()}}),e,this,[[0,24]])}))),function(e){return mt.apply(this,arguments)})},{key:"getWebcams",value:(ht=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,this._updateWebcams();case 4:this._webcams.forEach((function(e,r){t.push({deviceId:r,label:e.label,facingMode:e.facing||"environment"})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),Be.error("getWebcams() | failed %o",e.t0);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return ht.apply(this,arguments)})},{key:"changeWebcam",value:(ut=(0,i.Z)(p().mark((function e(t){var r,n,i,s,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ie.dispatch(Z(!0)),"object"!==a(t)){e.next=23;break}if(e.prev=2,!this._webcamProducer){e.next=10;break}return r=t.getVideoTracks()[0],e.next=7,this._webcamProducer.replaceTrack({track:r});case 7:this._eventEmitter.emit("UPDATE_PRODUCER",{producer:this._webcamProducer}),e.next=14;break;case 10:return e.next=12,this.disableWebcam();case 12:return e.next=14,this.enableWebcam(t);case 14:return e.abrupt("return");case 17:e.prev=17,e.t0=e.catch(2),Be.error("changeWebcam() | failed: %o",e.t0),Ie.dispatch(se({type:"error",text:"Could not change webcam: ".concat(e.t0)}));case 21:e.next=46;break;case 23:return e.prev=23,e.next=26,this._updateWebcams();case 26:if(n=Array.from(this._webcams.keys()),i=n.length,s=this._webcam.device?this._webcam.device.deviceId:void 0,null!=t&&null!=t?o=n.indexOf(t):(o=n.indexOf(s))<i-1?o++:o=0,this._webcam.device=this._webcams.get(n[o]),Be.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution=this._webcam.resolution||"hd",this._webcam.device){e.next=35;break}throw new Error("no webcam devices");case 35:return e.next=37,this.disableWebcam();case 37:return e.next=39,this.enableWebcam();case 39:return e.abrupt("return");case 42:e.prev=42,e.t1=e.catch(23),Be.error("changeWebcam() | failed: %o",e.t1),Ie.dispatch(se({type:"error",text:"Could not change webcam: ".concat(e.t1)}));case 46:Ie.dispatch(Z(!1));case 47:case"end":return e.stop()}}),e,this,[[2,17],[23,42]])}))),function(e){return ut.apply(this,arguments)})},{key:"changeWebcamResolution",value:(lt=(0,i.Z)(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Be.debug("changeWebcamResolution()"),Ie.dispatch(Z(!0)),e.prev=2,e.t0=this._webcam.resolution,e.next="qvga"===e.t0?6:"vga"===e.t0?8:"hd"===e.t0?10:12;break;case 6:return this._webcam.resolution="vga",e.abrupt("break",13);case 8:return this._webcam.resolution="hd",e.abrupt("break",13);case 10:return this._webcam.resolution="qvga",e.abrupt("break",13);case 12:this._webcam.resolution="hd";case 13:return Be.debug("changeWebcamResolution() | calling getUserMedia()"),e.prev=14,e.next=17,navigator.mediaDevices.getUserMedia({video:De({deviceId:{exact:this._webcam.device.deviceId}},Me[this._webcam.resolution])});case 17:t=e.sent,e.next=24;break;case 20:return e.prev=20,e.t1=e.catch(14),"Permission denied"===e.t1.message||"NotAllowedError"===e.t1.name?this._emitError(ke.H.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED):this._emitError(ke.H.ERROR_GET_VIDEO_MEDIA),e.abrupt("return");case 24:return r=t.getVideoTracks()[0],e.next=27,this._webcamProducer.replaceTrack({track:r});case 27:Ie.dispatch(U(this._webcamProducer.id,r)),e.next=34;break;case 30:e.prev=30,e.t2=e.catch(2),Be.error("changeWebcamResolution() | failed: %o",e.t2),Ie.dispatch(se({type:"error",text:"Could not change webcam resolution: ".concat(e.t2)}));case 34:Ie.dispatch(Z(!1));case 35:case"end":return e.stop()}}),e,this,[[2,30],[14,20]])}))),function(){return lt.apply(this,arguments)})},{key:"enableShare",value:(pt=(0,i.Z)(p().mark((function e(t){var r,a,n,i,s,o,c,d,l,u,h=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("enableShare()"),!this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:if(this._mediasoupDevice.canProduce("video")){e.next=6;break}return Be.error("enableShare() | cannot produce video"),e.abrupt("return");case 6:if(Ie.dispatch(G(!0)),e.prev=7,Be.debug("enableShare() | calling getUserMedia()"),!t||!t.active){e.next=14;break}r=t.getVideoTracks()[0],a=t.getAudioTracks()[0],e.next=29;break;case 14:return e.prev=14,e.next=17,navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:10}}});case 17:n=e.sent,e.next=24;break;case 20:return e.prev=20,e.t0=e.catch(14),"Permission denied"===e.t0.message||"NotAllowedError"===e.t0.name?this._emitError(ke.H.ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED):this._emitError(ke.H.ERROR_GET_DISPLAY_MEDIA),e.abrupt("return");case 24:if(n){e.next=27;break}return Ie.dispatch(G(!0)),e.abrupt("return");case 27:r=n.getVideoTracks()[0],a=n.getAudioTracks()[0];case 29:if(o={videoGoogleStartBitrate:1e3},!this._forceH264){e.next=36;break}if(s=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/h264"===e.mimeType.toLowerCase()}))){e.next=34;break}throw new Error("desired H264 codec+configuration is not supported");case 34:e.next=40;break;case 36:if(!this._forceVP9){e.next=40;break}if(s=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/vp9"===e.mimeType.toLowerCase()}))){e.next=40;break}throw new Error("desired VP9 codec+configuration is not supported");case 40:return this._useSharingSimulcast&&(c=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video"===e.kind})),i=this._forceVP9&&s||"video/vp9"===c.mimeType.toLowerCase()?Ne:je.map((function(e){return De(De({},e),{},{dtx:!0})}))),e.next=43,this._sendTransport.produce({track:r,encodings:i,codecOptions:o,codec:s,appData:{share:!0}});case 43:if(this._shareProducer=e.sent,d=W({id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0},instance:this._shareProducer}),Ie.dispatch(d),this._eventEmitter.emit(d.type,d.payload),this._shareProducer.on("transportclose",(function(){var e,t=V(h._shareProducer.id);Ie.dispatch(t),h._eventEmitter.emit(t.type,t.payload),null===(e=h._shareProducer)||void 0===e||e.close(),h._shareProducer=null})),this._shareProducer.on("trackended",(function(){Ie.dispatch(se({type:"error",text:"Share disconnected!"})),h.disableShare().catch((function(){}))})),!a){e.next=66;break}return e.prev=50,l={opusStereo:1,opusDtx:1},e.next=54,this._sendTransport.produce({track:a,codecOptions:l,appData:{share:!0}});case 54:this._shareAudioProducer=e.sent,u=W({id:this._shareAudioProducer.id,type:"share",paused:this._shareAudioProducer.paused,track:this._shareAudioProducer.track,rtpParameters:this._shareAudioProducer.rtpParameters,codec:this._shareAudioProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0},instance:this._shareAudioProducer}),Ie.dispatch(u),this._eventEmitter.emit(u.type,u.payload),this._shareAudioProducer.on("transportclose",(function(){var e,t=V(h._shareAudioProducer.id);Ie.dispatch(t),h._eventEmitter.emit(t.type,t.payload),null===(e=h._shareAudioProducer)||void 0===e||e.close(),h._shareAudioProducer=null})),this._shareAudioProducer.on("trackended",(function(){Ie.dispatch(se({type:"error",text:"Share disconnected!"}))})),e.next=66;break;case 62:return e.prev=62,e.t1=e.catch(50),e.next=66,this._protoo.request("produceError",{mediaType:"shareAudio",message:e.t1.message});case 66:e.next=76;break;case 68:return e.prev=68,e.t2=e.catch(7),Be.error("enableShare() | failed:%o",e.t2),"NotAllowedError"!==e.t2.name&&Ie.dispatch(se({type:"error",text:"Error sharing: ".concat(e.t2)})),e.next=74,this._protoo.request("produceError",{mediaType:"share",message:e.t2.message});case 74:r&&r.stop(),a&&a.stop();case 76:Ie.dispatch(G(!1));case 77:case"end":return e.stop()}}),e,this,[[7,68],[14,20],[50,62]])}))),function(e){return pt.apply(this,arguments)})},{key:"disableShare",value:(dt=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("disableShare()"),this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:return this._shareProducer.close(),t=V(this._shareProducer.id),Ie.dispatch(t),this._eventEmitter.emit(t.type,t.payload),this._shareAudioProducer&&(this._shareAudioProducer.close(),t=V(this._shareAudioProducer.id),Ie.dispatch(t),this._eventEmitter.emit(t.type,t.payload)),e.prev=8,e.next=11,this._protoo.request("closeProducer",{producerId:this._shareProducer.id});case 11:if(!this._shareAudioProducer){e.next=14;break}return e.next=14,this._protoo.request("closeProducer",{producerId:this._shareAudioProducer.id});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),Ie.dispatch(se({type:"error",text:"Error closing server-side share Producer: ".concat(e.t0)}));case 19:this._shareProducer=null,this._shareAudioProducer=null;case 21:case"end":return e.stop()}}),e,this,[[8,16]])}))),function(){return dt.apply(this,arguments)})},{key:"enableAudioOnly",value:(ct=(0,i.Z)(p().mark((function e(){var t,r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Be.debug("enableAudioOnly()"),Ie.dispatch(N(!0)),this.disableWebcam(),t=Ce(this._consumers.values()),e.prev=4,t.s();case 6:if((r=t.n()).done){e.next=13;break}if("video"===(a=r.value).kind){e.next=10;break}return e.abrupt("continue",11);case 10:this._pauseConsumer(a);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),t.e(e.t0);case 18:return e.prev=18,t.f(),e.finish(18);case 21:Ie.dispatch(j(!0)),Ie.dispatch(N(!1));case 23:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(){return ct.apply(this,arguments)})},{key:"disableAudioOnly",value:(ot=(0,i.Z)(p().mark((function e(){var t,r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Be.debug("disableAudioOnly()"),Ie.dispatch(N(!0)),!this._webcamProducer&&this._produce&&(T()||{}).webcamEnabled&&this.enableWebcam(),t=Ce(this._consumers.values()),e.prev=4,t.s();case 6:if((r=t.n()).done){e.next=13;break}if("video"===(a=r.value).kind){e.next=10;break}return e.abrupt("continue",11);case 10:this._resumeConsumer(a);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),t.e(e.t0);case 18:return e.prev=18,t.f(),e.finish(18);case 21:Ie.dispatch(j(!1)),Ie.dispatch(N(!1));case 23:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(){return ot.apply(this,arguments)})},{key:"muteAudio",value:(st=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Be.debug("muteAudio()"),Ie.dispatch(B(!0));case 2:case"end":return e.stop()}}),e)}))),function(){return st.apply(this,arguments)})},{key:"unmuteAudio",value:(it=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Be.debug("unmuteAudio()"),Ie.dispatch(B(!1));case 2:case"end":return e.stop()}}),e)}))),function(){return it.apply(this,arguments)})},{key:"restartIce",value:(nt=(0,i.Z)(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("restartIce()"),Ie.dispatch(F(!0)),e.prev=2,!this._sendTransport){e.next=9;break}return e.next=6,this._protoo.request("restartIce",{transportId:this._sendTransport.id});case 6:return t=e.sent,e.next=9,this._sendTransport.restartIce({iceParameters:t});case 9:if(!this._recvTransport){e.next=15;break}return e.next=12,this._protoo.request("restartIce",{transportId:this._recvTransport.id});case 12:return r=e.sent,e.next=15,this._recvTransport.restartIce({iceParameters:r});case 15:Ie.dispatch(se({text:"ICE restarted"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),Be.error("restartIce() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"ICE restart failed: ".concat(e.t0)}));case 22:Ie.dispatch(F(!1));case 23:case"end":return e.stop()}}),e,this,[[2,18]])}))),function(){return nt.apply(this,arguments)})},{key:"setMaxSendingSpatialLayer",value:(at=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",t),e.prev=1,!this._webcamProducer){e.next=7;break}return e.next=5,this._webcamProducer.setMaxSpatialLayer(t);case 5:e.next=10;break;case 7:if(!this._shareProducer){e.next=10;break}return e.next=10,this._shareProducer.setMaxSpatialLayer(t);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),Be.error("setMaxSendingSpatialLayer() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error setting max sending video spatial layer: ".concat(e.t0)}));case 16:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e){return at.apply(this,arguments)})},{key:"setWebcamQuality",value:(rt=(0,i.Z)(p().mark((function e(t){var r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._webcamProducer){e.next=2;break}return e.abrupt("return");case 2:if(r=this._webcam.resolution,a=Oe[r][t].s,this._webcamProducer.maxSpatialLayer!=a){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this._webcamProducer.setMaxSpatialLayer(a);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return rt.apply(this,arguments)})},{key:"setConsumerQuality",value:(tt=(0,i.Z)(p().mark((function e(t,r){var a,n,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._webcam.resolution,n=Oe[a][r].s,i=Oe[a][r].t,e.next=5,this.setConsumerPreferredLayers(t,n,i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return tt.apply(this,arguments)})},{key:"setViewPort",value:(et=(0,i.Z)(p().mark((function e(t,r,a){var n,i,s,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._consumers.get(t.id)){e.next=2;break}return e.abrupt("return");case 2:if(n=Se(this._consumers.get(t.id),r,a),i=n.consumerId,s=n.newPreferredSpatialLayer,o=n.newPreferredTemporalLayer,!i){e.next=6;break}return e.next=6,this.setConsumerPreferredLayers(i,s,o);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return et.apply(this,arguments)})},{key:"setConsumerPreferredLayers",value:(Xe=(0,i.Z)(p().mark((function e(t,r,a){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,r,a),e.prev=1,(n=this._consumers.get(t)).spatialLayers>1&&(n.preferredSpatialLayer=r,n.preferredTemporalLayer=a),e.next=6,this._protoo.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:a});case 6:Ie.dispatch(te(t,r,a)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),Be.error("setConsumerPreferredLayers() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error setting Consumer preferred layers: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e,t,r){return Xe.apply(this,arguments)})},{key:"setConsumerPriority",value:(Je=(0,i.Z)(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("setConsumerPriority() [consumerId:%s, priority:%d]",t,r),e.prev=1,e.next=4,this._protoo.request("setConsumerPriority",{consumerId:t,priority:r});case 4:Ie.dispatch(re(t,r)),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),Be.error("setConsumerPriority() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error setting Consumer priority: ".concat(e.t0)}));case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return Je.apply(this,arguments)})},{key:"requestConsumerKeyFrame",value:(Ye=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("requestConsumerKeyFrame() [consumerId:%s]",t),e.prev=1,e.next=4,this._protoo.request("requestConsumerKeyFrame",{consumerId:t});case 4:Ie.dispatch(se({text:"Keyframe requested for video consumer"})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),Be.error("requestConsumerKeyFrame() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error requesting key frame for Consumer: ".concat(e.t0)}));case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return Ye.apply(this,arguments)})},{key:"enableChatDataProducer",value:(Qe=(0,i.Z)(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("enableChatDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=e.sent,Ie.dispatch(z({id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol})),this._chatDataProducer.on("transportclose",(function(){t._chatDataProducer=null})),this._chatDataProducer.on("open",(function(){Be.debug('chat DataProducer "open" event')})),this._chatDataProducer.on("close",(function(){Be.error('chat DataProducer "close" event'),t._chatDataProducer=null,Ie.dispatch(se({type:"error",text:"Chat DataProducer closed"}))})),this._chatDataProducer.on("error",(function(e){Be.error('chat DataProducer "error" event:%o',e),Ie.dispatch(se({type:"error",text:"Chat DataProducer error: ".concat(e)}))})),this._chatDataProducer.on("bufferedamountlow",(function(){Be.debug('chat DataProducer "bufferedamountlow" event')})),e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(3),Be.error("enableChatDataProducer() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error enabling chat DataProducer: ".concat(e.t0)})),e.t0;case 20:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return Qe.apply(this,arguments)})},{key:"enableBotDataProducer",value:($e=(0,i.Z)(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("enableBotDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=e.sent,Ie.dispatch(z({id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol})),this._botDataProducer.on("transportclose",(function(){t._botDataProducer=null})),this._botDataProducer.on("open",(function(){Be.debug('bot DataProducer "open" event')})),this._botDataProducer.on("close",(function(){Be.error('bot DataProducer "close" event'),t._botDataProducer=null,Ie.dispatch(se({type:"error",text:"Bot DataProducer closed"}))})),this._botDataProducer.on("error",(function(e){Be.error('bot DataProducer "error" event:%o',e),Ie.dispatch(se({type:"error",text:"Bot DataProducer error: ".concat(e)}))})),this._botDataProducer.on("bufferedamountlow",(function(){Be.debug('bot DataProducer "bufferedamountlow" event')})),e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(3),Be.error("enableBotDataProducer() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error enabling bot DataProducer: ".concat(e.t0)})),e.t0;case 20:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return $e.apply(this,arguments)})},{key:"sendChatMessage",value:(Ke=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug('sendChatMessage() [text:"%s]',t),this._chatDataProducer){e.next=4;break}return Ie.dispatch(se({type:"error",text:"No chat DataProducer"})),e.abrupt("return");case 4:try{this._chatDataProducer.send(t)}catch(e){Be.error("chat DataProducer.send() failed:%o",e),Ie.dispatch(se({type:"error",text:"chat DataProducer.send() failed: ".concat(e)}))}case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Ke.apply(this,arguments)})},{key:"sendBotMessage",value:(qe=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug('sendBotMessage() [text:"%s]',t),this._botDataProducer){e.next=4;break}return Ie.dispatch(se({type:"error",text:"No bot DataProducer"})),e.abrupt("return");case 4:try{this._botDataProducer.send(t)}catch(e){Be.error("bot DataProducer.send() failed:%o",e),Ie.dispatch(se({type:"error",text:"bot DataProducer.send() failed: ".concat(e)}))}case 5:case"end":return e.stop()}}),e,this)}))),function(e){return qe.apply(this,arguments)})},{key:"changeDisplayName",value:(Ge=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug('changeDisplayName() [displayName:"%s"]',t),C({displayName:t}),e.prev=2,e.next=5,this._protoo.request("changeDisplayName",{displayName:t});case 5:this._displayName=t,Ie.dispatch(L(t)),Ie.dispatch(se({text:"Display name changed"})),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(2),Be.error("changeDisplayName() | failed: %o",e.t0),Ie.dispatch(se({type:"error",text:"Could not change display name: ".concat(e.t0)})),Ie.dispatch(L());case 15:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(e){return Ge.apply(this,arguments)})},{key:"openConnection",value:(Ze=(0,i.Z)(p().mark((function e(t){var r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.payload,e.next=3,this._protoo.request("openConnection",{roomId:r,payload:a}).catch((function(e){throw new Error(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ze.apply(this,arguments)})},{key:"closeConnection",value:(ze=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("closeConnection",{roomId:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return ze.apply(this,arguments)})},{key:"switchTo",value:(He=(0,i.Z)(p().mark((function e(t){var r,a,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.peerIds,n=t.payload,e.next=3,this._protoo.request("requestSwitchRoom",{roomId:r,peerIds:a,payload:n});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return He.apply(this,arguments)})},{key:"switchPeerRoom",value:(Ue=(0,i.Z)(p().mark((function e(t){var r,a,n,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.peerId,a=t.roomId,n=t.payload,i=t.token,e.next=3,this._protoo.request("switchPeerRoom",{roomId:a,peerId:r,payload:n,token:i});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ue.apply(this,arguments)})},{key:"connectionSwitchPeerRoom",value:(Ve=(0,i.Z)(p().mark((function e(t){var r,a,n,i,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.connectionRoomId,n=t.peerId,i=t.payload,s=t.token,e.next=3,this._protoo.request("connectionSwitchPeerRoom",{roomId:r,connectionRoomId:a,peerId:n,payload:i,token:s});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ve.apply(this,arguments)})},{key:"connectionSendChatMessage",value:(We=(0,i.Z)(p().mark((function e(t){var r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.message,e.next=3,this._protoo.request("connectionSendChatMessage",{roomId:r,message:a});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return We.apply(this,arguments)})},{key:"connectionEndMeeting",value:(Fe=(0,i.Z)(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,e.next=3,this._protoo.request("connectionCloseRoom",{roomId:r});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Fe.apply(this,arguments)})},{key:"pubsubPublish",value:(xe=(0,i.Z)(p().mark((function e(t,r,a){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._protoo.request("pubsubPublish",{topic:t,message:r,options:a});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Be.error("pubsubPublish() | failed: %o",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e,t,r){return xe.apply(this,arguments)})},{key:"pubsubSubscribe",value:(Te=(0,i.Z)(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._protoo.request("pubsubSubscribe",{topic:t});case 3:return r=e.sent,e.abrupt("return",r);case 7:e.prev=7,e.t0=e.catch(0),Be.error("pubsubSubscribe() | failed: %o",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return Te.apply(this,arguments)})},{key:"pubsubUnsubscribe",value:(we=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._protoo.request("pubsubUnsubscribe",{topic:t});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Be.error("pubsubUnsubscribe() | failed: %o",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e){return we.apply(this,arguments)})},{key:"closeRoom",value:(be=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("closeRoom",{});case 2:case"end":return e.stop()}}),e,this)}))),function(){return be.apply(this,arguments)})},{key:"removePeer",value:(ge=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._protoo.request("removePeer",{peerId:t});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return ge.apply(this,arguments)})},{key:"startPingPong",value:(ve=(0,i.Z)(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!=this._pingWebsocketInterval&&clearInterval(this._pingWebsocketInterval),this._pingWebsocketInterval=setInterval((function(){t.pingWebSocket()}),2e3);case 2:case"end":return e.stop()}}),e,this)}))),function(){return ve.apply(this,arguments)})},{key:"pingWebSocket",value:(_e=(0,i.Z)(p().mark((function e(){var t,r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}return e.abrupt("return");case 2:t=!1,this._protoo.request("ping").then((function(e){e&&(t=!0)})).catch((function(e){})),setTimeout((function(){t?(!r._isWebsocketAlive||r._pingWebsocketFailedCounter>1?(r._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CONNECTED"}),r._isWebsocketAlive=!0,r._pingWebsocketFailedCounter=0,r.restartIce()):"failed"!=r._transportState&&"disconnected"!=r._transportState||(console.log("Calling Restart Ice based on transport state",r._transportState),r.restartIce()),r._pingWebsocketFailedCounter=0):(r._isWebsocketAlive&&r._pingWebsocketFailedCounter>1&&(r._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"DISCONNECTED"}),r._isWebsocketAlive=!1,r.startInternetPingPong()),r._pingWebsocketFailedCounter=r._pingWebsocketFailedCounter+1)}),1e3);case 5:case"end":return e.stop()}}),e,this)}))),function(){return _e.apply(this,arguments)})},{key:"startInternetPingPong",value:(fe=(0,i.Z)(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!=this._pingInternetInterval&&clearInterval(this._pingInternetInterval),this._pingInternetInterval=setInterval((function(){t.pingInternet()}),2e3);case 2:case"end":return e.stop()}}),e,this)}))),function(){return fe.apply(this,arguments)})},{key:"pingInternet",value:(me=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("https://api.videosdk.live/ping",{method:"GET"}).then((function(e){return e.text()})).catch((function(e){return"failed"}));case 4:if("pong"!=e.sent){e.next=13;break}if(!(this._pingWebsocketFailedCounter>5&&this._pongInternetCounter>3)||this._isWebsocketAlive){e.next=11;break}return this._pongInternetCounter=0,this.close({sendLeft:!1}),e.next=11,this.join();case 11:this._pongInternetCounter=this._pongInternetCounter+1,this._isWebsocketAlive&&(this._pongInternetCounter=0,null!=this._pingInternetInterval&&(clearInterval(this._pingInternetInterval),this._pingInternetInterval=null));case 13:case"end":return e.stop()}}),e,this)}))),function(){return me.apply(this,arguments)})},{key:"getSendTransportRemoteStats",value:(he=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getSendTransportRemoteStats()"),this._sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._sendTransport.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return he.apply(this,arguments)})},{key:"getRecvTransportRemoteStats",value:(ue=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getRecvTransportRemoteStats()"),this._recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._recvTransport.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return ue.apply(this,arguments)})},{key:"getAudioRemoteStats",value:(le=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getAudioRemoteStats()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._latestStats[this._micProducer.id]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return le.apply(this,arguments)})},{key:"getVideoRemoteStats",value:(pe=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getVideoRemoteStats()"),t=this._webcamProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._latestStats[t.id]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return pe.apply(this,arguments)})},{key:"getShareRemoteStats",value:(de=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getVideoRemoteStats()"),t=this._shareProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._latestStats[t.id]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return de.apply(this,arguments)})},{key:"getConsumerRemoteStats",value:(D=(0,i.Z)(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getConsumerRemoteStats()"),r=this._consumers.get(t)){e.next=4;break}return e.abrupt("return");case 4:return this._latestStats[t]&&(this._latestStats[t][0].currentSpatialLayer=r.currentSpatialLayer,this._latestStats[t][0].currentTemporalLayer=r.currentTemporalLayer,this._latestStats[t][0].preferredSpatialLayer=r.preferredSpatialLayer,this._latestStats[t][0].preferredTemporalLayer=r.preferredTemporalLayer),e.abrupt("return",this._latestStats[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"getChatDataProducerRemoteStats",value:(x=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getChatDataProducerRemoteStats()"),t=this._chatDataProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:t.id}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"getBotDataProducerRemoteStats",value:(E=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getBotDataProducerRemoteStats()"),t=this._botDataProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:t.id}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"getDataConsumerRemoteStats",value:(P=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getDataConsumerRemoteStats()"),this._dataConsumers.get(t)){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataConsumerStats",{dataConsumerId:t}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"getSendTransportLocalStats",value:(R=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getSendTransportLocalStats()"),this._sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._sendTransport.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"getRecvTransportLocalStats",value:(k=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getRecvTransportLocalStats()"),this._recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._recvTransport.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"getAudioLocalStats",value:(S=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getAudioLocalStats()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._micProducer.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"getVideoLocalStats",value:(w=(0,i.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.debug("getVideoLocalStats()"),t=this._webcamProducer||this._shareProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",t.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getConsumerLocalStats",value:(y=(0,i.Z)(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._consumers.get(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"applyNetworkThrottle",value:(g=(0,i.Z)(p().mark((function e(t){var r,a,n,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uplink,a=t.downlink,n=t.rtt,i=t.secret,Be.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",r,a,n),e.prev=2,e.next=5,this._protoo.request("applyNetworkThrottle",{uplink:r,downlink:a,rtt:n,secret:i});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),Be.error("applyNetworkThrottle() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error applying network throttle: ".concat(e.t0)}));case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return g.apply(this,arguments)})},{key:"resetNetworkThrottle",value:(v=(0,i.Z)(p().mark((function e(t){var r,a,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silent,a=void 0!==r&&r,n=t.secret,Be.debug("resetNetworkThrottle()"),e.prev=2,e.next=5,this._protoo.request("resetNetworkThrottle",{secret:n});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),a||(Be.error("resetNetworkThrottle() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error resetting network throttle: ".concat(e.t0)})));case 10:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return v.apply(this,arguments)})},{key:"createProducerTransport",value:function(e){var t=this,r=e.id,a=e.iceParameters,n=e.iceCandidates,s=e.dtlsParameters,o=e.sctpParameters;this._sendTransport=this._mediasoupDevice.createSendTransport({id:r,iceParameters:a,iceCandidates:n,dtlsParameters:s,sctpParameters:o,iceServers:this._iceServers}),this._sendTransport.on("connect",(function(e,r,a){var n=e.dtlsParameters;t._protoo.request("connectWebRtcTransport",{transportId:t._sendTransport.id,dtlsParameters:n}).then(r).catch(a)})),this._sendTransport.on("produce",function(){var e=(0,i.Z)(p().mark((function e(r,a,n){var i,s,o,c,d;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.kind,s=r.rtpParameters,o=r.appData,e.prev=1,e.next=4,t._protoo.request("produce",{transportId:t._sendTransport.id,kind:i,rtpParameters:s,appData:o});case 4:c=e.sent,d=c.id,a({id:d}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r,a){return e.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var e=(0,i.Z)(p().mark((function e(r,a,n){var i,s,o,c,d,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.sctpStreamParameters,s=r.label,o=r.protocol,c=r.appData,Be.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',i,c),e.prev=2,e.next=5,t._protoo.request("produceData",{transportId:t._sendTransport.id,sctpStreamParameters:i,label:s,protocol:o,appData:c});case 5:d=e.sent,l=d.id,a({id:l}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),n(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r,a){return e.apply(this,arguments)}}()),this._sendTransport.on("connectionstatechange",(function(e){"failed"===e&&t.restartIce(),t._transportState=e}));var c=0,d=this._metrics.addNewProbe(this._sendTransport,"sendTransport");d.onStatsCollected=function(e){try{var r,a,n,i;if(t._stats.producerStats||(t._stats.producerStats={}),t._stats.producerStats.audio||(t._stats.producerStats.audio=[]),t._stats.producerStats.shareAudio||(t._stats.producerStats.shareAudio=[]),t._micProducer)t._latestStats[null===(r=t._micProducer)||void 0===r?void 0:r.id]=[];if(t._shareAudioProducer)t._latestStats[null===(a=t._shareAudioProducer)||void 0===a?void 0:a.id]=[];if(e.audio.forEach((function(e){var r,a,n;if(t._micProducer&&e.trackId==(null===(r=t._micProducer)||void 0===r?void 0:r.track.id))t._latestStats[null===(n=t._micProducer)||void 0===n?void 0:n.id].push(e),c%5==0&&t._stats.producerStats.audio.push(e);else if(t._shareAudioProducer&&e.trackId==(null===(a=t._shareAudioProducer)||void 0===a?void 0:a.track.id)){var i;t._latestStats[null===(i=t._shareAudioProducer)||void 0===i?void 0:i.id].push(e),c%5==0&&t._stats.producerStats.shareAudio.push(e)}})),t._stats.producerStats.video||(t._stats.producerStats.video=[]),t._stats.producerStats.share||(t._stats.producerStats.share=[]),t._webcamProducer)t._latestStats[null===(n=t._webcamProducer)||void 0===n?void 0:n.id]=[];if(t._shareProducer)t._latestStats[null===(i=t._shareProducer)||void 0===i?void 0:i.id]=[];e.video.forEach((function(e){var r,a,n;if(t._webcamProducer&&e.trackId==(null===(r=t._webcamProducer)||void 0===r?void 0:r.track.id))t._latestStats[null===(n=t._webcamProducer)||void 0===n?void 0:n.id].push(e);else if(t._shareProducer&&e.trackId==(null===(a=t._shareProducer)||void 0===a?void 0:a.track.id)){var i;t._latestStats[null===(i=t._shareProducer)||void 0===i?void 0:i.id].push(e)}})),c%5==0&&null!=t._webcamProducer&&t._stats.producerStats.video.push({timestamp:new Date,stats:t._latestStats[t._webcamProducer.id]}),c%5==0&&null!=t._shareProducer&&t._stats.producerStats.share.push({timestamp:new Date,stats:t._latestStats[t._shareProducer.id]}),c++}catch(e){console.log("PRODUCER ERROR",e)}},d.start(),this._sendTransport.observer.on("close",(function(){d.stop(),t._metrics.removeExistingProbe(d)}))}},{key:"createConsumerTransport",value:function(e){var t=this,r=e.id,a=e.iceParameters,n=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters;this._recvTransport=this._mediasoupDevice.createRecvTransport({id:r,iceParameters:a,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:this._iceServers}),this._recvTransport.on("connect",(function(e,r,a){var n=e.dtlsParameters;t._protoo.request("connectWebRtcTransport",{transportId:t._recvTransport.id,dtlsParameters:n}).then(r).catch(a)})),this._recvTransport.on("connectionstatechange",(function(e){"failed"===e&&t.restartIce(),t._transportState=e}));var o=0,c=this._metrics.addNewProbe(this._recvTransport,"transport");c.onStatsCollected=function(e){try{e.audio.forEach((function(e){var r=t._consumers.get(e.trackId);if(null!=r){var a=1==r.appData.share?"audio"==r.kind?"shareAudio":"share":r.kind;t._stats.consumerStats||(t._stats.consumerStats={}),t._stats.consumerStats[r.appData.peerId]||(t._stats.consumerStats[r.appData.peerId]={}),t._stats.consumerStats[r.appData.peerId][a]||(t._stats.consumerStats[r.appData.peerId][a]=[]),e.trackId==r.id&&(t._latestStats[r.id]=[],t._latestStats[r.id].push(e),o%5==0&&t._stats.consumerStats[r.appData.peerId][a].push(e))}})),e.video.forEach((function(e){var r=t._consumers.get(e.trackId);if(null!=r){var a=1==r.appData.share?"audio"==r.kind?"shareAudio":"share":r.kind;t._stats.consumerStats||(t._stats.consumerStats={}),t._stats.consumerStats[r.appData.peerId]||(t._stats.consumerStats[r.appData.peerId]={}),t._stats.consumerStats[r.appData.peerId][a]||(t._stats.consumerStats[r.appData.peerId][a]=[]),e.trackId==r.id&&(t._latestStats[r.id]=[],t._latestStats[r.id].push(e),o%5==0&&t._stats.consumerStats[r.appData.peerId][a].push(e))}})),o++}catch(e){console.log("CONSUMER CATCH",e)}},c.start(),this._recvTransport.observer.on("close",(function(){c.stop(),t._metrics.removeExistingProbe(c)}))}},{key:"joinRoom",value:(_=(0,i.Z)(p().mark((function e(){var t,r,a,n,i,s,o,c,d,l,h,m,f,_,v,g,y=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("joinRoom()"),e.prev=1,this._mediasoupDevice=new u.Device({handlerName:this._handlerName}),e.next=5,this._protoo.request("getRouterRtpCapabilities");case 5:return a=e.sent,e.next=8,this._mediasoupDevice.load({routerRtpCapabilities:a});case 8:if(!this._produce){e.next=13;break}return e.next=11,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 11:n=e.sent,this.createProducerTransport(n);case 13:if(!this._consume){e.next=18;break}return e.next=16,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 16:i=e.sent,this.createConsumerTransport(i);case 18:return e.next=20,this._protoo.request("join",{displayName:this._displayName,device:this._device,secret:this._secret,rtpCapabilities:null===(t=this._mediasoupDevice)||void 0===t?void 0:t.rtpCapabilities,sctpCapabilities:null===(r=this._mediasoupDevice)||void 0===r?void 0:r.sctpCapabilities,deviceInfo:this._deviceInfo,autoConsume:this._autoConsume});case 20:s=e.sent,o=s.peers,c=s.poll,d=s.messages,Ie.dispatch(I("connected")),this._eventEmitter.emit("MEETING_JOINED",{peers:o,poll:c,messages:d,baseUrl:this._baseUrl}),Ie.dispatch({type:"REMOVE_ALL_NOTIFICATIONS"}),Ie.dispatch(se({text:"You are in the room!",timeout:3e3})),l=Ce(o);try{for(l.s();!(h=l.n()).done;)m=h.value,f=q(De(De({},m),{},{consumers:[],dataConsumers:[]})),Ie.dispatch(f),this._eventEmitter.emit(f.type,f.payload)}catch(e){l.e(e)}finally{l.f()}this._produce&&(Ie.dispatch(A({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled?this.enableMic(this.customMicrophoneAudioTrack):this.customMicrophoneAudioTrack&&this.customMicrophoneAudioTrack.getTracks().forEach((function(e){e.stop()})),_=T(),this._webcamEnabled&&(!_||_.webcamEnabled||this._externalVideo)?this.enableWebcam(this.customCameraVideoTrack):this.customCameraVideoTrack&&this.customCameraVideoTrack.getTracks().forEach((function(e){e.stop()})),this.enableChatDataProducer()),this._usageInterval=setInterval((function(){y.useSpartialLayerAnalytics?y._updateUsageStats({useSpartial:!0}):y._updateUsageStats({})}),1e3*this._usageIntervalDuration),window.SHOW_INFO&&(v=Ie.getState(),g=v.me,Ie.dispatch(M(g.id))),e.next=40;break;case 35:e.prev=35,e.t0=e.catch(1),Be.error("joinRoom() failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Could not join the room: ".concat(e.t0)})),this.close({sendLeft:!0});case 40:case"end":return e.stop()}}),e,this,[[1,35]])}))),function(){return _.apply(this,arguments)})},{key:"_updateUsageStats",value:(f=(0,i.Z)(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._consumers.size<=0)){e.next=2;break}return e.abrupt("return");case 2:this._consumers.forEach((function(e,a){if("video"!=e.kind||e.paused)"audio"!=e.kind||e.paused||r._audioConsumption++;else{var n;if(t.useSpartial)n=r._getResolutionFromSpatialLayer(Ie.getState().consumers[a].currentSpatialLayer);else{var i=e._track.getSettings();n=i.width>i.height?i.height:i.width}var s=null;s=e._appData.share?"".concat(e.appData.peerId,"-screen"):e.appData.peerId,r._usageDataPointsPeerMaxRes.has(s)?r._usageDataPointsPeerMaxRes.get(s)<n&&r._usageDataPointsPeerMaxRes.set(s,n):r._usageDataPointsPeerMaxRes.set(s,n)}}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_updateMics",value:(m=(0,i.Z)(p().mark((function e(){var t,r,a,n,i,s,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._mics=new Map,Be.debug("_updateMics() |"),e.next=4,navigator.mediaDevices.enumerateDevices();case 4:t=e.sent,r=Ce(t);try{for(r.s();!(a=r.n()).done;)"audioinput"==(n=a.value).kind&&this._mics.set(n.deviceId,n)}catch(e){r.e(e)}finally{r.f()}i=Array.from(this._mics.values()),s=i.length,o=this._mic.device?this._mic.device.deviceId:void 0,0===s?this._mic.device=null:this._mics.has(o)||(this._mic.device=i[0]);case 11:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"_updateWebcams",value:(h=(0,i.Z)(p().mark((function e(){var t,r,a,n,i,s,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.debug("_updateWebcams()"),this._webcams=new Map,Be.debug("_updateWebcams() | calling enumerateDevices()"),e.next=5,navigator.mediaDevices.enumerateDevices();case 5:t=e.sent,r=Ce(t),e.prev=7,r.s();case 9:if((a=r.n()).done){e.next=16;break}if("videoinput"===(n=a.value).kind){e.next=13;break}return e.abrupt("continue",14);case 13:this._webcams.set(n.deviceId,n);case 14:e.next=9;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:i=Array.from(this._webcams.values()),s=i.length,o=this._webcam.device?this._webcam.device.deviceId:void 0,Be.debug("_updateWebcams() [webcams:%o]",i),0===s?this._webcam.device=null:this._webcams.has(o)||(this._webcam.device=i[0]),Ie.dispatch({type:"SET_CAN_CHANGE_WEBCAM",payload:this._webcams.size>1});case 30:case"end":return e.stop()}}),e,this,[[7,18,21,24]])}))),function(){return h.apply(this,arguments)})},{key:"_getWebcamType",value:function(e){return/(back|rear)/i.test(e.label)?(Be.debug("_getWebcamType() | it seems to be a back camera"),"back"):(Be.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:(d=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("pauseConsumer",{consumerId:t.id});case 5:t.pause(),Ie.dispatch(J(t.id,"local")),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),Be.error("_pauseConsumer() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error pausing Consumer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return d.apply(this,arguments)})},{key:"_resumeConsumer",value:(r=(0,i.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("resumeConsumer",{consumerId:t.id});case 5:t.resume(),Ie.dispatch(X(t.id,"local")),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),Be.error("_resumeConsumer() | failed:%o",e.t0),Ie.dispatch(se({type:"error",text:"Error resuming Consumer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return r.apply(this,arguments)})},{key:"_getExternalVideoStream",value:(t=(0,i.Z)(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._externalVideoStream){e.next=2;break}return e.abrupt("return",this._externalVideoStream);case 2:if(!(this._externalVideo.readyState<3)){e.next=5;break}return e.next=5,new Promise((function(e){return t._externalVideo.addEventListener("canplay",e)}));case 5:if(!this._externalVideo.captureStream){e.next=9;break}this._externalVideoStream=this._externalVideo.captureStream(),e.next=14;break;case 9:if(!this._externalVideo.mozCaptureStream){e.next=13;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),e.next=14;break;case 13:throw new Error("video.captureStream() not supported");case 14:return e.abrupt("return",this._externalVideoStream);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_getRoundedResolution",value:function(e){if(!e)return 0;switch(!0){case e<=180:return e=180;case e>180&&e<=360:return e=360;case e>360&&e<=720:return e=720;case e>720&&e<=1080:return e=1080;case e>1080&&e<=1440:return e=1440;case e>1440:return e=2160}}},{key:"_getResolutionFromSpatialLayer",value:function(e){switch(e){case 0:return 180;case 1:default:return 360;case 2:return 720;case 3:return 1080}}},{key:"_emitError",value:function(e){this._eventEmitter.emit("ERROR",e)}}],[{key:"init",value:function(e){Ie=e.store}}]),e}()},1206:function(e){e.exports=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a=r(18),n=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,a){void 0===a&&(a=!1);var n=e.getVersionPrecision(t),i=e.getVersionPrecision(r),s=Math.max(n,i),o=0,c=e.map([t,r],(function(t){var r=s-e.getVersionPrecision(t),a=t+new Array(r+1).join(".0");return e.map(a.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(a&&(o=s-Math.min(n,i)),s-=1;s>=o;){if(c[0][s]>c[1][s])return 1;if(c[0][s]===c[1][s]){if(s===o)return 0;s-=1}else if(c[0][s]<c[1][s])return-1}},e.map=function(e,t){var r,a=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)a.push(t(e[r]));return a},e.find=function(e,t){var r,a;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,a=e.length;r<a;r+=1){var n=e[r];if(t(n,r))return n}},e.assign=function(e){for(var t,r,a=e,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(i));var o=function(){var e=i[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){a[t]=e[t]}))};for(t=0,r=i.length;t<r;t+=1)o();return e},e.getBrowserAlias=function(e){return a.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return a.BROWSER_MAP[e]||""},e}();t.default=n,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(91))&&a.__esModule?a:{default:a},i=r(18);function s(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=function(){function e(){}var t,r,a;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},t=e,a=[{key:"BROWSER_MAP",get:function(){return i.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return i.ENGINE_MAP}},{key:"OS_MAP",get:function(){return i.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return i.PLATFORMS_MAP}}],(r=null)&&s(t.prototype,r),a&&s(t,a),e}();t.default=o,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a=c(r(92)),n=c(r(93)),i=c(r(94)),s=c(r(95)),o=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=o.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=o.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=o.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=o.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return o.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},a=0,n={},i=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(n[t]=s,i+=1):"object"==typeof s&&(r[t]=s,a+=1)})),a>0){var s=Object.keys(r),c=o.default.find(s,(function(e){return t.isOS(e)}));if(c){var d=this.satisfies(r[c]);if(void 0!==d)return d}var p=o.default.find(s,(function(e){return t.isPlatform(e)}));if(p){var l=this.satisfies(r[p]);if(void 0!==l)return l}}if(i>0){var u=Object.keys(n),h=o.default.find(u,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(n[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),a=e.toLowerCase(),n=o.default.getBrowserTypeByAlias(a);return t&&n&&(a=n.toLowerCase()),a===r},t.compareVersion=function(e){var t=[0],r=e,a=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(a=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(a=!0,r=e.substr(1)),t.indexOf(o.default.compareVersions(n,r,a))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=r(18),s=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:i.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=n.default.getWindowsVersionName(t);return{name:i.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:i.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(t),a={name:i.OS_MAP.MacOS,version:t};return r&&(a.versionName=r),a}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=n.default.getAndroidVersionName(t),a={name:i.OS_MAP.Android,version:t};return r&&(a.versionName=r),a}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:i.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:i.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=r(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=r(18),s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:i.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:i.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:i.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:i.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:i.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:i.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=s,e.exports=t.default}})},452:function(e,t,r){var a;e.exports=(a=r(8249),r(8269),r(8214),r(888),r(5109),function(){var e=a,t=e.lib.BlockCipher,r=e.algo,n=[],i=[],s=[],o=[],c=[],d=[],p=[],l=[],u=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,a=0;for(t=0;t<256;t++){var m=a^a<<1^a<<2^a<<3^a<<4;m=m>>>8^255&m^99,n[r]=m,i[m]=r;var f=e[r],_=e[f],v=e[_],g=257*e[m]^16843008*m;s[r]=g<<24|g>>>8,o[r]=g<<16|g>>>16,c[r]=g<<8|g>>>24,d[r]=g,g=16843009*v^65537*_^257*f^16843008*r,p[m]=g<<24|g>>>8,l[m]=g<<16|g>>>16,u[m]=g<<8|g>>>24,h[m]=g,r?(r=f^e[e[e[v^f]]],a^=e[e[a]]):r=a=1}}();var m=[0,1,2,4,8,16,32,64,128,27,54],f=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,a=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],s=0;s<a;s++)s<r?i[s]=t[s]:(d=i[s-1],s%r?r>6&&s%r==4&&(d=n[d>>>24]<<24|n[d>>>16&255]<<16|n[d>>>8&255]<<8|n[255&d]):(d=n[(d=d<<8|d>>>24)>>>24]<<24|n[d>>>16&255]<<16|n[d>>>8&255]<<8|n[255&d],d^=m[s/r|0]<<24),i[s]=i[s-r]^d);for(var o=this._invKeySchedule=[],c=0;c<a;c++){if(s=a-c,c%4)var d=i[s];else d=i[s-4];o[c]=c<4||s<=4?d:p[n[d>>>24]]^l[n[d>>>16&255]]^u[n[d>>>8&255]]^h[n[255&d]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,o,c,d,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,p,l,u,h,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,a,n,i,s,o){for(var c=this._nRounds,d=e[t]^r[0],p=e[t+1]^r[1],l=e[t+2]^r[2],u=e[t+3]^r[3],h=4,m=1;m<c;m++){var f=a[d>>>24]^n[p>>>16&255]^i[l>>>8&255]^s[255&u]^r[h++],_=a[p>>>24]^n[l>>>16&255]^i[u>>>8&255]^s[255&d]^r[h++],v=a[l>>>24]^n[u>>>16&255]^i[d>>>8&255]^s[255&p]^r[h++],g=a[u>>>24]^n[d>>>16&255]^i[p>>>8&255]^s[255&l]^r[h++];d=f,p=_,l=v,u=g}f=(o[d>>>24]<<24|o[p>>>16&255]<<16|o[l>>>8&255]<<8|o[255&u])^r[h++],_=(o[p>>>24]<<24|o[l>>>16&255]<<16|o[u>>>8&255]<<8|o[255&d])^r[h++],v=(o[l>>>24]<<24|o[u>>>16&255]<<16|o[d>>>8&255]<<8|o[255&p])^r[h++],g=(o[u>>>24]<<24|o[d>>>16&255]<<16|o[p>>>8&255]<<8|o[255&l])^r[h++],e[t]=f,e[t+1]=_,e[t+2]=v,e[t+3]=g},keySize:8});e.AES=t._createHelper(f)}(),a.AES)},5109:function(e,t,r){var a;e.exports=(a=r(8249),r(888),void(a.lib.Cipher||function(e){var t=a,r=t.lib,n=r.Base,i=r.WordArray,s=r.BufferedBlockAlgorithm,o=t.enc,c=(o.Utf8,o.Base64),d=t.algo.EvpKDF,p=r.Cipher=s.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:v}return function(t){return{encrypt:function(r,a,n){return e(a).encrypt(t,r,a,n)},decrypt:function(r,a,n){return e(a).decrypt(t,r,a,n)}}}}()}),l=(r.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),u=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=l.CBC=function(){var t=u.extend();function r(t,r,a){var n,i=this._iv;i?(n=i,this._iv=e):n=this._prevBlock;for(var s=0;s<a;s++)t[r+s]^=n[s]}return t.Encryptor=t.extend({processBlock:function(e,t){var a=this._cipher,n=a.blockSize;r.call(this,e,t,n),a.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),t.Decryptor=t.extend({processBlock:function(e,t){var a=this._cipher,n=a.blockSize,i=e.slice(t,t+n);a.decryptBlock(e,t),r.call(this,e,t,n),this._prevBlock=i}}),t}(),m=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,a=r-e.sigBytes%r,n=a<<24|a<<16|a<<8|a,s=[],o=0;o<a;o+=4)s.push(n);var c=i.create(s,a);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},f=(r.BlockCipher=p.extend({cfg:p.cfg.extend({mode:h,padding:m}),reset:function(){var e;p.reset.call(this);var t=this.cfg,r=t.iv,a=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=a.createEncryptor:(e=a.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(a,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),_=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?i.create([1398893684,1701076831]).concat(r).concat(t):t).toString(c)},parse:function(e){var t,r=c.parse(e),a=r.words;return 1398893684==a[0]&&1701076831==a[1]&&(t=i.create(a.slice(2,4)),a.splice(0,4),r.sigBytes-=16),f.create({ciphertext:r,salt:t})}},v=r.SerializableCipher=n.extend({cfg:n.extend({format:_}),encrypt:function(e,t,r,a){a=this.cfg.extend(a);var n=e.createEncryptor(r,a),i=n.finalize(t),s=n.cfg;return f.create({ciphertext:i,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:a.format})},decrypt:function(e,t,r,a){return a=this.cfg.extend(a),t=this._parse(t,a.format),e.createDecryptor(r,a).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),g=(t.kdf={}).OpenSSL={execute:function(e,t,r,a){a||(a=i.random(8));var n=d.create({keySize:t+r}).compute(e,a),s=i.create(n.words.slice(t),4*r);return n.sigBytes=4*t,f.create({key:n,iv:s,salt:a})}},y=r.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:g}),encrypt:function(e,t,r,a){var n=(a=this.cfg.extend(a)).kdf.execute(r,e.keySize,e.ivSize);a.iv=n.iv;var i=v.encrypt.call(this,e,t,n.key,a);return i.mixIn(n),i},decrypt:function(e,t,r,a){a=this.cfg.extend(a),t=this._parse(t,a.format);var n=a.kdf.execute(r,e.keySize,e.ivSize,t.salt);return a.iv=n.iv,v.decrypt.call(this,e,t,n.key,a)}})}()))},8249:function(e,t,r){var a;e.exports=(a=a||function(e,t){var a;if("undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(a=globalThis.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&void 0!==r.g&&r.g.crypto&&(a=r.g.crypto),!a)try{a=r(2480)}catch(e){}var n=function(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),s={},o=s.lib={},c=o.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},d=o.WordArray=c.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,a=this.sigBytes,n=e.sigBytes;if(this.clamp(),a%4)for(var i=0;i<n;i++){var s=r[i>>>2]>>>24-i%4*8&255;t[a+i>>>2]|=s<<24-(a+i)%4*8}else for(var o=0;o<n;o+=4)t[a+o>>>2]=r[o>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new d.init(t,e)}}),p=s.enc={},l=p.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;a.push((i>>>4).toString(16)),a.push((15&i).toString(16))}return a.join("")},parse:function(e){for(var t=e.length,r=[],a=0;a<t;a+=2)r[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new d.init(r,t/2)}},u=p.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;a.push(String.fromCharCode(i))}return a.join("")},parse:function(e){for(var t=e.length,r=[],a=0;a<t;a++)r[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new d.init(r,t)}},h=p.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},m=o.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,a=this._data,n=a.words,i=a.sigBytes,s=this.blockSize,o=i/(4*s),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,p=e.min(4*c,i);if(c){for(var l=0;l<c;l+=s)this._doProcessBlock(n,l);r=n.splice(0,c),a.sigBytes-=p}return new d.init(r,p)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(o.Hasher=m.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}}),s.algo={});return s}(Math),a)},8269:function(e,t,r){var a;e.exports=(a=r(8249),function(){var e=a,t=e.lib.WordArray;function r(e,r,a){for(var n=[],i=0,s=0;s<r;s++)if(s%4){var o=a[e.charCodeAt(s-1)]<<s%4*2|a[e.charCodeAt(s)]>>>6-s%4*2;n[i>>>2]|=o<<24-i%4*8,i++}return t.create(n,i)}e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,a=this._map;e.clamp();for(var n=[],i=0;i<r;i+=3)for(var s=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;o<4&&i+.75*o<r;o++)n.push(a.charAt(s>>>6*(3-o)&63));var c=a.charAt(64);if(c)for(;n.length%4;)n.push(c);return n.join("")},parse:function(e){var t=e.length,a=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<a.length;i++)n[a.charCodeAt(i)]=i}var s=a.charAt(64);if(s){var o=e.indexOf(s);-1!==o&&(t=o)}return r(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),a.enc.Base64)},3786:function(e,t,r){var a;e.exports=(a=r(8249),function(){var e=a,t=e.lib.WordArray;function r(e,r,a){for(var n=[],i=0,s=0;s<r;s++)if(s%4){var o=a[e.charCodeAt(s-1)]<<s%4*2|a[e.charCodeAt(s)]>>>6-s%4*2;n[i>>>2]|=o<<24-i%4*8,i++}return t.create(n,i)}e.enc.Base64url={stringify:function(e,t=!0){var r=e.words,a=e.sigBytes,n=t?this._safe_map:this._map;e.clamp();for(var i=[],s=0;s<a;s+=3)for(var o=(r[s>>>2]>>>24-s%4*8&255)<<16|(r[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|r[s+2>>>2]>>>24-(s+2)%4*8&255,c=0;c<4&&s+.75*c<a;c++)i.push(n.charAt(o>>>6*(3-c)&63));var d=n.charAt(64);if(d)for(;i.length%4;)i.push(d);return i.join("")},parse:function(e,t=!0){var a=e.length,n=t?this._safe_map:this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var s=0;s<n.length;s++)i[n.charCodeAt(s)]=s}var o=n.charAt(64);if(o){var c=e.indexOf(o);-1!==c&&(a=c)}return r(e,a,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),a.enc.Base64url)},298:function(e,t,r){var a;e.exports=(a=r(8249),function(){var e=a,t=e.lib.WordArray,r=e.enc;function n(e){return e<<8&4278255360|e>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],n=0;n<r;n+=2){var i=t[n>>>2]>>>16-n%4*8&65535;a.push(String.fromCharCode(i))}return a.join("")},parse:function(e){for(var r=e.length,a=[],n=0;n<r;n++)a[n>>>1]|=e.charCodeAt(n)<<16-n%2*16;return t.create(a,2*r)}},r.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],i=0;i<r;i+=2){var s=n(t[i>>>2]>>>16-i%4*8&65535);a.push(String.fromCharCode(s))}return a.join("")},parse:function(e){for(var r=e.length,a=[],i=0;i<r;i++)a[i>>>1]|=n(e.charCodeAt(i)<<16-i%2*16);return t.create(a,2*r)}}}(),a.enc.Utf16)},888:function(e,t,r){var a,n,i,s,o,c,d,p;e.exports=(p=r(8249),r(2783),r(9824),n=(a=p).lib,i=n.Base,s=n.WordArray,o=a.algo,c=o.MD5,d=o.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,a=this.cfg,n=a.hasher.create(),i=s.create(),o=i.words,c=a.keySize,d=a.iterations;o.length<c;){r&&n.update(r),r=n.update(e).finalize(t),n.reset();for(var p=1;p<d;p++)r=n.finalize(r),n.reset();i.concat(r)}return i.sigBytes=4*c,i}}),a.EvpKDF=function(e,t,r){return d.create(r).compute(e,t)},p.EvpKDF)},2209:function(e,t,r){var a,n,i,s;e.exports=(s=r(8249),r(5109),n=(a=s).lib.CipherParams,i=a.enc.Hex,a.format.Hex={stringify:function(e){return e.ciphertext.toString(i)},parse:function(e){var t=i.parse(e);return n.create({ciphertext:t})}},s.format.Hex)},9824:function(e,t,r){var a,n,i,s;e.exports=(a=r(8249),i=(n=a).lib.Base,s=n.enc.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var r=e.blockSize,a=4*r;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),i=this._iKey=t.clone(),o=n.words,c=i.words,d=0;d<r;d++)o[d]^=1549556828,c[d]^=909522486;n.sigBytes=i.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},1354:function(e,t,r){var a;e.exports=(a=r(8249),r(4938),r(4433),r(298),r(8269),r(3786),r(8214),r(2783),r(2153),r(7792),r(34),r(7460),r(3327),r(706),r(9824),r(2112),r(888),r(5109),r(8568),r(4242),r(9968),r(7660),r(1148),r(3615),r(2807),r(1077),r(6475),r(6991),r(2209),r(452),r(4253),r(1857),r(4454),r(3974),a)},4433:function(e,t,r){var a;e.exports=(a=r(8249),function(){if("function"==typeof ArrayBuffer){var e=a.lib.WordArray,t=e.init,r=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,a=[],n=0;n<r;n++)a[n>>>2]|=e[n]<<24-n%4*8;t.call(this,a,r)}else t.apply(this,arguments)};r.prototype=e}}(),a.lib.WordArray)},8214:function(e,t,r){var a;e.exports=(a=r(8249),function(e){var t=a,r=t.lib,n=r.WordArray,i=r.Hasher,s=t.algo,o=[];!function(){for(var t=0;t<64;t++)o[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=s.MD5=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var a=t+r,n=e[a];e[a]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var i=this._hash.words,s=e[t+0],c=e[t+1],h=e[t+2],m=e[t+3],f=e[t+4],_=e[t+5],v=e[t+6],g=e[t+7],y=e[t+8],b=e[t+9],w=e[t+10],S=e[t+11],k=e[t+12],R=e[t+13],P=e[t+14],E=e[t+15],C=i[0],T=i[1],x=i[2],D=i[3];C=d(C,T,x,D,s,7,o[0]),D=d(D,C,T,x,c,12,o[1]),x=d(x,D,C,T,h,17,o[2]),T=d(T,x,D,C,m,22,o[3]),C=d(C,T,x,D,f,7,o[4]),D=d(D,C,T,x,_,12,o[5]),x=d(x,D,C,T,v,17,o[6]),T=d(T,x,D,C,g,22,o[7]),C=d(C,T,x,D,y,7,o[8]),D=d(D,C,T,x,b,12,o[9]),x=d(x,D,C,T,w,17,o[10]),T=d(T,x,D,C,S,22,o[11]),C=d(C,T,x,D,k,7,o[12]),D=d(D,C,T,x,R,12,o[13]),x=d(x,D,C,T,P,17,o[14]),C=p(C,T=d(T,x,D,C,E,22,o[15]),x,D,c,5,o[16]),D=p(D,C,T,x,v,9,o[17]),x=p(x,D,C,T,S,14,o[18]),T=p(T,x,D,C,s,20,o[19]),C=p(C,T,x,D,_,5,o[20]),D=p(D,C,T,x,w,9,o[21]),x=p(x,D,C,T,E,14,o[22]),T=p(T,x,D,C,f,20,o[23]),C=p(C,T,x,D,b,5,o[24]),D=p(D,C,T,x,P,9,o[25]),x=p(x,D,C,T,m,14,o[26]),T=p(T,x,D,C,y,20,o[27]),C=p(C,T,x,D,R,5,o[28]),D=p(D,C,T,x,h,9,o[29]),x=p(x,D,C,T,g,14,o[30]),C=l(C,T=p(T,x,D,C,k,20,o[31]),x,D,_,4,o[32]),D=l(D,C,T,x,y,11,o[33]),x=l(x,D,C,T,S,16,o[34]),T=l(T,x,D,C,P,23,o[35]),C=l(C,T,x,D,c,4,o[36]),D=l(D,C,T,x,f,11,o[37]),x=l(x,D,C,T,g,16,o[38]),T=l(T,x,D,C,w,23,o[39]),C=l(C,T,x,D,R,4,o[40]),D=l(D,C,T,x,s,11,o[41]),x=l(x,D,C,T,m,16,o[42]),T=l(T,x,D,C,v,23,o[43]),C=l(C,T,x,D,b,4,o[44]),D=l(D,C,T,x,k,11,o[45]),x=l(x,D,C,T,E,16,o[46]),C=u(C,T=l(T,x,D,C,h,23,o[47]),x,D,s,6,o[48]),D=u(D,C,T,x,g,10,o[49]),x=u(x,D,C,T,P,15,o[50]),T=u(T,x,D,C,_,21,o[51]),C=u(C,T,x,D,k,6,o[52]),D=u(D,C,T,x,m,10,o[53]),x=u(x,D,C,T,w,15,o[54]),T=u(T,x,D,C,c,21,o[55]),C=u(C,T,x,D,y,6,o[56]),D=u(D,C,T,x,E,10,o[57]),x=u(x,D,C,T,v,15,o[58]),T=u(T,x,D,C,R,21,o[59]),C=u(C,T,x,D,f,6,o[60]),D=u(D,C,T,x,S,10,o[61]),x=u(x,D,C,T,h,15,o[62]),T=u(T,x,D,C,b,21,o[63]),i[0]=i[0]+C|0,i[1]=i[1]+T|0,i[2]=i[2]+x|0,i[3]=i[3]+D|0},_doFinalize:function(){var t=this._data,r=t.words,a=8*this._nDataBytes,n=8*t.sigBytes;r[n>>>5]|=128<<24-n%32;var i=e.floor(a/4294967296),s=a;r[15+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(r.length+1),this._process();for(var o=this._hash,c=o.words,d=0;d<4;d++){var p=c[d];c[d]=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8)}return o},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function d(e,t,r,a,n,i,s){var o=e+(t&r|~t&a)+n+s;return(o<<i|o>>>32-i)+t}function p(e,t,r,a,n,i,s){var o=e+(t&a|r&~a)+n+s;return(o<<i|o>>>32-i)+t}function l(e,t,r,a,n,i,s){var o=e+(t^r^a)+n+s;return(o<<i|o>>>32-i)+t}function u(e,t,r,a,n,i,s){var o=e+(r^(t|~a))+n+s;return(o<<i|o>>>32-i)+t}t.MD5=i._createHelper(c),t.HmacMD5=i._createHmacHelper(c)}(Math),a.MD5)},8568:function(e,t,r){var a;e.exports=(a=r(8249),r(5109),a.mode.CFB=function(){var e=a.lib.BlockCipherMode.extend();function t(e,t,r,a){var n,i=this._iv;i?(n=i.slice(0),this._iv=void 0):n=this._prevBlock,a.encryptBlock(n,0);for(var s=0;s<r;s++)e[t+s]^=n[s]}return e.Encryptor=e.extend({processBlock:function(e,r){var a=this._cipher,n=a.blockSize;t.call(this,e,r,n,a),this._prevBlock=e.slice(r,r+n)}}),e.Decryptor=e.extend({processBlock:function(e,r){var a=this._cipher,n=a.blockSize,i=e.slice(r,r+n);t.call(this,e,r,n,a),this._prevBlock=i}}),e}(),a.mode.CFB)},9968:function(e,t,r){var a;e.exports=(a=r(8249),r(5109),a.mode.CTRGladman=function(){var e=a.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,r=e>>8&255,a=255&e;255===t?(t=0,255===r?(r=0,255===a?a=0:++a):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=a}else e+=1<<24;return e}function r(e){return 0===(e[0]=t(e[0]))&&(e[1]=t(e[1])),e}var n=e.Encryptor=e.extend({processBlock:function(e,t){var a=this._cipher,n=a.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0),r(s);var o=s.slice(0);a.encryptBlock(o,0);for(var c=0;c<n;c++)e[t+c]^=o[c]}});return e.Decryptor=n,e}(),a.mode.CTRGladman)},4242:function(e,t,r){var a,n,i;e.exports=(i=r(8249),r(5109),i.mode.CTR=(a=i.lib.BlockCipherMode.extend(),n=a.Encryptor=a.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize,n=this._iv,i=this._counter;n&&(i=this._counter=n.slice(0),this._iv=void 0);var s=i.slice(0);r.encryptBlock(s,0),i[a-1]=i[a-1]+1|0;for(var o=0;o<a;o++)e[t+o]^=s[o]}}),a.Decryptor=n,a),i.mode.CTR)},1148:function(e,t,r){var a,n;e.exports=(n=r(8249),r(5109),n.mode.ECB=((a=n.lib.BlockCipherMode.extend()).Encryptor=a.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),a.Decryptor=a.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),a),n.mode.ECB)},7660:function(e,t,r){var a,n,i;e.exports=(i=r(8249),r(5109),i.mode.OFB=(a=i.lib.BlockCipherMode.extend(),n=a.Encryptor=a.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize,n=this._iv,i=this._keystream;n&&(i=this._keystream=n.slice(0),this._iv=void 0),r.encryptBlock(i,0);for(var s=0;s<a;s++)e[t+s]^=i[s]}}),a.Decryptor=n,a),i.mode.OFB)},3615:function(e,t,r){var a;e.exports=(a=r(8249),r(5109),a.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,a=4*t,n=a-r%a,i=r+n-1;e.clamp(),e.words[i>>>2]|=n<<24-i%4*8,e.sigBytes+=n},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},a.pad.Ansix923)},2807:function(e,t,r){var a;e.exports=(a=r(8249),r(5109),a.pad.Iso10126={pad:function(e,t){var r=4*t,n=r-e.sigBytes%r;e.concat(a.lib.WordArray.random(n-1)).concat(a.lib.WordArray.create([n<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},a.pad.Iso10126)},1077:function(e,t,r){var a;e.exports=(a=r(8249),r(5109),a.pad.Iso97971={pad:function(e,t){e.concat(a.lib.WordArray.create([2147483648],1)),a.pad.ZeroPadding.pad(e,t)},unpad:function(e){a.pad.ZeroPadding.unpad(e),e.sigBytes--}},a.pad.Iso97971)},6991:function(e,t,r){var a;e.exports=(a=r(8249),r(5109),a.pad.NoPadding={pad:function(){},unpad:function(){}},a.pad.NoPadding)},6475:function(e,t,r){var a;e.exports=(a=r(8249),r(5109),a.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){var t=e.words,r=e.sigBytes-1;for(r=e.sigBytes-1;r>=0;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},a.pad.ZeroPadding)},2112:function(e,t,r){var a,n,i,s,o,c,d,p,l;e.exports=(l=r(8249),r(2783),r(9824),n=(a=l).lib,i=n.Base,s=n.WordArray,o=a.algo,c=o.SHA1,d=o.HMAC,p=o.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,a=d.create(r.hasher,e),n=s.create(),i=s.create([1]),o=n.words,c=i.words,p=r.keySize,l=r.iterations;o.length<p;){var u=a.update(t).finalize(i);a.reset();for(var h=u.words,m=h.length,f=u,_=1;_<l;_++){f=a.finalize(f),a.reset();for(var v=f.words,g=0;g<m;g++)h[g]^=v[g]}n.concat(u),c[0]++}return n.sigBytes=4*p,n}}),a.PBKDF2=function(e,t,r){return p.create(r).compute(e,t)},l.PBKDF2)},3974:function(e,t,r){var a;e.exports=(a=r(8249),r(8269),r(8214),r(888),r(5109),function(){var e=a,t=e.lib.StreamCipher,r=e.algo,n=[],i=[],s=[],o=r.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)a[n]^=r[n+4&7];if(t){var i=t.words,s=i[0],o=i[1],d=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),p=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=d>>>16|4294901760&p,u=p<<16|65535&d;for(a[0]^=d,a[1]^=l,a[2]^=p,a[3]^=u,a[4]^=d,a[5]^=l,a[6]^=p,a[7]^=u,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),n[0]=r[0]^r[5]>>>16^r[3]<<16,n[1]=r[2]^r[7]>>>16^r[5]<<16,n[2]=r[4]^r[1]>>>16^r[7]<<16,n[3]=r[6]^r[3]>>>16^r[1]<<16;for(var a=0;a<4;a++)n[a]=16711935&(n[a]<<8|n[a]>>>24)|4278255360&(n[a]<<24|n[a]>>>8),e[t+a]^=n[a]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)i[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,r=0;r<8;r++){var a=e[r]+t[r],n=65535&a,o=a>>>16,c=((n*n>>>17)+n*o>>>15)+o*o,d=((4294901760&a)*a|0)+((65535&a)*a|0);s[r]=c^d}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.RabbitLegacy=t._createHelper(o)}(),a.RabbitLegacy)},4454:function(e,t,r){var a;e.exports=(a=r(8249),r(8269),r(8214),r(888),r(5109),function(){var e=a,t=e.lib.StreamCipher,r=e.algo,n=[],i=[],s=[],o=r.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var a=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)n[r]^=a[r+4&7];if(t){var i=t.words,s=i[0],o=i[1],d=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),p=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=d>>>16|4294901760&p,u=p<<16|65535&d;for(n[0]^=d,n[1]^=l,n[2]^=p,n[3]^=u,n[4]^=d,n[5]^=l,n[6]^=p,n[7]^=u,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),n[0]=r[0]^r[5]>>>16^r[3]<<16,n[1]=r[2]^r[7]>>>16^r[5]<<16,n[2]=r[4]^r[1]>>>16^r[7]<<16,n[3]=r[6]^r[3]>>>16^r[1]<<16;for(var a=0;a<4;a++)n[a]=16711935&(n[a]<<8|n[a]>>>24)|4278255360&(n[a]<<24|n[a]>>>8),e[t+a]^=n[a]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)i[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,r=0;r<8;r++){var a=e[r]+t[r],n=65535&a,o=a>>>16,c=((n*n>>>17)+n*o>>>15)+o*o,d=((4294901760&a)*a|0)+((65535&a)*a|0);s[r]=c^d}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.Rabbit=t._createHelper(o)}(),a.Rabbit)},1857:function(e,t,r){var a;e.exports=(a=r(8249),r(8269),r(8214),r(888),r(5109),function(){var e=a,t=e.lib.StreamCipher,r=e.algo,n=r.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,a=this._S=[],n=0;n<256;n++)a[n]=n;n=0;for(var i=0;n<256;n++){var s=n%r,o=t[s>>>2]>>>24-s%4*8&255;i=(i+a[n]+o)%256;var c=a[n];a[n]=a[i],a[i]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var e=this._S,t=this._i,r=this._j,a=0,n=0;n<4;n++){r=(r+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[r],e[r]=i,a|=e[(e[t]+e[r])%256]<<24-8*n}return this._i=t,this._j=r,a}e.RC4=t._createHelper(n);var s=r.RC4Drop=n.extend({cfg:n.cfg.extend({drop:192}),_doReset:function(){n._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)i.call(this)}});e.RC4Drop=t._createHelper(s)}(),a.RC4)},706:function(e,t,r){var a;e.exports=(a=r(8249),function(e){var t=a,r=t.lib,n=r.WordArray,i=r.Hasher,s=t.algo,o=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),p=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),l=n.create([0,1518500249,1859775393,2400959708,2840853838]),u=n.create([1352829926,1548603684,1836072691,2053994217,0]),h=s.RIPEMD160=i.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var a=t+r,n=e[a];e[a]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var i,s,h,b,w,S,k,R,P,E,C,T=this._hash.words,x=l.words,D=u.words,I=o.words,O=c.words,M=d.words,A=p.words;for(S=i=T[0],k=s=T[1],R=h=T[2],P=b=T[3],E=w=T[4],r=0;r<80;r+=1)C=i+e[t+I[r]]|0,C+=r<16?m(s,h,b)+x[0]:r<32?f(s,h,b)+x[1]:r<48?_(s,h,b)+x[2]:r<64?v(s,h,b)+x[3]:g(s,h,b)+x[4],C=(C=y(C|=0,M[r]))+w|0,i=w,w=b,b=y(h,10),h=s,s=C,C=S+e[t+O[r]]|0,C+=r<16?g(k,R,P)+D[0]:r<32?v(k,R,P)+D[1]:r<48?_(k,R,P)+D[2]:r<64?f(k,R,P)+D[3]:m(k,R,P)+D[4],C=(C=y(C|=0,A[r]))+E|0,S=E,E=P,P=y(R,10),R=k,k=C;C=T[1]+h+P|0,T[1]=T[2]+b+E|0,T[2]=T[3]+w+S|0,T[3]=T[4]+i+k|0,T[4]=T[0]+s+R|0,T[0]=C},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;t[a>>>5]|=128<<24-a%32,t[14+(a+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var n=this._hash,i=n.words,s=0;s<5;s++){var o=i[s];i[s]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return n},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function m(e,t,r){return e^t^r}function f(e,t,r){return e&t|~e&r}function _(e,t,r){return(e|~t)^r}function v(e,t,r){return e&r|t&~r}function g(e,t,r){return e^(t|~r)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=i._createHelper(h),t.HmacRIPEMD160=i._createHmacHelper(h)}(Math),a.RIPEMD160)},2783:function(e,t,r){var a,n,i,s,o,c,d,p;e.exports=(p=r(8249),n=(a=p).lib,i=n.WordArray,s=n.Hasher,o=a.algo,c=[],d=o.SHA1=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,a=r[0],n=r[1],i=r[2],s=r[3],o=r[4],d=0;d<80;d++){if(d<16)c[d]=0|e[t+d];else{var p=c[d-3]^c[d-8]^c[d-14]^c[d-16];c[d]=p<<1|p>>>31}var l=(a<<5|a>>>27)+o+c[d];l+=d<20?1518500249+(n&i|~n&s):d<40?1859775393+(n^i^s):d<60?(n&i|n&s|i&s)-1894007588:(n^i^s)-899497514,o=s,s=i,i=n<<30|n>>>2,n=a,a=l}r[0]=r[0]+a|0,r[1]=r[1]+n|0,r[2]=r[2]+i|0,r[3]=r[3]+s|0,r[4]=r[4]+o|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[14+(a+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(a+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),a.SHA1=s._createHelper(d),a.HmacSHA1=s._createHmacHelper(d),p.SHA1)},7792:function(e,t,r){var a,n,i,s,o,c;e.exports=(c=r(8249),r(2153),n=(a=c).lib.WordArray,i=a.algo,s=i.SHA256,o=i.SHA224=s.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=4,e}}),a.SHA224=s._createHelper(o),a.HmacSHA224=s._createHmacHelper(o),c.SHA224)},2153:function(e,t,r){var a;e.exports=(a=r(8249),function(e){var t=a,r=t.lib,n=r.WordArray,i=r.Hasher,s=t.algo,o=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),a=2;a<=r;a++)if(!(t%a))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var a=2,n=0;n<64;)t(a)&&(n<8&&(o[n]=r(e.pow(a,.5))),c[n]=r(e.pow(a,1/3)),n++),a++}();var d=[],p=s.SHA256=i.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,a=r[0],n=r[1],i=r[2],s=r[3],o=r[4],p=r[5],l=r[6],u=r[7],h=0;h<64;h++){if(h<16)d[h]=0|e[t+h];else{var m=d[h-15],f=(m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3,_=d[h-2],v=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;d[h]=f+d[h-7]+v+d[h-16]}var g=a&n^a&i^n&i,y=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),b=u+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&p^~o&l)+c[h]+d[h];u=l,l=p,p=o,o=s+b|0,s=i,i=n,n=a,a=b+(y+g)|0}r[0]=r[0]+a|0,r[1]=r[1]+n|0,r[2]=r[2]+i|0,r[3]=r[3]+s|0,r[4]=r[4]+o|0,r[5]=r[5]+p|0,r[6]=r[6]+l|0,r[7]=r[7]+u|0},_doFinalize:function(){var t=this._data,r=t.words,a=8*this._nDataBytes,n=8*t.sigBytes;return r[n>>>5]|=128<<24-n%32,r[14+(n+64>>>9<<4)]=e.floor(a/4294967296),r[15+(n+64>>>9<<4)]=a,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(p),t.HmacSHA256=i._createHmacHelper(p)}(Math),a.SHA256)},3327:function(e,t,r){var a;e.exports=(a=r(8249),r(4938),function(e){var t=a,r=t.lib,n=r.WordArray,i=r.Hasher,s=t.x64.Word,o=t.algo,c=[],d=[],p=[];!function(){for(var e=1,t=0,r=0;r<24;r++){c[e+5*t]=(r+1)*(r+2)/2%64;var a=(2*e+3*t)%5;e=t%5,t=a}for(e=0;e<5;e++)for(t=0;t<5;t++)d[e+5*t]=t+(2*e+3*t)%5*5;for(var n=1,i=0;i<24;i++){for(var o=0,l=0,u=0;u<7;u++){if(1&n){var h=(1<<u)-1;h<32?l^=1<<h:o^=1<<h-32}128&n?n=n<<1^113:n<<=1}p[i]=s.create(o,l)}}();var l=[];!function(){for(var e=0;e<25;e++)l[e]=s.create()}();var u=o.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,a=this.blockSize/2,n=0;n<a;n++){var i=e[t+2*n],s=e[t+2*n+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(T=r[n]).high^=s,T.low^=i}for(var o=0;o<24;o++){for(var u=0;u<5;u++){for(var h=0,m=0,f=0;f<5;f++)h^=(T=r[u+5*f]).high,m^=T.low;var _=l[u];_.high=h,_.low=m}for(u=0;u<5;u++){var v=l[(u+4)%5],g=l[(u+1)%5],y=g.high,b=g.low;for(h=v.high^(y<<1|b>>>31),m=v.low^(b<<1|y>>>31),f=0;f<5;f++)(T=r[u+5*f]).high^=h,T.low^=m}for(var w=1;w<25;w++){var S=(T=r[w]).high,k=T.low,R=c[w];R<32?(h=S<<R|k>>>32-R,m=k<<R|S>>>32-R):(h=k<<R-32|S>>>64-R,m=S<<R-32|k>>>64-R);var P=l[d[w]];P.high=h,P.low=m}var E=l[0],C=r[0];for(E.high=C.high,E.low=C.low,u=0;u<5;u++)for(f=0;f<5;f++){var T=r[w=u+5*f],x=l[w],D=l[(u+1)%5+5*f],I=l[(u+2)%5+5*f];T.high=x.high^~D.high&I.high,T.low=x.low^~D.low&I.low}T=r[0];var O=p[o];T.high^=O.high,T.low^=O.low}},_doFinalize:function(){var t=this._data,r=t.words,a=(this._nDataBytes,8*t.sigBytes),i=32*this.blockSize;r[a>>>5]|=1<<24-a%32,r[(e.ceil((a+1)/i)*i>>>5)-1]|=128,t.sigBytes=4*r.length,this._process();for(var s=this._state,o=this.cfg.outputLength/8,c=o/8,d=[],p=0;p<c;p++){var l=s[p],u=l.high,h=l.low;u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),d.push(h),d.push(u)}return new n.init(d,o)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});t.SHA3=i._createHelper(u),t.HmacSHA3=i._createHmacHelper(u)}(Math),a.SHA3)},7460:function(e,t,r){var a,n,i,s,o,c,d,p;e.exports=(p=r(8249),r(4938),r(34),n=(a=p).x64,i=n.Word,s=n.WordArray,o=a.algo,c=o.SHA512,d=o.SHA384=c.extend({_doReset:function(){this._hash=new s.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),a.SHA384=c._createHelper(d),a.HmacSHA384=c._createHmacHelper(d),p.SHA384)},34:function(e,t,r){var a;e.exports=(a=r(8249),r(4938),function(){var e=a,t=e.lib.Hasher,r=e.x64,n=r.Word,i=r.WordArray,s=e.algo;function o(){return n.create.apply(n,arguments)}var c=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],d=[];!function(){for(var e=0;e<80;e++)d[e]=o()}();var p=s.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,a=r[0],n=r[1],i=r[2],s=r[3],o=r[4],p=r[5],l=r[6],u=r[7],h=a.high,m=a.low,f=n.high,_=n.low,v=i.high,g=i.low,y=s.high,b=s.low,w=o.high,S=o.low,k=p.high,R=p.low,P=l.high,E=l.low,C=u.high,T=u.low,x=h,D=m,I=f,O=_,M=v,A=g,L=y,j=b,N=w,B=S,F=k,W=R,V=P,U=E,H=C,z=T,Z=0;Z<80;Z++){var G,q,K=d[Z];if(Z<16)q=K.high=0|e[t+2*Z],G=K.low=0|e[t+2*Z+1];else{var $=d[Z-15],Q=$.high,Y=$.low,J=(Q>>>1|Y<<31)^(Q>>>8|Y<<24)^Q>>>7,X=(Y>>>1|Q<<31)^(Y>>>8|Q<<24)^(Y>>>7|Q<<25),ee=d[Z-2],te=ee.high,re=ee.low,ae=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,ne=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),ie=d[Z-7],se=ie.high,oe=ie.low,ce=d[Z-16],de=ce.high,pe=ce.low;q=(q=(q=J+se+((G=X+oe)>>>0<X>>>0?1:0))+ae+((G+=ne)>>>0<ne>>>0?1:0))+de+((G+=pe)>>>0<pe>>>0?1:0),K.high=q,K.low=G}var le,ue=N&F^~N&V,he=B&W^~B&U,me=x&I^x&M^I&M,fe=D&O^D&A^O&A,_e=(x>>>28|D<<4)^(x<<30|D>>>2)^(x<<25|D>>>7),ve=(D>>>28|x<<4)^(D<<30|x>>>2)^(D<<25|x>>>7),ge=(N>>>14|B<<18)^(N>>>18|B<<14)^(N<<23|B>>>9),ye=(B>>>14|N<<18)^(B>>>18|N<<14)^(B<<23|N>>>9),be=c[Z],we=be.high,Se=be.low,ke=H+ge+((le=z+ye)>>>0<z>>>0?1:0),Re=ve+fe;H=V,z=U,V=F,U=W,F=N,W=B,N=L+(ke=(ke=(ke=ke+ue+((le+=he)>>>0<he>>>0?1:0))+we+((le+=Se)>>>0<Se>>>0?1:0))+q+((le+=G)>>>0<G>>>0?1:0))+((B=j+le|0)>>>0<j>>>0?1:0)|0,L=M,j=A,M=I,A=O,I=x,O=D,x=ke+(_e+me+(Re>>>0<ve>>>0?1:0))+((D=le+Re|0)>>>0<le>>>0?1:0)|0}m=a.low=m+D,a.high=h+x+(m>>>0<D>>>0?1:0),_=n.low=_+O,n.high=f+I+(_>>>0<O>>>0?1:0),g=i.low=g+A,i.high=v+M+(g>>>0<A>>>0?1:0),b=s.low=b+j,s.high=y+L+(b>>>0<j>>>0?1:0),S=o.low=S+B,o.high=w+N+(S>>>0<B>>>0?1:0),R=p.low=R+W,p.high=k+F+(R>>>0<W>>>0?1:0),E=l.low=E+U,l.high=P+V+(E>>>0<U>>>0?1:0),T=u.low=T+z,u.high=C+H+(T>>>0<z>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[30+(a+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(a+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(p),e.HmacSHA512=t._createHmacHelper(p)}(),a.SHA512)},4253:function(e,t,r){var a;e.exports=(a=r(8249),r(8269),r(8214),r(888),r(5109),function(){var e=a,t=e.lib,r=t.WordArray,n=t.BlockCipher,i=e.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],p=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],l=i.DES=n.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var a=s[r]-1;t[r]=e[a>>>5]>>>31-a%32&1}for(var n=this._subKeys=[],i=0;i<16;i++){var d=n[i]=[],p=c[i];for(r=0;r<24;r++)d[r/6|0]|=t[(o[r]-1+p)%28]<<31-r%6,d[4+(r/6|0)]|=t[28+(o[r+24]-1+p)%28]<<31-r%6;for(d[0]=d[0]<<1|d[0]>>>31,r=1;r<7;r++)d[r]=d[r]>>>4*(r-1)+3;d[7]=d[7]<<5|d[7]>>>27}var l=this._invSubKeys=[];for(r=0;r<16;r++)l[r]=n[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],u.call(this,4,252645135),u.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),u.call(this,1,1431655765);for(var a=0;a<16;a++){for(var n=r[a],i=this._lBlock,s=this._rBlock,o=0,c=0;c<8;c++)o|=d[c][((s^n[c])&p[c])>>>0];this._lBlock=s,this._rBlock=i^o}var l=this._lBlock;this._lBlock=this._rBlock,this._rBlock=l,u.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),u.call(this,16,65535),u.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function u(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function h(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}e.DES=n._createHelper(l);var m=i.TripleDES=n.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),a=e.length<4?e.slice(0,2):e.slice(2,4),n=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=l.createEncryptor(r.create(t)),this._des2=l.createEncryptor(r.create(a)),this._des3=l.createEncryptor(r.create(n))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=n._createHelper(m)}(),a.TripleDES)},4938:function(e,t,r){var a;e.exports=(a=r(8249),function(e){var t=a,r=t.lib,n=r.Base,i=r.WordArray,s=t.x64={};s.Word=n.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=n.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=e?r:8*t.length},toX32:function(){for(var e=this.words,t=e.length,r=[],a=0;a<t;a++){var n=e[a];r.push(n.high),r.push(n.low)}return i.create(r,this.sigBytes)},clone:function(){for(var e=n.clone.call(this),t=e.words=this.words.slice(0),r=t.length,a=0;a<r;a++)t[a]=t[a].clone();return e}})}(),a)},1227:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let a=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(a++,"%c"===e&&(n=a))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(2447)(t);const{formatters:a}=e.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:(e,t,r)=>{e.exports=function(e){function t(e){let r,n,i,s=null;function o(...e){if(!o.enabled)return;const a=o,n=Number(new Date),i=n-(r||n);a.diff=i,a.prev=r,a.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";s++;const i=t.formatters[n];if("function"==typeof i){const t=e[s];r=i.call(a,t),e.splice(s,1),s--}return r})),t.formatArgs.call(a,e);(a.log||t.log).apply(a,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=a,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(n!==t.namespaces&&(n=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"==typeof t.init&&t.init(o),o}function a(e,r){const a=t(this.namespace+(void 0===r?":":r)+e);return a.log=this.log,a}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const a=("string"==typeof e?e:"").split(/[\s,]+/),n=a.length;for(r=0;r<n;r++)a[r]&&("-"===(e=a[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,a;for(r=0,a=t.skips.length;r<a;r++)if(t.skips[r].test(e))return!1;for(r=0,a=t.names.length;r<a;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(7824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},284:e=>{var t=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__||t()}finally{delete Object.prototype.__global__}}()},7187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(r,a){function n(r){e.removeListener(t,i),a(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}f(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&f(e,"error",t,r)}(e,n,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function d(e,t,r,a){var n,i,s,d;if(o(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"==typeof s?s=i[t]=a?[r,s]:[s,r]:a?s.unshift(r):s.push(r),(n=c(e))>0&&s.length>n&&!s.warned){s.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=e,p.type=t,p.count=s.length,d=p,console&&console.warn&&console.warn(d)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,r){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=p.bind(a);return n.listener=r,a.wrapFn=n,n}function u(e,t,r){var a=e._events;if(void 0===a)return[];var n=a[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):m(n,n.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),a=0;a<t;++a)r[a]=e[a];return r}function f(e,t,r,a){if("function"==typeof e.on)a.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(i){a.once&&e.removeEventListener(t,n),r(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var d=c.length,p=m(c,d);for(r=0;r<d;++r)a(p[r],this,t)}return!0},i.prototype.addListener=function(e,t){return d(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return d(this,e,t,!0)},i.prototype.once=function(e,t){return o(t),this.on(e,l(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,l(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,a,n,i,s;if(o(t),void 0===(a=this._events))return this;if(void 0===(r=a[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,n=i;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(a[e]=r[0]),void 0!==a.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,a;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,i=Object.keys(r);for(a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},i.prototype.listeners=function(e){return u(this,e,!0)},i.prototype.rawListeners=function(e){return u(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7855:(e,t,r)=>{const a=r(1227)("h264-profile-level-id");a.log=console.info.bind(console);t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;const n=10;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;class i{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=i;const s=new i(1,31);class o{constructor(e){this._mask=~p("x",e),this._maskedValue=p("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class c{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const d=[new c(66,new o("x1xx0000"),1),new c(77,new o("1xxx0000"),1),new c(88,new o("11xx0000"),1),new c(66,new o("x0xx0000"),2),new c(88,new o("10xx0000"),2),new c(77,new o("0x0x0000"),3),new c(100,new o("00000000"),5),new c(100,new o("00001100"),4)];function p(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function l(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,n=t>>8&255,s=t>>16&255;let o;switch(r){case 11:o=0!=(16&n)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:o=r;break;default:return a("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const e of d)if(s===e.profile_idc&&e.profile_iop.isMatch(n))return new i(e.profile,o);return a("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return a("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return a("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`},t.parseSdpProfileLevelId=function(e={}){const r=e["profile-level-id"];return r?t.parseProfileLevelId(r):s},t.isSameProfile=function(e={},r={}){const a=t.parseSdpProfileLevelId(e),n=t.parseSdpProfileLevelId(r);return Boolean(a&&n&&a.profile===n.profile)},t.generateProfileLevelIdForAnswer=function(e={},r={}){if(!e["profile-level-id"]&&!r["profile-level-id"])return a("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const s=t.parseSdpProfileLevelId(e),o=t.parseSdpProfileLevelId(r);if(!s)throw new TypeError("invalid local_profile_level_id");if(!o)throw new TypeError("invalid remote_profile_level_id");if(s.profile!==o.profile)throw new TypeError("H264 Profile mismatch");const c=l(e)&&l(r),d=s.level,p=o.level,u=function(e,t){return 0===e?t!==n&&0!==t:0===t?e!==n:e<t}(h=d,m=p)?h:m;var h,m;const f=c?d:u;return a("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",s.profile,f),t.profileLevelIdToString(new i(s.profile,f))}},6808:(e,t,r)=>{var a,n;!function(i){if(void 0===(n="function"==typeof(a=i)?a.call(t,r,t,e):a)||(e.exports=n),!0,e.exports=i(),!!0){var s=window.Cookies,o=window.Cookies=i();o.noConflict=function(){return window.Cookies=s,o}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var a in r)t[a]=r[a]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(a){function n(){}function i(t,r,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},n.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var s=JSON.stringify(r);/^[\{\[]/.test(s)&&(r=s)}catch(e){}r=a.write?a.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var c in i)i[c]&&(o+="; "+c,!0!==i[c]&&(o+="="+i[c].split(";")[0]));return document.cookie=t+"="+r+o}}function s(e,r){if("undefined"!=typeof document){for(var n={},i=document.cookie?document.cookie.split("; "):[],s=0;s<i.length;s++){var o=i[s].split("="),c=o.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(o[0]);if(c=(a.read||a)(c,d)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(n[d]=c,e===d)break}catch(e){}}return e?n[e]:n}}return n.set=i,n.get=function(e){return s(e,!1)},n.getJSON=function(e){return s(e,!0)},n.remove=function(t,r){i(t,"",e(r,{expires:-1}))},n.defaults={},n.withConverter=r,n}((function(){}))}))},9514:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;const a=r(8562),n=r(4493),i=r(9992),s=new a.Logger("Consumer");class o extends n.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:a,track:i,rtpParameters:o,appData:c}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=a,this._track=i,this._rtpParameters=o,this._paused=!i.enabled,this._appData=c,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new i.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){s.debug("pause()"),this._closed?s.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){s.debug("resume()"),this._closed?s.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume"))}_onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}t.Consumer=o},1623:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;const a=r(8562),n=r(4493),i=new a.Logger("DataConsumer");class s extends n.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:a,appData:s}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,i.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=a,this._appData=s,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(i.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?i.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):i.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(i.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}t.DataConsumer=s},5504:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;const a=r(8562),n=r(4493),i=r(9992),s=new a.Logger("DataProducer");class o extends n.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:a}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=a,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(s.debug("send()"),this._closed)throw new i.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):s.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||s.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}t.DataProducer=o},3120:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;const o=s(r(1206)),c=r(8562),d=r(4493),p=r(9992),l=i(r(3347)),u=i(r(5280)),h=r(5202),m=r(6656),f=r(5372),_=r(5697),v=r(564),g=r(1419),y=r(9862),b=r(2205),w=r(7392),S=r(4770),k=new c.Logger("Device");function R(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void k.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(k.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)k.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=o.default.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}k.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}t.detectDevice=R;t.Device=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new d.EnhancedEventEmitter,k.debug("constructor()"),r){if(k.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)k.debug("constructor() | handler given: %s",e);else{if(!(e=R()))throw new p.UnsupportedError("device not supported");k.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=m.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=f.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=_.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=v.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=g.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=y.Safari12.createFactory();break;case"Safari11":this._handlerFactory=b.Safari11.createFactory();break;case"Edge11":this._handlerFactory=w.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=S.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const a=this._handlerFactory();this._handlerName=a.name,a.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new p.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new p.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;k.debug("load() [routerRtpCapabilities:%o]",e),e=l.clone(e,void 0);try{if(this._loaded)throw new p.InvalidStateError("already loaded");u.validateRtpCapabilities(e),t=this._handlerFactory();const r=await t.getNativeRtpCapabilities();k.debug("load() | got native RTP capabilities:%o",r),u.validateRtpCapabilities(r),this._extendedRtpCapabilities=u.getExtendedRtpCapabilities(r,e),k.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=u.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=u.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=u.getRecvRtpCapabilities(this._extendedRtpCapabilities),u.validateRtpCapabilities(this._recvRtpCapabilities),k.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),k.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),u.validateSctpCapabilities(this._sctpCapabilities),k.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new p.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){return k.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){return k.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l={}}){if(!this._loaded)throw new p.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(a))throw new TypeError("missing iceCandidates");if("object"!=typeof n)throw new TypeError("missing dtlsParameters");if(i&&"object"!=typeof i)throw new TypeError("wrong sctpParameters");if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");const u=new h.Transport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",u),u}}},4493:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;const a=r(7187),n=new(r(8562).Logger)("EnhancedEventEmitter");class i extends a.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return n.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t),Boolean(r)}}async safeEmitAsPromise(e,...t){return new Promise(((r,a)=>{try{this.emit(e,...t,r,a)}catch(t){n.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,t),a(t)}}))}}t.EnhancedEventEmitter=i},8562:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=a(r(1227)),i="mediasoup-client";t.Logger=class{constructor(e){e?(this._debug=(0,n.default)(`${i}:${e}`),this._warn=(0,n.default)(`${i}:WARN:${e}`),this._error=(0,n.default)(`${i}:ERROR:${e}`)):(this._debug=(0,n.default)(i),this._warn=(0,n.default)(`${i}:WARN`),this._error=(0,n.default)(`${i}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},6569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;const a=r(8562),n=r(4493),i=r(9992),s=new a.Logger("Producer");class o extends n.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:a,rtpParameters:i,stopTracks:o,disableTrackOnPause:c,zeroRtpOnPause:d,appData:p}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=a,this._kind=a.kind,this._rtpParameters=i,this._paused=!!c&&!a.enabled,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=c,this._zeroRtpOnPause=d,this._appData=p,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new i.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){s.debug("pause()"),this._closed?s.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){s.debug("resume()"),this._closed?s.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((()=>{})),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(s.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new i.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new i.InvalidStateError("track ended");e!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):s.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new i.InvalidStateError("closed");if("video"!==this._kind)throw new i.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new i.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}t.Producer=o},4879:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5202:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const s=r(2186),o=r(8562),c=r(4493),d=r(9992),p=i(r(3347)),l=i(r(5280)),u=r(6569),h=r(9514),m=r(5504),f=r(1623),_=new o.Logger("Transport");class v extends c.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:l,additionalSettings:u,proprietaryConstraints:h,appData:m,handlerFactory:f,extendedRtpCapabilities:v,canProduceByKind:g}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new s.AwaitQueue({ClosedErrorClass:d.InvalidStateError}),this._observer=new c.EnhancedEventEmitter,_.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=v,this._canProduceByKind=g,this._maxSctpMessageSize=i?i.maxMessageSize:null,delete(u=p.clone(u,{})).iceServers,delete u.iceTransportPolicy,delete u.bundlePolicy,delete u.rtcpMuxPolicy,delete u.sdpSemantics,this._handler=f(),this._handler.run({direction:e,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:l,additionalSettings:u,proprietaryConstraints:h,extendedRtpCapabilities:v}),this._appData=m,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){_.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new d.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(_.debug("restartIce()"),this._closed)throw new d.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((async()=>this._handler.restartIce(e)),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(_.debug("updateIceServers()"),this._closed)throw new d.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((async()=>this._handler.updateIceServers(e)),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:a,stopTracks:n=!0,disableTrackOnPause:i=!0,zeroRtpOnPause:s=!1,appData:o={}}={}){if(_.debug("produce() [track:%o]",e),!e)throw new TypeError("missing track");if("send"!==this._direction)throw new d.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new d.UnsupportedError(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new d.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?c=void 0:t&&(c=t.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:d,rtpParameters:p,rtpSender:h}=await this._handler.send({track:e,encodings:c,codecOptions:r,codec:a});try{l.validateRtpParameters(p);const{id:t}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:p,appData:o}),r=new u.Producer({id:t,localId:d,rtpSender:h,track:e,rtpParameters:p,stopTracks:n,disableTrackOnPause:i,zeroRtpOnPause:s,appData:o});return this._producers.set(r.id,r),this._handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(e){throw this._handler.stopSending(d).catch((()=>{})),e}}),"transport.produce()").catch((t=>{if(n)try{e.stop()}catch(e){}throw t}))}async consume({id:e,producerId:t,kind:r,rtpParameters:a,appData:n={}}){if(_.debug("consume()"),a=p.clone(a,void 0),this._closed)throw new d.InvalidStateError("closed");if("recv"!==this._direction)throw new d.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(n&&"object"!=typeof n)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{if(!l.canReceive(a,this._extendedRtpCapabilities))throw new d.UnsupportedError("cannot consume this Producer");const{localId:i,rtpReceiver:s,track:o}=await this._handler.receive({trackId:e,kind:r,rtpParameters:a}),c=new h.Consumer({id:e,localId:i,producerId:t,rtpReceiver:s,track:o,rtpParameters:a,appData:n});if(this._consumers.set(c.id,c),this._handleConsumer(c),!this._probatorConsumerCreated&&"video"===r)try{const e=l.generateProbatorRtpParameters(c.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:e}),_.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){_.error("consume() | failed to create Consumer for RTP probation:%o",e)}return this._observer.safeEmit("newconsumer",c),c}),"transport.consume()")}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:a="",protocol:n="",appData:i={}}={}){if(_.debug("produceData()"),"send"!==this._direction)throw new d.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new d.UnsupportedError("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push((async()=>{const{dataChannel:s,sctpStreamParameters:o}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n});l.validateSctpStreamParameters(o);const{id:c}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:o,label:a,protocol:n,appData:i}),d=new m.DataProducer({id:c,dataChannel:s,sctpStreamParameters:o,appData:i});return this._dataProducers.set(d.id,d),this._handleDataProducer(d),this._observer.safeEmit("newdataproducer",d),d}),"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:a="",protocol:n="",appData:i={}}){if(_.debug("consumeData()"),r=p.clone(r,void 0),this._closed)throw new d.InvalidStateError("closed");if("recv"!==this._direction)throw new d.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new d.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return l.validateSctpStreamParameters(r),this._awaitQueue.push((async()=>{const{dataChannel:s}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:a,protocol:n}),o=new f.DataConsumer({id:e,dataProducerId:t,dataChannel:s,sctpStreamParameters:r,appData:i});return this._dataConsumers.set(o.id,o),this._handleDataConsumer(o),this._observer.safeEmit("newdataconsumer",o),o}),"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new d.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(_.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}_handleProducer(e){e.on("@close",(()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopSending(e.localId)),"producer @close event").catch((e=>_.warn("producer.close() failed:%o",e)))})),e.on("@replacetrack",((t,r,a)=>{this._awaitQueue.push((async()=>this._handler.replaceTrack(e.localId,t)),"producer @replacetrack event").then(r).catch(a)})),e.on("@setmaxspatiallayer",((t,r,a)=>{this._awaitQueue.push((async()=>this._handler.setMaxSpatialLayer(e.localId,t)),"producer @setmaxspatiallayer event").then(r).catch(a)})),e.on("@setrtpencodingparameters",((t,r,a)=>{this._awaitQueue.push((async()=>this._handler.setRtpEncodingParameters(e.localId,t)),"producer @setrtpencodingparameters event").then(r).catch(a)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new d.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}_handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopReceiving(e.localId)),"consumer @close event").catch((()=>{}))})),e.on("@pause",(()=>{this._awaitQueue.push((async()=>this._handler.pauseReceiving(e.localId)),"consumer @pause event").catch((()=>{}))})),e.on("@resume",(()=>{this._awaitQueue.push((async()=>this._handler.resumeReceiving(e.localId)),"consumer @resume event").catch((()=>{}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new d.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}_handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}_handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}}t.Transport=v},9992:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class r extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(e).stack}}t.UnsupportedError=r;class a extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,a):this.stack=new Error(e).stack}}t.InvalidStateError=a},564:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;const s=i(r(766)),o=r(8562),c=r(9992),d=i(r(3347)),p=i(r(5280)),l=i(r(2267)),u=i(r(9875)),h=r(9316),m=r(7910),f=new o.Logger("Chrome55"),_={OS:1024,MIS:1024};class v extends h.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new v}get name(){return"Chrome55"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return l.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){var n;this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i,o=await this._pc.createOffer(),c=s.parse(o.sdp);const h=d.clone(this._sendingRtpParametersByKind[e.kind],{});h.codecs=p.reduceCodecs(h.codecs);const m=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(m.codecs=p.reduceCodecs(m.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:c}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),c=s.parse(o.sdp),i=c.media.find((e=>"video"===e.type)),u.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),o={type:"offer",sdp:s.write(c)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),c=s.parse(this._pc.localDescription.sdp),i=c.media.find((t=>t.type===e.kind)),h.rtcp.cname=l.getCname({offerMediaObject:i}),h.encodings=u.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<h.encodings.length;++e)t[e]&&Object.assign(h.encodings[e],t[e]);if(h.encodings.length>1&&"video/vp8"===h.codecs[0].mimeType.toLowerCase())for(const e of h.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:h,answerRtpParameters:m,codecOptions:r});const _={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const v=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,e),{localId:v,rtpParameters:h}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void f.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not supported")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){var i;this._assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(a,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var a;this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,i=t,o=r.rtcp.cname;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:o,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let d=await this._pc.createAnswer();const p=s.parse(d.sdp),u=p.media.find((e=>String(e.mid)===i));l.applyCodecParameters({offerRtpParameters:r,answerMediaObject:u}),d={type:"answer",sdp:s.write(p)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:p}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);const h=this._pc.getRemoteStreams().find((e=>e.id===o)).getTrackById(n);if(!h)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(n,{mid:i,rtpParameters:r}),{localId:n,track:h}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var a;this._assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c}=e,d={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};f.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome55=v},5697:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;const s=i(r(766)),o=r(8562),c=i(r(3347)),d=i(r(5280)),p=i(r(2267)),l=i(r(9875)),u=r(9316),h=r(7910),m=new o.Logger("Chrome67"),f={OS:1024,MIS:1024};class _ extends u.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"Chrome67"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){var n;this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i,o=await this._pc.createOffer(),u=s.parse(o.sdp);const h=c.clone(this._sendingRtpParametersByKind[e.kind],{});h.codecs=d.reduceCodecs(h.codecs);const f=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(f.codecs=d.reduceCodecs(f.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:u}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),u=s.parse(o.sdp),i=u.media.find((e=>"video"===e.type)),l.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),o={type:"offer",sdp:s.write(u)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),u=s.parse(this._pc.localDescription.sdp),i=u.media.find((t=>t.type===e.kind)),h.rtcp.cname=p.getCname({offerMediaObject:i}),h.encodings=l.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<h.encodings.length;++e)t[e]&&Object.assign(h.encodings[e],t[e]);if(h.encodings.length>1&&"video/vp8"===h.codecs[0].mimeType.toLowerCase())for(const e of h.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:h,answerRtpParameters:f,codecOptions:r});const _={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const v=String(this._nextSendLocalId);this._nextSendLocalId++;const g=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(v,g),{localId:v,rtpParameters:h,rtpSender:g}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.track;await r.replaceTrack(t),a&&this._sendStream.removeTrack(a),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]={...e,...t}})),await r.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){var i;this._assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(a,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var a;this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,i=t;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const o={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let c=await this._pc.createAnswer();const d=s.parse(c.sdp),l=d.media.find((e=>String(e.mid)===i));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:l}),c={type:"answer",sdp:s.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:d}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const u=this._pc.getReceivers().find((e=>e.track&&e.track.id===n));if(!u)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(n,{mid:i,rtpParameters:r,rtpReceiver:u}),{localId:n,track:u.track,rtpReceiver:u}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var a;this._assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c}=e,d={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome67=_},5372:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;const s=i(r(766)),o=r(8562),c=i(r(3347)),d=i(r(5280)),p=i(r(2267)),l=i(r(9072)),u=r(9316),h=r(7910),m=r(2770),f=new o.Logger("Chrome70"),_={OS:1024,MIS:1024};class v extends u.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new v}get name(){return"Chrome70"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){var n;this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const i=c.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=d.reduceCodecs(o.codecs,a);const u=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let _,v=await this._pc.createOffer(),g=s.parse(v.sdp);this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:g}),t&&t.length>1&&(f.debug("send() | enabling legacy simulcast"),g=s.parse(v.sdp),_=g.media[u.idx],l.addLegacySimulcast({offerMediaObject:_,numStreams:t.length}),v={type:"offer",sdp:s.write(g)});let y=!1;const b=(0,m.parse)((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===i.codecs[0].mimeType.toLowerCase()&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,g=s.parse(v.sdp),_=g.media[u.idx],l.addLegacySimulcast({offerMediaObject:_,numStreams:b.spatialLayers}),v={type:"offer",sdp:s.write(g)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v),t){f.debug("send() | applying given encodings");const e=h.sender.getParameters();for(let r=0;r<(e.encodings||[]).length;++r){const a=e.encodings[r],n=t[r];if(!n)break;e.encodings[r]=Object.assign(a,n)}await h.sender.setParameters(e)}const w=h.mid;if(i.mid=w,g=s.parse(this._pc.localDescription.sdp),_=g.media[u.idx],i.rtcp.cname=p.getCname({offerMediaObject:_}),i.encodings=l.getRtpEncodings({offerMediaObject:_}),t)for(let e=0;e<i.encodings.length;++e)t[e]&&Object.assign(i.encodings[e],t[e]);if(y&&(i.encodings=[i.encodings[0]]),i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:_,reuseMid:u.reuseMid,offerRtpParameters:i,answerRtpParameters:o,codecOptions:r});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(w,h),{localId:w,rtpParameters:i,rtpSender:h.sender}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]={...e,...t}})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){var i;this._assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(a,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var a;this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const c=s.parse(o.sdp),d=c.media.find((e=>String(e.mid)===n));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),o={type:"answer",sdp:s.write(c)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:c}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const l=this._pc.getTransceivers().find((e=>e.mid===n));if(!l)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,l),{localId:n,track:l.receiver.track,rtpReceiver:l.receiver}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var a;this._assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c}=e,d={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};f.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome70=v},6656:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;const s=i(r(766)),o=r(8562),c=i(r(3347)),d=i(r(5280)),p=i(r(2267)),l=i(r(9072)),u=r(9316),h=r(7910),m=r(2770),f=new o.Logger("Chrome74"),_={OS:1024,MIS:1024};class v extends u.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new v}get name(){return"Chrome74"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){var n;this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach(((e,t)=>{e.rid=`r${t}`}));const i=c.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=d.reduceCodecs(o.codecs,a);const u=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let _,v=await this._pc.createOffer(),g=s.parse(v.sdp);this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:g});let y=!1;const b=(0,m.parse)((t||[{}])[0].scalabilityMode);t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===i.codecs[0].mimeType.toLowerCase()&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,g=s.parse(v.sdp),_=g.media[u.idx],l.addLegacySimulcast({offerMediaObject:_,numStreams:b.spatialLayers}),v={type:"offer",sdp:s.write(g)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const w=h.mid;if(i.mid=w,g=s.parse(this._pc.localDescription.sdp),_=g.media[u.idx],i.rtcp.cname=p.getCname({offerMediaObject:_}),t)if(1===t.length){let e=l.getRtpEncodings({offerMediaObject:_});Object.assign(e[0],t[0]),y&&(e=[e[0]]),i.encodings=e}else i.encodings=t;else i.encodings=l.getRtpEncodings({offerMediaObject:_});if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:_,reuseMid:u.reuseMid,offerRtpParameters:i,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(w,h),{localId:w,rtpParameters:i,rtpSender:h.sender}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]={...e,...t}})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){var i;this._assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(a,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var a;this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const c=s.parse(o.sdp),d=c.media.find((e=>String(e.mid)===n));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),o={type:"answer",sdp:s.write(c)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:c}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const l=this._pc.getTransceivers().find((e=>e.mid===n));if(!l)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,l),{localId:n,track:l.receiver.track,rtpReceiver:l.receiver}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){this._assertRecvDirection(),f.debug("pauseReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async resumeReceiving(e){this._assertRecvDirection(),f.debug("resumeReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var a;this._assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c}=e,d={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};f.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome74=v},7392:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;const s=r(8562),o=r(9992),c=i(r(3347)),d=i(r(5280)),p=i(r(3635)),l=r(9316),u=new s.Logger("Edge11");class h extends l.HandlerInterface{constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new h}get name(){return"Edge11"}close(){u.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}}async getNativeRtpCapabilities(){return u.debug("getNativeRtpCapabilities()"),p.getCapabilities()}async getNativeSctpCapabilities(){return u.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:p,extendedRtpCapabilities:l}){u.debug("run()"),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=a,this._cname=`CNAME-${c.generateRandomNumber()}`,this._setIceGatherer({iceServers:i,iceTransportPolicy:s}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){if(u.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){u.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){u.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),u.debug("send() | calling new RTCRtpSender()");const n=new RTCRtpSender(e,this._dtlsTransport),i=c.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const s=i.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType)));t||(t=[{}]);for(const e of t)e.ssrc=c.generateRandomNumber(),s&&(e.rtx={ssrc:c.generateRandomNumber()});i.encodings=t,i.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const o=p.mangleRtpParameters(i);u.debug("send() | calling rtpSender.send() [params:%o]",o),await n.send(o);const l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(l,n),{localId:l,rtpParameters:i,rtpSender:n}}async stopSending(e){u.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{u.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw u.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async replaceTrack(e,t){t?u.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):u.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){u.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(a)}async setRtpEncodingParameters(e,t){u.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]={...e,...t}})),await r.setParameters(a)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new o.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:r}){u.debug("receive() [trackId:%s, kind:%s]",e,t),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),u.debug("receive() | calling new RTCRtpReceiver()");const a=new RTCRtpReceiver(this._dtlsTransport,t);a.addEventListener("error",(e=>{u.error('rtpReceiver "error" event [event:%o]',e)}));const n=p.mangleRtpParameters(r);u.debug("receive() | calling rtpReceiver.receive() [params:%o]",n),await a.receive(n);const i=e;return this._rtpReceivers.set(i,a),{localId:i,track:a.track,rtpReceiver:a}}async stopReceiving(e){u.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{u.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(e){u.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new o.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",(e=>{u.error('iceGatherer "error" event [event:%o]',e)}));try{r.gather()}catch(e){u.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{u.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{u.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{u.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{u.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){u.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}t.Edge11=h},1419:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;const s=i(r(766)),o=r(8562),c=r(9992),d=i(r(3347)),p=i(r(5280)),l=i(r(2267)),u=i(r(9072)),h=r(9316),m=r(7910),f=new o.Logger("Firefox60"),_={OS:16,MIS:2048};class v extends h.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new v}get name(){return"Firefox60"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const a=e.addTransceiver(r,{direction:"sendrecv"}),n=a.sender.getParameters(),i=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];n.encodings=i,await a.sender.setParameters(n);const o=await e.createOffer();try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}const c=s.parse(o.sdp);return l.extractRtpCapabilities({sdpObject:c})}catch(a){try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){throw new c.UnsupportedError("not supported")}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=d.clone(t,[])).length>1&&(t.forEach(((e,t)=>{e.rid=`r${t}`})),t.reverse());const n=d.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=p.reduceCodecs(n.codecs,a);const i=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});i.codecs=p.reduceCodecs(i.codecs,a);const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const e=o.sender.getParameters();e.encodings=t,await o.sender.setParameters(e)}const c=await this._pc.createOffer();let h=s.parse(c.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:h}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const m=o.mid;n.mid=m,h=s.parse(this._pc.localDescription.sdp);const _=h.media[h.media.length-1];if(n.rtcp.cname=l.getCname({offerMediaObject:_}),t)if(1===t.length){const e=u.getRtpEncodings({offerMediaObject:_});Object.assign(e[0],t[0]),n.encodings=e}else n.encodings=t.reverse();else n.encodings=u.getRtpEncodings({offerMediaObject:_});if(n.encodings.length>1&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const e of n.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:_,offerRtpParameters:n,answerRtpParameters:i,codecOptions:r,extmapAllowMixed:!0});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(m,o),{localId:m,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const a=r.sender.getParameters();t=a.encodings.length-1-t,a.encodings.forEach(((e,r)=>{e.active=r>=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]={...e,...t}})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const o=s.parse(i.sdp),c=o.media.find((e=>String(e.mid)===a));l.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),i={type:"answer",sdp:s.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const d=this._pc.getTransceivers().find((e=>e.mid===a));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,d),{localId:a,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){this._assertRecvDirection(),f.debug("pauseReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async resumeReceiving(e){this._assertRecvDirection(),f.debug("resumeReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Firefox60=v},9316:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;const a=r(4493);class n extends a.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=n},4770:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;const s=i(r(766)),o=r(8562),c=r(9992),d=i(r(3347)),p=i(r(5280)),l=i(r(2267)),u=i(r(9875)),h=r(9316),m=r(7910),f=new o.Logger("ReactNative"),_={OS:1024,MIS:1024};class v extends h.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new v}get name(){return"ReactNative"}close(){if(f.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return l.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){var n;this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i,o=await this._pc.createOffer(),c=s.parse(o.sdp);const h=d.clone(this._sendingRtpParametersByKind[e.kind],{});h.codecs=p.reduceCodecs(h.codecs);const m=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(m.codecs=p.reduceCodecs(m.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:c}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),c=s.parse(o.sdp),i=c.media.find((e=>"video"===e.type)),u.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),o={type:"offer",sdp:s.write(c)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),c=s.parse(this._pc.localDescription.sdp),i=c.media.find((t=>t.type===e.kind)),h.rtcp.cname=l.getCname({offerMediaObject:i}),h.encodings=u.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<h.encodings.length;++e)t[e]&&Object.assign(h.encodings[e],t[e]);if(h.encodings.length>1&&("video/vp8"===h.codecs[0].mimeType.toLowerCase()||"video/h264"===h.codecs[0].mimeType.toLowerCase()))for(const e of h.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:h,answerRtpParameters:m,codecOptions:r});const _={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const v=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,e),{localId:v,rtpParameters:h}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void f.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not implemented")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){var i;this._assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(a,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var a;this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,i=t;let o=r.rtcp.cname;f.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),o+=`-hack-${d.generateRandomNumber()}`,this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:o,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let p=await this._pc.createAnswer();const u=s.parse(p.sdp),h=u.media.find((e=>String(e.mid)===i));l.applyCodecParameters({offerRtpParameters:r,answerMediaObject:h}),p={type:"answer",sdp:s.write(u)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:u}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);const m=this._pc.getRemoteStreams().find((e=>e.id===o)).getTrackById(n);if(!m)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(n,{mid:i,rtpParameters:r}),{localId:n,track:m}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var a;this._assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c}=e,d={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};f.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=l.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNative=v},2205:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;const s=i(r(766)),o=r(8562),c=i(r(3347)),d=i(r(5280)),p=i(r(2267)),l=i(r(9875)),u=r(9316),h=r(7910),m=new o.Logger("Safari11"),f={OS:1024,MIS:1024};class _ extends u.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"Safari11"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){var n;this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i,o=await this._pc.createOffer(),u=s.parse(o.sdp);const h=c.clone(this._sendingRtpParametersByKind[e.kind],{});h.codecs=d.reduceCodecs(h.codecs);const f=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(f.codecs=d.reduceCodecs(f.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:u}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),u=s.parse(o.sdp),i=u.media.find((e=>"video"===e.type)),l.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),o={type:"offer",sdp:s.write(u)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),u=s.parse(this._pc.localDescription.sdp),i=u.media.find((t=>t.type===e.kind)),h.rtcp.cname=p.getCname({offerMediaObject:i}),h.encodings=l.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<h.encodings.length;++e)t[e]&&Object.assign(h.encodings[e],t[e]);if(h.encodings.length>1&&"video/vp8"===h.codecs[0].mimeType.toLowerCase())for(const e of h.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:h,answerRtpParameters:f,codecOptions:r});const _={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const v=String(this._nextSendLocalId);this._nextSendLocalId++;const g=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(v,g),{localId:v,rtpParameters:h,rtpSender:g}}async stopSending(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.track;await r.replaceTrack(t),a&&this._sendStream.removeTrack(a),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]={...e,...t}})),await r.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){var i;this._assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(a,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var a;this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,i=t;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const o={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let c=await this._pc.createAnswer();const d=s.parse(c.sdp),l=d.media.find((e=>String(e.mid)===i));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:l}),c={type:"answer",sdp:s.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:d}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const u=this._pc.getReceivers().find((e=>e.track&&e.track.id===n));if(!u)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(n,{mid:i,rtpParameters:r,rtpReceiver:u}),{localId:n,track:u.track,rtpReceiver:u}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var a;this._assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c}=e,d={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari11=_},9862:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;const s=i(r(766)),o=r(8562),c=i(r(3347)),d=i(r(5280)),p=i(r(2267)),l=i(r(9072)),u=r(9316),h=r(7910),m=new o.Logger("Safari12"),f={OS:1024,MIS:1024};class _ extends u.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"Safari12"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){var n;this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const i=c.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=d.reduceCodecs(o.codecs,a);const u=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let f,_=await this._pc.createOffer(),v=s.parse(_.sdp);this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:v}),t&&t.length>1&&(m.debug("send() | enabling legacy simulcast"),v=s.parse(_.sdp),f=v.media[u.idx],l.addLegacySimulcast({offerMediaObject:f,numStreams:t.length}),_={type:"offer",sdp:s.write(v)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const g=h.mid;if(i.mid=g,v=s.parse(this._pc.localDescription.sdp),f=v.media[u.idx],i.rtcp.cname=p.getCname({offerMediaObject:f}),i.encodings=l.getRtpEncodings({offerMediaObject:f}),t)for(let e=0;e<i.encodings.length;++e)t[e]&&Object.assign(i.encodings[e],t[e]);if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:f,reuseMid:u.reuseMid,offerRtpParameters:i,answerRtpParameters:o,codecOptions:r});const y={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.set(g,h),{localId:g,rtpParameters:i,rtpSender:h.sender}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]={...e,...t}})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){var i;this._assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(a,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var a;this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const c=s.parse(o.sdp),d=c.media.find((e=>String(e.mid)===n));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),o={type:"answer",sdp:s.write(c)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:c}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const l=this._pc.getTransceivers().find((e=>e.mid===n));if(!l)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,l),{localId:n,track:l.receiver.track,rtpReceiver:l.receiver}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){this._assertRecvDirection(),m.debug("pauseReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async resumeReceiving(e){this._assertRecvDirection(),m.debug("resumeReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var a;this._assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c}=e,d={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const p=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(a=this._forcedLocalDtlsRole)&&void 0!==a?a:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari12=_},3635:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.mangleRtpParameters=t.getCapabilities=void 0;const s=i(r(3347));t.getCapabilities=function(){const e=RTCRtpReceiver.getCapabilities(),t=s.clone(e,{});for(const e of t.codecs){if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const t=e.parameters;t.apt&&(t.apt=Number(t.apt)),t["packetization-mode"]&&(t["packetization-mode"]=Number(t["packetization-mode"]))}for(const t of e.rtcpFeedback||[])t.parameter||(t.parameter="")}return t},t.mangleRtpParameters=function(e){const t=s.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const e of t.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return t}},6698:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;const s=i(r(3347));class o{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:a=!1}){if(this._mediaObject={},this._planB=a,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}t.MediaSection=o;t.AnswerMediaSection=class extends o{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:i=!1,offerMediaObject:o,offerRtpParameters:d,answerRtpParameters:p,codecOptions:l,extmapAllowMixed:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of p.codecs){const t={payload:e.payloadType,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=s.clone(e.parameters,{});if(l){const{opusStereo:t,opusFec:a,opusDtx:n,opusMaxPlaybackRate:i,opusMaxAverageBitrate:s,opusPtime:o,videoGoogleStartBitrate:c,videoGoogleMaxBitrate:p,videoGoogleMinBitrate:u}=l,h=d.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(h.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==a&&(h.parameters.useinbandfec=a?1:0,r.useinbandfec=a?1:0),void 0!==n&&(h.parameters.usedtx=n?1:0,r.usedtx=n?1:0),void 0!==i&&(r.maxplaybackrate=i),void 0!==s&&(r.maxaveragebitrate=s),void 0!==o&&(h.parameters.ptime=o,r.ptime=o);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==c&&(r["x-google-start-bitrate"]=c),void 0!==p&&(r["x-google-max-bitrate"]=p),void 0!==u&&(r["x-google-min-bitrate"]=u)}}const a={payload:e.payloadType,config:""};for(const e of Object.keys(r))a.config&&(a.config+=";"),a.config+=`${e}=${r[e]}`;a.config&&this._mediaObject.fmtp.push(a);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=p.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of p.headerExtensions){(o.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}if(u&&"extmap-allow-mixed"===o.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof o.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=a.port,this._mediaObject.maxMessageSize=a.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=a.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:a.port,maxMessageSize:a.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}};function c(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.OfferMediaSection=class extends o{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:i=!1,mid:s,kind:o,offerRtpParameters:d,streamId:p,trackId:l,oldDataChannelSpec:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(s),this._mediaObject.type=o,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=a?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),o){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${p||"-"} ${l}`);for(const e of d.codecs){const t={payload:e.payloadType,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(const t of Object.keys(e.parameters))r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=d.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of d.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=d.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],d.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${p||"-"} ${l}`}),r&&(d.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${p||"-"} ${l}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":u?(this._mediaObject.payloads=a.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:a.port,maxMessageSize:a.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=a.port,this._mediaObject.maxMessageSize=a.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const a=e.encodings[0],n=a.ssrc,i=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0,s=this._mediaObject.payloads.split(" ");for(const t of e.codecs){if(s.includes(String(t.payloadType)))continue;const e={payload:t.payloadType,codec:c(t),rate:t.clockRate};t.channels>1&&(e.encoding=t.channels),this._mediaObject.rtp.push(e);const r={payload:t.payloadType,config:""};for(const e of Object.keys(t.parameters))r.config&&(r.config+=";"),r.config+=`${e}=${t.parameters[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const e of t.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:e.type,subtype:e.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter((e=>!this._mediaObject.payloads.includes(e.payloadType))).map((e=>e.payloadType)).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${r}`}),i&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${i}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,a=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==a)),a&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${a}`)))}}},7910:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;const s=i(r(766)),o=r(8562),c=r(6698),d=new o.Logger("RemoteSdp");t.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:i=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=a,this._plainRtpParameters=n,this._planB=i,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){d.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){d.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:i=!1}){const s=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:i});t?this._replaceMediaSection(s,t):this._midToIndex.has(s.mid)?this._replaceMediaSection(s):this._addMediaSection(s)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n}){const i=this._midToIndex.get(e);let s;if(void 0!==i&&(s=this._mediaSections[i]),s)s.planBReceive({offerRtpParameters:r,streamId:a,trackId:n}),this._replaceMediaSection(s);else{s=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n});const i=this._mediaSections.find((e=>e.closed));i?this._replaceMediaSection(s,i.mid):this._addMediaSection(s)}}disableMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);this._mediaSections[t].disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);const r=this._mediaSections[t];if(e===this._firstMid)return d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e);r.close(),this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._midToIndex.get(e);if(void 0===r)throw new Error(`no media section found with mid '${e}'`);const a=this._mediaSections[r];a.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(a)}sendSctpAssociation({offerMediaObject:e}){const t=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,s.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const a=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(a.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}},2267:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;const s=i(r(766));t.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let a=!1,n=!1;for(const i of e.media){const e=i.type;switch(e){case"audio":if(a)continue;a=!0;break;case"video":if(n)continue;n=!0;break;default:continue}for(const r of i.rtp){const a={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(a.preferredPayloadType,a)}for(const e of i.fmtp||[]){const r=s.parseParams(e.config),a=t.get(e.payload);a&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),a.parameters=r)}for(const e of i.rtcpFb||[]){const r=t.get(e.payload);if(!r)continue;const a={type:e.type,parameter:e.subtype};a.parameter||delete a.parameter,r.rtcpFeedback.push(a)}for(const t of i.ext||[]){if(t["encrypt-uri"])continue;const a={kind:e,uri:t.uri,preferredId:t.value};r.push(a)}}return{codecs:Array.from(t.values()),headerExtensions:r}},t.extractDtlsParameters=function({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let a;switch(t.setup){case"active":a="client";break;case"passive":a="server";break;case"actpass":a="auto"}return{role:a,fingerprints:[{algorithm:r.type,value:r.hash}]}},t.getCname=function({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""},t.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(t.rtp||[]).find((e=>e.payload===r.payloadType)))continue;t.fmtp=t.fmtp||[];let a=t.fmtp.find((e=>e.payload===r.payloadType));a||(a={payload:r.payloadType,config:""},t.fmtp.push(a));const n=s.parseParams(a.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(n.stereo=e?1:0);break}}a.config="";for(const e of Object.keys(n))a.config&&(a.config+=";"),a.config+=`${e}=${n[e]}`}}},9875:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e,track:t}){let r;const a=new Set;for(const n of e.ssrcs||[]){if("msid"!==n.attribute)continue;if(n.value.split(" ")[1]===t.id){const e=n.id;a.add(e),r||(r=e)}}if(0===a.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const t of e.ssrcGroups||[]){if("FID"!==t.semantics)continue;let[e,r]=t.ssrcs.split(/\s+/);e=Number(e),r=Number(r),a.has(e)&&(a.delete(e),a.delete(r),n.set(e,r))}for(const e of a)n.set(e,null);const i=[];for(const[e,t]of n){const r={ssrc:e};t&&(r.rtx={ssrc:t}),i.push(r)}return i},t.addLegacySimulcast=function({offerMediaObject:e,track:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let a,n,i;if(!(e.ssrcs||[]).find((e=>{if("msid"!==e.attribute)return!1;return e.value.split(" ")[1]===t.id&&(a=e.id,i=e.value.split(" ")[0],!0)})))throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===a&&(n=Number(t[1]),!0)}));const s=e.ssrcs.find((e=>"cname"===e.attribute&&e.id===a));if(!s)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const o=s.value,c=[],d=[];for(let e=0;e<r;++e)c.push(a+e),n&&d.push(n+e);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let r=0;r<c.length;++r){const a=c[r];e.ssrcs.push({id:a,attribute:"cname",value:o}),e.ssrcs.push({id:a,attribute:"msid",value:`${i} ${t.id}`})}for(let r=0;r<d.length;++r){const a=c[r],n=d[r];e.ssrcs.push({id:n,attribute:"cname",value:o}),e.ssrcs.push({id:n,attribute:"msid",value:`${i} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${a} ${n}`})}}},9072:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const a of e.ssrcGroups||[]){if("FID"!==a.semantics)continue;let[e,n]=a.ssrcs.split(/\s+/);e=Number(e),n=Number(n),t.has(e)&&(t.delete(e),t.delete(n),r.set(e,n))}for(const e of t)r.set(e,null);const a=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),a.push(r)}return a},t.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new Error("a=ssrc line with msid information not found");const[a,n]=r.value.split(" "),i=r.id;let s;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===i&&(s=Number(t[1]),!0)}));const o=e.ssrcs.find((e=>"cname"===e.attribute));if(!o)throw new Error("a=ssrc line with cname information not found");const c=o.value,d=[],p=[];for(let e=0;e<t;++e)d.push(i+e),s&&p.push(s+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let t=0;t<d.length;++t){const r=d[t];e.ssrcs.push({id:r,attribute:"cname",value:c}),e.ssrcs.push({id:r,attribute:"msid",value:`${a} ${n}`})}for(let t=0;t<p.length;++t){const r=d[t],i=p[t];e.ssrcs.push({id:i,attribute:"cname",value:c}),e.ssrcs.push({id:i,attribute:"msid",value:`${a} ${n}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${i}`})}}},960:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;const o=s(r(1227));t.debug=o.default;const c=r(3120);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return c.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return c.detectDevice}});const d=i(r(53));t.types=d,t.version="3.6.47";var p=r(2770);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return p.parse}})},5280:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;const s=i(r(7855)),o=i(r(3347));function c(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)d(t)}function d(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function p(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function l(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)u(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)h(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)m(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),f(e.rtcp)}function u(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)d(t)}function h(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function m(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function f(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function _(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function v(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function g(e,t,{strict:r=!1,modify:a=!1}={}){const n=e.mimeType.toLowerCase();if(n!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(n){case"video/h264":if(r){if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(!s.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=s.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}a&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r){if((e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}}return!0}function y(e,t){return(!e.kind||!t.kind||e.kind===t.kind)&&e.uri===t.uri}function b(e,t){const r=[];for(const a of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===a.type&&(e.parameter===a.parameter||!e.parameter&&!a.parameter)));e&&r.push(e)}return r}t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)c(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)p(t)},t.validateRtpCodecCapability=c,t.validateRtcpFeedback=d,t.validateRtpHeaderExtension=p,t.validateRtpParameters=l,t.validateRtpCodecParameters=u,t.validateRtpHeaderExtensionParameters=h,t.validateRtpEncodingParameters=m,t.validateRtcpParameters=f,t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");_(e.numStreams)},t.validateNumSctpStreams=_,t.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const a of t.codecs||[]){if(v(a))continue;const t=(e.codecs||[]).find((e=>g(e,a,{strict:!0,modify:!0})));if(!t)continue;const n={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:a.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:a.parameters,rtcpFeedback:b(t,a)};r.codecs.push(n)}for(const a of r.codecs){const r=e.codecs.find((e=>v(e)&&e.parameters.apt===a.localPayloadType)),n=t.codecs.find((e=>v(e)&&e.parameters.apt===a.remotePayloadType));r&&n&&(a.localRtxPayloadType=r.preferredPayloadType,a.remoteRtxPayloadType=n.preferredPayloadType)}for(const a of t.headerExtensions){const t=e.headerExtensions.find((e=>y(e,a)));if(!t)continue;const n={kind:a.kind,uri:a.uri,sendId:t.preferredId,recvId:a.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(a.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}r.headerExtensions.push(n)}return r},t.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const a={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(a)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t},t.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.localParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};r.headerExtensions.push(t)}return r},t.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.remoteParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r},t.reduceCodecs=function(e,t){const r=[];if(t){for(let a=0;a<e.length;++a)if(g(e[a],t)){r.push(e[a]),v(e[a+1])&&r.push(e[a+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),v(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){l(e=o.clone(e,{}));const t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((t=>t.kind===e))},t.canReceive=function(e,t){if(l(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some((e=>e.remotePayloadType===r.payloadType))}},2770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){const t=r.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},53:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(3120),t),n(r(5202),t),n(r(6569),t),n(r(9514),t),n(r(5504),t),n(r(1623),t),n(r(4879),t),n(r(7669),t),n(r(9316),t),n(r(9992),t)},3347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},7824:e=>{var t=1e3,r=60*t,a=60*r,n=24*a,i=7*n,s=365.25*n;function o(e,t,r,a){var n=t>=1.5*r;return Math.round(e/r)+" "+a+(n?"s":"")}e.exports=function(e,c){c=c||{};var d=typeof e;if("string"===d&&e.length>0)return function(e){if((e=String(e)).length>100)return;var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!o)return;var c=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*n;case"hours":case"hour":case"hrs":case"hr":case"h":return c*a;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===d&&isFinite(e))return c.long?function(e){var i=Math.abs(e);if(i>=n)return o(e,i,n,"day");if(i>=a)return o(e,i,a,"hour");if(i>=r)return o(e,i,r,"minute");if(i>=t)return o(e,i,t,"second");return e+" ms"}(e):function(e){var i=Math.abs(e);if(i>=n)return Math.round(e/n)+"d";if(i>=a)return Math.round(e/a)+"h";if(i>=r)return Math.round(e/r)+"m";if(i>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},7576:(e,t,r)=>{const{EventEmitter:a}=r(7187),n=r(3417);e.exports=class extends a{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new n("EnhancedEventEmitter")}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}async safeEmitAsPromise(e,...t){return new Promise(((r,a)=>{this.safeEmit(e,...t,r,a)}))}}},3417:(e,t,r)=>{const a=r(1227),n="protoo-client";e.exports=class{constructor(e){e?(this._debug=a(`${n}:${e}`),this._warn=a(`${n}:WARN:${e}`),this._error=a(`${n}:ERROR:${e}`)):(this._debug=a(n),this._warn=a(`${n}:WARN`),this._error=a(`${n}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},6508:(e,t,r)=>{const a=r(3417),{generateRandomNumber:n}=r(5654),i=new a("Message");e.exports=class{static parse(e){let t;const r={};try{t=JSON.parse(e)}catch(e){return void i.error("parse() | invalid JSON: %s",e)}if("object"==typeof t&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void i.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}i.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:n(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},7502:(e,t,r)=>{const a=r(3417),n=r(7576),i=r(6508),s=new a("Peer");e.exports=class extends n{constructor(e){super(s),s.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){s.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t){const r=i.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,r.id),await this._transport.send(r),new Promise(((e,t)=>{const a=1500*(15+.1*this._sents.size),n={id:r.id,method:r.method,resolve:t=>{this._sents.delete(r.id)&&(clearTimeout(n.timer),e(t))},reject:e=>{this._sents.delete(r.id)&&(clearTimeout(n.timer),t(e))},timer:setTimeout((()=>{this._sents.delete(r.id)&&t(new Error("request timeout"))}),a),close:()=>{clearTimeout(n.timer),t(new Error("peer closed"))}};this._sents.set(r.id,n)}))}async notify(e,t){const r=i.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(r)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout((()=>{this._closed||(this._connected=!1,this.safeEmit("close"))}));this._transport.on("open",(()=>{this._closed||(s.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))})),this._transport.on("disconnected",(()=>{this._closed||(s.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))})),this._transport.on("failed",(e=>{this._closed||(s.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))})),this._transport.on("close",(()=>{this._closed||(this._closed=!0,s.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))})),this._transport.on("message",(e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(e){try{this.emit("request",e,(t=>{const r=i.createSuccessResponse(e,t);this._transport.send(r).catch((()=>{}))}),((t,r)=>{t instanceof Error?(r=t.message,t=500):"number"==typeof t&&r instanceof Error&&(r=r.message);const a=i.createErrorResponse(e,t,r);this._transport.send(a).catch((()=>{}))}))}catch(t){const r=i.createErrorResponse(e,500,String(t));this._transport.send(r).catch((()=>{}))}}_handleResponse(e){const t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{const r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else s.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}},9293:(e,t,r)=>{const{version:a}=r(7002),n=r(7502),i=r(2165);t._z=n,t.qo=i},2165:(e,t,r)=>{const a=r(5840).w3cwebsocket,n=r(9353),i=r(3417),s=r(7576),o=r(6508),c={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},d=new i("WebSocketTransport");e.exports=class extends s{constructor(e,t){super(d),d.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){d.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){d.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw d.warn("send() failed:%o",e),e}}_runWebSocket(){const e=n.operation(this._options.retry||c);let t=!1;e.attempt((r=>{this._closed?e.stop():(d.debug("_runWebSocket() [currentAttempt:%s]",r),this._ws=new a(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(t=!0,this.safeEmit("open"))},this._ws.onclose=a=>{if(!this._closed){if(d.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',a.wasClean,a.code,a.reason),4e3!==a.code){if(t){if(e.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",r),this._closed)return;if(e.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||d.error('WebSocket "error" event')},this._ws.onmessage=e=>{if(this._closed)return;const t=o.parse(e.data);t&&(0!==this.listenerCount("message")?this.safeEmit("message",t):d.error('no listeners for WebSocket "message" event, ignoring received message'))})}))}}},5654:(e,t)=>{t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},3196:e=>{"use strict";e.exports=function(e){var t,r,a="",n=(e=function(e){return e||(e={}),{length:e.length||8,numeric:"boolean"!=typeof e.numeric||e.numeric,letters:"boolean"!=typeof e.letters||e.letters,special:"boolean"==typeof e.special&&e.special,exclude:Array.isArray(e.exclude)?e.exclude:[]}}(e)).length,i=(e.exclude,function(e){var t="";e.numeric&&(t+="0123456789"),e.letters&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),e.special&&(t+="!$%^&*()_+|~-=`{}[]:;<>?,./");for(var r=0;r<=e.exclude.length;r++)t=t.replace(e.exclude[r],"");return t}(e));for(t=1;t<=n;t++)a+=i.substring(r=Math.floor(Math.random()*i.length),r+1);return a}},5666:e=>{var t=function(e){"use strict";var t,r=Object.prototype,a=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function d(e,t,r,a){var n=t&&t.prototype instanceof _?t:_,i=Object.create(n.prototype),s=new T(a||[]);return i._invoke=function(e,t,r){var a=l;return function(n,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===n)throw i;return D()}for(r.method=n,r.arg=i;;){var s=r.delegate;if(s){var o=P(s,r);if(o){if(o===f)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===l)throw a=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var c=p(e,t,r);if("normal"===c.type){if(a=r.done?m:u,c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=m,r.method="throw",r.arg=c.arg)}}}(e,r,s),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var l="suspendedStart",u="suspendedYield",h="executing",m="completed",f={};function _(){}function v(){}function g(){}var y={};c(y,i,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(x([])));w&&w!==r&&a.call(w,i)&&(y=w);var S=g.prototype=_.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(n,i,s,o){var c=p(e[n],e,i);if("throw"!==c.type){var d=c.arg,l=d.value;return l&&"object"==typeof l&&a.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(l).then((function(e){d.value=e,s(d)}),(function(e){return r("throw",e,s,o)}))}o(c.arg)}var n;this._invoke=function(e,a){function i(){return new t((function(t,n){r(e,a,t,n)}))}return n=n?n.then(i,i):i()}}function P(e,r){var a=e.iterator[r.method];if(a===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=p(a,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,f;var i=n.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function x(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function r(){for(;++n<e.length;)if(a.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:D}}function D(){return{value:t,done:!0}}return v.prototype=g,c(S,"constructor",g),c(g,"constructor",v),v.displayName=c(g,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,o,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},k(R.prototype),c(R.prototype,s,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,a,n,i){void 0===i&&(i=Promise);var s=new R(d(t,r,a,n),i);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},k(S),c(S,o,"Generator"),c(S,i,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var a=t.pop();if(a in e)return r.value=a,r.done=!1,r}return r.done=!0,r}},e.values=x,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(a,n){return o.type="throw",o.arg=e,r.next=a,n&&(r.method="next",r.arg=t),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=a.call(s,"catchLoc"),d=a.call(s,"finallyLoc");if(c&&d){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;C(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,a){return this.delegate={iterator:x(e),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},9353:(e,t,r)=>{e.exports=r(1846)},1846:(e,t,r)=>{var a=r(1960);t.operation=function(e){var r=t.timeouts(e);return new a(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort((function(e,t){return e-t})),a},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,a=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return a=Math.min(a,t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var n in a=[],e)"function"==typeof e[n]&&a.push(n);for(var i=0;i<a.length;i++){var s=a[i],o=e[s];e[s]=function(a){var n=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))})),n.attempt((function(){a.apply(e,i)}))}.bind(e,o),e[s].options=r}}},1960:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var a=this,n=setTimeout((function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout((function(){a._operationTimeoutCb(a._attempts)}),a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)}),r);return this._options.unref&&n.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}},6692:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},766:(e,t,r)=>{var a=r(962),n=r(5776);t.write=n,t.parse=a.parse,t.parseParams=a.parseParams,t.parseFmtpConfig=a.parseFmtpConfig,t.parsePayloads=a.parsePayloads,t.parseRemoteCandidates=a.parseRemoteCandidates,t.parseImageAttributes=a.parseImageAttributes,t.parseSimulcastStreamList=a.parseSimulcastStreamList},962:(e,t,r)=>{var a=function(e){return String(Number(e))===e?Number(e):e},n=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=a(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=a(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(6692),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach((function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),a=r[r.length-1]);for(var o=0;o<(i[t]||[]).length;o+=1){var c=i[t][o];if(c.reg.test(s))return n(c,a,s)}})),t.media=r,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=a(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(a),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=a(e):(t=a(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},5776:(e,t,r)=>{var a=r(6692),n=/%[sdv%]/g,i=function(e){var t=1,r=arguments,a=r.length;return e.replace(n,(function(e){if(t>=a)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}}))},s=function(e,t,r){var a=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var s=t.names[n];t.name?a.push(r[t.name][s]):a.push(r[t.names[n]])}else a.push(r[t.name]);return i.apply(null,a)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||o,n=t.innerOrder||c,i=[];return r.forEach((function(t){a[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))})),e.media.forEach((function(e){i.push(s("m",a.m[0],e)),n.forEach((function(t){a[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"}},5840:(e,t,r)=>{var a;if("object"==typeof globalThis)a=globalThis;else try{a=r(284)}catch(e){}finally{if(a||"undefined"==typeof window||(a=window),!a)throw new Error("Could not determine global this")}var n=a.WebSocket||a.MozWebSocket,i=r(9387);function s(e,t){return t?new n(e,t):new n(e)}n&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(s,e,{get:function(){return n[e]}})})),e.exports={w3cwebsocket:n?s:null,version:i}},9387:(e,t,r)=>{e.exports=r(9794).version},2480:()=>{},907:(e,t,r)=>{"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}r.d(t,{Z:()=>a})},5861:(e,t,r)=>{"use strict";function a(e,t,r,a,n,i,s){try{var o=e[i](s),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(a,n)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function o(e){a(s,n,i,o,c,"next",e)}function c(e){a(s,n,i,o,c,"throw",e)}o(void 0)}))}}r.d(t,{Z:()=>n})},5671:(e,t,r)=>{"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{Z:()=>a})},3144:(e,t,r)=>{"use strict";function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}r.d(t,{Z:()=>n})},4942:(e,t,r)=>{"use strict";function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{Z:()=>a})},885:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(181);function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){o=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}}(e,t)||(0,a.Z)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},181:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(907);function n(e,t){if(e){if("string"==typeof e)return(0,a.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,a.Z)(e,t):void 0}}},7002:e=>{"use strict";e.exports=JSON.parse('{"_args":[["protoo-client@4.0.6","/home/rajansurani/VideoSDK/zujo-cloud-meetings-sdk"]],"_from":"protoo-client@4.0.6","_id":"protoo-client@4.0.6","_inBundle":false,"_integrity":"sha512-ZqImkKHpeJhSlgvyI6QAfZNc/aXcCgmmocMx4S1w2lAaxXtckxxeDtcVNtkOISUWm/mbC+BrmYPXoGMkfhkKOQ==","_location":"/protoo-client","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"protoo-client@4.0.6","name":"protoo-client","escapedName":"protoo-client","rawSpec":"4.0.6","saveSpec":null,"fetchSpec":"4.0.6"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.6.tgz","_spec":"4.0.6","_where":"/home/rajansurani/VideoSDK/zujo-cloud-meetings-sdk","author":{"name":"Iñaki Baz Castillo","email":"ibc@aliax.net"},"bugs":{"url":"https://github.com/ibc/protoo/issues"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0","websocket":"^1.0.33"},"description":"protoo JavaScript client module","devDependencies":{"eslint":"^5.16.0"},"engines":{"node":">=8.0.0"},"homepage":"https://protoo.versatica.com","keywords":["nodejs","browser","websocket"],"license":"MIT","main":"lib/index.js","name":"protoo-client","optionalDependencies":{"websocket":"^1.0.33"},"repository":{"type":"git","url":"git+https://github.com/ibc/protoo.git"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"version":"4.0.6"}')},9794:e=>{"use strict";e.exports={version:"1.0.34"}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,r),i.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(2395)})()));